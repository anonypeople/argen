<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<unit xmlns="http://www.sdml.info/srcML/src" language="Java"
      filename="C:\Users\dnader\git\biorimp\BIO-RIMP\test_data\code\xerces\src\org\apache\xerces\impl\xs\traversers\XSDAbstractTraverser.java">
    <comment type="block">/*
        * Copyright 2001-2004 The Apache Software Foundation.
        *
        * Licensed under the Apache License, Version 2.0 (the "License");
        * you may not use this file except in compliance with the License.
        * You may obtain a copy of the License at
        *
        * http://www.apache.org/licenses/LICENSE-2.0
        *
        * Unless required by applicable law or agreed to in writing, software
        * distributed under the License is distributed on an "AS IS" BASIS,
        * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
        * See the License for the specific language governing permissions and
        * limitations under the License.
        */
    </comment>

    <package>package
        <name><name>org</name>.<name>apache</name>.<name>xerces</name>.<name>impl</name>.<name>xs</name>.
            <name>traversers</name>
        </name>
        ;
    </package>

    <import>import
        <name><name>java</name>.<name>util</name>.
            <name>Vector</name>
        </name>
        ;
    </import>

    <import>import
        <name><name>org</name>.<name>apache</name>.<name>xerces</name>.<name>impl</name>.<name>dv</name>.
            <name>InvalidDatatypeValueException</name>
        </name>
        ;
    </import>
    <import>import
        <name><name>org</name>.<name>apache</name>.<name>xerces</name>.<name>impl</name>.<name>dv</name>.
            <name>XSFacets</name>
        </name>
        ;
    </import>
    <import>import
        <name><name>org</name>.<name>apache</name>.<name>xerces</name>.<name>impl</name>.<name>dv</name>.
            <name>XSSimpleType</name>
        </name>
        ;
    </import>
    <import>import
        <name><name>org</name>.<name>apache</name>.<name>xerces</name>.<name>impl</name>.<name>validation</name>.
            <name>ValidationState</name>
        </name>
        ;
    </import>
    <import>import
        <name><name>org</name>.<name>apache</name>.<name>xerces</name>.<name>impl</name>.<name>xs</name>.
            <name>SchemaGrammar</name>
        </name>
        ;
    </import>
    <import>import
        <name><name>org</name>.<name>apache</name>.<name>xerces</name>.<name>impl</name>.<name>xs</name>.
            <name>SchemaSymbols</name>
        </name>
        ;
    </import>
    <import>import
        <name><name>org</name>.<name>apache</name>.<name>xerces</name>.<name>impl</name>.<name>xs</name>.
            <name>XSAnnotationImpl</name>
        </name>
        ;
    </import>
    <import>import
        <name><name>org</name>.<name>apache</name>.<name>xerces</name>.<name>impl</name>.<name>xs</name>.
            <name>XSAttributeGroupDecl</name>
        </name>
        ;
    </import>
    <import>import
        <name><name>org</name>.<name>apache</name>.<name>xerces</name>.<name>impl</name>.<name>xs</name>.
            <name>XSAttributeUseImpl</name>
        </name>
        ;
    </import>
    <import>import
        <name><name>org</name>.<name>apache</name>.<name>xerces</name>.<name>impl</name>.<name>xs</name>.
            <name>XSComplexTypeDecl</name>
        </name>
        ;
    </import>
    <import>import
        <name><name>org</name>.<name>apache</name>.<name>xerces</name>.<name>impl</name>.<name>xs</name>.
            <name>XSElementDecl</name>
        </name>
        ;
    </import>
    <import>import
        <name><name>org</name>.<name>apache</name>.<name>xerces</name>.<name>impl</name>.<name>xs</name>.
            <name>XSParticleDecl</name>
        </name>
        ;
    </import>
    <import>import
        <name><name>org</name>.<name>apache</name>.<name>xerces</name>.<name>impl</name>.<name>xs</name>.
            <name>XSWildcardDecl</name>
        </name>
        ;
    </import>
    <import>import
        <name><name>org</name>.<name>apache</name>.<name>xerces</name>.<name>xs</name>.
            <name>XSObjectList</name>
        </name>
        ;
    </import>
    <import>import
        <name><name>org</name>.<name>apache</name>.<name>xerces</name>.<name>xs</name>.
            <name>XSTypeDefinition</name>
        </name>
        ;
    </import>
    <import>import
        <name><name>org</name>.<name>apache</name>.<name>xerces</name>.<name>impl</name>.<name>xs</name>.<name>
            util</name>.
            <name>XInt</name>
        </name>
        ;
    </import>
    <import>import
        <name><name>org</name>.<name>apache</name>.<name>xerces</name>.<name>impl</name>.<name>xs</name>.<name>
            util</name>.
            <name>XSObjectListImpl</name>
        </name>
        ;
    </import>
    <import>import
        <name><name>org</name>.<name>apache</name>.<name>xerces</name>.<name>util</name>.
            <name>DOMUtil</name>
        </name>
        ;
    </import>
    <import>import
        <name><name>org</name>.<name>apache</name>.<name>xerces</name>.<name>util</name>.
            <name>NamespaceSupport</name>
        </name>
        ;
    </import>
    <import>import
        <name><name>org</name>.<name>apache</name>.<name>xerces</name>.<name>util</name>.
            <name>SymbolTable</name>
        </name>
        ;
    </import>
    <import>import
        <name><name>org</name>.<name>apache</name>.<name>xerces</name>.<name>xni</name>.
            <name>QName</name>
        </name>
        ;
    </import>
    <import>import
        <name><name>org</name>.<name>w3c</name>.<name>dom</name>.
            <name>Element</name>
        </name>
        ;
    </import>
    <import>import
        <name><name>org</name>.<name>w3c</name>.<name>dom</name>.
            <name>Node</name>
        </name>
        ;
    </import>
    <import>import
        <name><name>org</name>.<name>w3c</name>.<name>dom</name>.
            <name>Text</name>
        </name>
        ;
    </import>

    <comment type="javadoc">/**
        * Class &lt;code&gt;XSDAbstractTraverser&lt;/code&gt; serves as the base class for all
        * other &lt;code&gt;XSD???Traverser&lt;/code&gt;s. It holds the common data and provide
        * a unified way to initialize these data.
        *
        * @xerces.internal
        *
        * @author Elena Litani, IBM
        * @author Rahul Srivastava, Sun Microsystems Inc.
        * @author Neeraj Bajaj, Sun Microsystems Inc.
        *
        * @version $Id: XSDAbstractTraverser.java,v 1.41 2004/12/20 05:43:36 mrglavas Exp $
        */
    </comment>
    <class>
        <specifier>abstract</specifier>
        class <name>XSDAbstractTraverser</name>
        <block>{

            <decl_stmt>
                <decl>
                    <type>
                        <specifier>protected</specifier>
                        <specifier>static</specifier>
                        <specifier>final</specifier>
                        <name>String</name>
                    </type>
                    <name>NO_NAME</name>      =
                    <init>
                        <expr>"(no name)"</expr>
                    </init>
                </decl>
                ;
            </decl_stmt>

            <comment type="line">// Flags for checkOccurrences to indicate any special</comment>
            <comment type="line">// restrictions on minOccurs and maxOccurs relating to "all".</comment>
            <comment type="line">// NOT_ALL_CONTEXT - not processing an &lt;all&gt;</comment>
            <comment type="line">// PROCESSING_ALL_EL - processing an &lt;element&gt; in an &lt;all&gt;</comment>
            <comment type="line">// GROUP_REF_WITH_ALL - processing &lt;group&gt; reference that contained
                &lt;all&gt;</comment>
            <comment type="line">// CHILD_OF_GROUP - processing a child of a model group definition</comment>
            <comment type="line">// PROCESSING_ALL_GP - processing an &lt;all&gt; group itself</comment>

            <decl_stmt>
                <decl>
                    <type>
                        <specifier>protected</specifier>
                        <specifier>static</specifier>
                        <specifier>final</specifier>
                        <name>int</name>
                    </type>
                    <name>NOT_ALL_CONTEXT</name>    =
                    <init>
                        <expr>0</expr>
                    </init>
                </decl>
                ;
            </decl_stmt>
            <decl_stmt>
                <decl>
                    <type>
                        <specifier>protected</specifier>
                        <specifier>static</specifier>
                        <specifier>final</specifier>
                        <name>int</name>
                    </type>
                    <name>PROCESSING_ALL_EL</name>  =
                    <init>
                        <expr>1</expr>
                    </init>
                </decl>
                ;
            </decl_stmt>
            <decl_stmt>
                <decl>
                    <type>
                        <specifier>protected</specifier>
                        <specifier>static</specifier>
                        <specifier>final</specifier>
                        <name>int</name>
                    </type>
                    <name>GROUP_REF_WITH_ALL</name> =
                    <init>
                        <expr>2</expr>
                    </init>
                </decl>
                ;
            </decl_stmt>
            <decl_stmt>
                <decl>
                    <type>
                        <specifier>protected</specifier>
                        <specifier>static</specifier>
                        <specifier>final</specifier>
                        <name>int</name>
                    </type>
                    <name>CHILD_OF_GROUP</name>     =
                    <init>
                        <expr>4</expr>
                    </init>
                </decl>
                ;
            </decl_stmt>
            <decl_stmt>
                <decl>
                    <type>
                        <specifier>protected</specifier>
                        <specifier>static</specifier>
                        <specifier>final</specifier>
                        <name>int</name>
                    </type>
                    <name>PROCESSING_ALL_GP</name>  =
                    <init>
                        <expr>8</expr>
                    </init>
                </decl>
                ;
            </decl_stmt>

            <comment type="line">//Shared data</comment>
            <decl_stmt>
                <decl>
                    <type>
                        <specifier>protected</specifier>
                        <name>XSDHandler</name>
                    </type>
                    <name>fSchemaHandler</name> =
                    <init>
                        <expr>
                            <name>null</name>
                        </expr>
                    </init>
                </decl>
                ;
            </decl_stmt>
            <decl_stmt>
                <decl>
                    <type>
                        <specifier>protected</specifier>
                        <name>SymbolTable</name>
                    </type>
                    <name>fSymbolTable</name> =
                    <init>
                        <expr>
                            <name>null</name>
                        </expr>
                    </init>
                </decl>
                ;
            </decl_stmt>
            <decl_stmt>
                <decl>
                    <type>
                        <specifier>protected</specifier>
                        <name>XSAttributeChecker</name>
                    </type>
                    <name>fAttrChecker</name> =
                    <init>
                        <expr>
                            <name>null</name>
                        </expr>
                    </init>
                </decl>
                ;
            </decl_stmt>
            <decl_stmt>
                <decl>
                    <type>
                        <specifier>protected</specifier>
                        <name>boolean</name>
                    </type>
                    <name>fValidateAnnotations</name> =
                    <init>
                        <expr>false</expr>
                    </init>
                </decl>
                ;
            </decl_stmt>

            <comment type="line">// used to validate default/fixed attribute values</comment>
            <decl_stmt>
                <decl>
                    <type>
                        <name>ValidationState</name>
                    </type>
                    <name>fValidationState</name> =
                    <init>
                        <expr>new
                            <call>
                                <name>ValidationState</name>
                                <argument_list>()</argument_list>
                            </call>
                        </expr>
                    </init>
                </decl>
                ;
            </decl_stmt>

            <constructor>
                <name>XSDAbstractTraverser</name>
                <parameter_list>(
                    <param>
                        <decl>
                            <type>
                                <name>XSDHandler</name>
                            </type>
                            <name>handler</name>
                        </decl>
                    </param>
                    ,
                    <param>
                        <decl>
                            <type>
                                <name>XSAttributeChecker</name>
                            </type>
                            <name>attrChecker</name>
                        </decl>
                    </param>
                    )
                </parameter_list>
                <block>{
                    <expr_stmt>
                        <expr>
                            <name>fSchemaHandler</name>
                            =
                            <name>handler</name>
                        </expr>
                        ;
                    </expr_stmt>
                    <expr_stmt>
                        <expr>
                            <name>fAttrChecker</name>
                            =
                            <name>attrChecker</name>
                        </expr>
                        ;
                    </expr_stmt>
                    }
                </block>
            </constructor>

            <function>
                <type>
                    <name>void</name>
                </type>
                <name>reset</name>
                <parameter_list>(
                    <param>
                        <decl>
                            <type>
                                <name>SymbolTable</name>
                            </type>
                            <name>symbolTable</name>
                        </decl>
                    </param>
                    ,
                    <param>
                        <decl>
                            <type>
                                <name>boolean</name>
                            </type>
                            <name>validateAnnotations</name>
                        </decl>
                    </param>
                    )
                </parameter_list>
                <block>{
                    <expr_stmt>
                        <expr>
                            <name>fSymbolTable</name>
                            =
                            <name>symbolTable</name>
                        </expr>
                        ;
                    </expr_stmt>
                    <expr_stmt>
                        <expr>
                            <name>fValidateAnnotations</name>
                            =
                            <name>validateAnnotations</name>
                        </expr>
                        ;
                    </expr_stmt>
                    <expr_stmt>
                        <expr>
                            <call>
                                <name><name>fValidationState</name>.
                                    <name>setExtraChecking</name>
                                </name>
                                <argument_list>(
                                    <argument>
                                        <expr>false</expr>
                                    </argument>
                                    )
                                </argument_list>
                            </call>
                        </expr>
                        ;
                    </expr_stmt>
                    <expr_stmt>
                        <expr>
                            <call>
                                <name><name>fValidationState</name>.
                                    <name>setSymbolTable</name>
                                </name>
                                <argument_list>(
                                    <argument>
                                        <expr>
                                            <name>symbolTable</name>
                                        </expr>
                                    </argument>
                                    )
                                </argument_list>
                            </call>
                        </expr>
                        ;
                    </expr_stmt>
                    }
                </block>
            </function>

            <comment type="line">// traverse the annotation declaration</comment>
            <comment type="line">// REVISIT: how to pass the parentAttrs? as DOM attributes?</comment>
            <comment type="line">// as name/value pairs (string)? in parsed form?</comment>
            <comment type="line">// @return XSAnnotationImpl object</comment>
            <function>
                <type>
                    <name>XSAnnotationImpl</name>
                </type>
                <name>traverseAnnotationDecl</name>
                <parameter_list>(
                    <param>
                        <decl>
                            <type>
                                <name>Element</name>
                            </type>
                            <name>annotationDecl</name>
                        </decl>
                    </param>
                    ,
                    <param>
                        <decl>
                            <type>
                                <name>
                                    <name>Object</name>
                                    <index>[]</index>
                                </name>
                            </type>
                            <name>parentAttrs</name>
                        </decl>
                    </param>
                    ,
                    <param>
                        <decl>
                            <type>
                                <name>boolean</name>
                            </type>
                            <name>isGlobal</name>
                        </decl>
                    </param>
                    ,
                    <param>
                        <decl>
                            <type>
                                <name>XSDocumentInfo</name>
                            </type>
                            <name>schemaDoc</name>
                        </decl>
                    </param>
                    )
                </parameter_list>
                <block>{
                    <comment type="line">// General Attribute Checking</comment>
                    <decl_stmt>
                        <decl>
                            <type>
                                <name>Object</name>
                                <index>[]</index>
                            </type>
                            <name>attrValues</name> =
                            <init>
                                <expr>
                                    <call>
                                        <name><name>fAttrChecker</name>.
                                            <name>checkAttributes</name>
                                        </name>
                                        <argument_list>(
                                            <argument>
                                                <expr>
                                                    <name>annotationDecl</name>
                                                </expr>
                                            </argument>
                                            ,
                                            <argument>
                                                <expr>
                                                    <name>isGlobal</name>
                                                </expr>
                                            </argument>
                                            ,
                                            <argument>
                                                <expr>
                                                    <name>schemaDoc</name>
                                                </expr>
                                            </argument>
                                            )
                                        </argument_list>
                                    </call>
                                </expr>
                            </init>
                        </decl>
                        ;
                    </decl_stmt>
                    <expr_stmt>
                        <expr>
                            <call>
                                <name><name>fAttrChecker</name>.
                                    <name>returnAttrArray</name>
                                </name>
                                <argument_list>(
                                    <argument>
                                        <expr>
                                            <name>attrValues</name>
                                        </expr>
                                    </argument>
                                    ,
                                    <argument>
                                        <expr>
                                            <name>schemaDoc</name>
                                        </expr>
                                    </argument>
                                    )
                                </argument_list>
                            </call>
                        </expr>
                        ;
                    </expr_stmt>

                    <decl_stmt>
                        <decl>
                            <type>
                                <name>String</name>
                            </type>
                            <name>contents</name> =
                            <init>
                                <expr>
                                    <name>null</name>
                                </expr>
                            </init>
                        </decl>
                        ;
                    </decl_stmt>
                    <decl_stmt>
                        <decl>
                            <type>
                                <name>Element</name>
                            </type>
                            <name>child</name> =
                            <init>
                                <expr>
                                    <call>
                                        <name><name>DOMUtil</name>.
                                            <name>getFirstChildElement</name>
                                        </name>
                                        <argument_list>(
                                            <argument>
                                                <expr>
                                                    <name>annotationDecl</name>
                                                </expr>
                                            </argument>
                                            )
                                        </argument_list>
                                    </call>
                                </expr>
                            </init>
                        </decl>
                        ;
                    </decl_stmt>
                    <if>if
                        <condition>(
                            <expr>
                                <name>child</name>
                                !=
                                <name>null</name>
                            </expr>
                            )
                        </condition>
                        <then>
                            <block>{
                                <do>do
                                    <block>{
                                        <decl_stmt>
                                            <decl>
                                                <type>
                                                    <name>String</name>
                                                </type>
                                                <name>name</name> =
                                                <init>
                                                    <expr>
                                                        <call>
                                                            <name><name>DOMUtil</name>.
                                                                <name>getLocalName</name>
                                                            </name>
                                                            <argument_list>(
                                                                <argument>
                                                                    <expr>
                                                                        <name>child</name>
                                                                    </expr>
                                                                </argument>
                                                                )
                                                            </argument_list>
                                                        </call>
                                                    </expr>
                                                </init>
                                            </decl>
                                            ;
                                        </decl_stmt>

                                        <comment type="line">// the only valid children of "annotation" are</comment>
                                        <comment type="line">// "appinfo" and "documentation"</comment>
                                        <if>if
                                            <condition>(
                                                <expr>!((
                                                    <call>
                                                        <name><name>name</name>.
                                                            <name>equals</name>
                                                        </name>
                                                        <argument_list>(
                                                            <argument>
                                                                <expr>
                                                                    <name><name>SchemaSymbols</name>.
                                                                        <name>ELT_APPINFO</name>
                                                                    </name>
                                                                </expr>
                                                            </argument>
                                                            )
                                                        </argument_list>
                                                    </call>
                                                    ) ||
                                                    (
                                                    <call>
                                                        <name><name>name</name>.
                                                            <name>equals</name>
                                                        </name>
                                                        <argument_list>(
                                                            <argument>
                                                                <expr>
                                                                    <name><name>SchemaSymbols</name>.
                                                                        <name>ELT_DOCUMENTATION</name>
                                                                    </name>
                                                                </expr>
                                                            </argument>
                                                            )
                                                        </argument_list>
                                                    </call>
                                                    ))
                                                </expr>
                                                )
                                            </condition>
                                            <then>
                                                <block>{
                                                    <expr_stmt>
                                                        <expr>
                                                            <call>
                                                                <name>reportSchemaError</name>
                                                                <argument_list>(
                                                                    <argument>
                                                                        <expr>"src-annotation"</expr>
                                                                    </argument>
                                                                    ,
                                                                    <argument>
                                                                        <expr>new
                                                                            <name>
                                                                                <name>Object</name>
                                                                                <index>[]</index>
                                                                            </name>
                                                                            <block>{
                                                                                <expr>
                                                                                    <name>name</name>
                                                                                </expr>
                                                                                }
                                                                            </block>
                                                                        </expr>
                                                                    </argument>
                                                                    ,
                                                                    <argument>
                                                                        <expr>
                                                                            <name>child</name>
                                                                        </expr>
                                                                    </argument>
                                                                    )
                                                                </argument_list>
                                                            </call>
                                                        </expr>
                                                        ;
                                                    </expr_stmt>
                                                    }
                                                </block>
                                            </then>
                                            <else>else
                                                <block>{
                                                    <comment type="line">// the annotation, as we currently know it, is
                                                        a Text child
                                                    </comment>
                                                    <decl_stmt>
                                                        <decl>
                                                            <type>
                                                                <name>Node</name>
                                                            </type>
                                                            <name>textContent</name> =
                                                            <init>
                                                                <expr>
                                                                    <call>
                                                                        <name><name>child</name>.
                                                                            <name>getFirstChild</name>
                                                                        </name>
                                                                        <argument_list>()</argument_list>
                                                                    </call>
                                                                </expr>
                                                            </init>
                                                        </decl>
                                                        ;
                                                    </decl_stmt>
                                                    <if>if
                                                        <condition>(
                                                            <expr>
                                                                <name>textContent</name>
                                                                != <name>null</name> &amp;&amp;
                                                                <call>
                                                                    <name><name>textContent</name>.
                                                                        <name>getNodeType</name>
                                                                    </name>
                                                                    <argument_list>()</argument_list>
                                                                </call>
                                                                ==
                                                                <name><name>Node</name>.
                                                                    <name>TEXT_NODE</name>
                                                                </name>
                                                            </expr>
                                                            )
                                                        </condition>
                                                        <then>
                                                            <block>{
                                                                <expr_stmt>
                                                                    <expr>
                                                                        <name>contents</name>
                                                                        = ((<name>Text</name>)<name>textContent</name>).
                                                                        <call>
                                                                            <name>getData</name>
                                                                            <argument_list>()</argument_list>
                                                                        </call>
                                                                    </expr>
                                                                    ;
                                                                </expr_stmt>
                                                                }
                                                            </block>
                                                        </then>
                                                    </if>
                                                    }
                                                </block>
                                            </else>
                                        </if>

                                        <comment type="line">// General Attribute Checking</comment>
                                        <comment type="line">// There is no difference between global or local
                                            appinfo/documentation,
                                        </comment>
                                        <comment type="line">// so we assume it's always global.</comment>
                                        <expr_stmt>
                                            <expr>
                                                <name>attrValues</name>
                                                =
                                                <call>
                                                    <name><name>fAttrChecker</name>.
                                                        <name>checkAttributes</name>
                                                    </name>
                                                    <argument_list>(
                                                        <argument>
                                                            <expr>
                                                                <name>child</name>
                                                            </expr>
                                                        </argument>
                                                        ,
                                                        <argument>
                                                            <expr>true</expr>
                                                        </argument>
                                                        ,
                                                        <argument>
                                                            <expr>
                                                                <name>schemaDoc</name>
                                                            </expr>
                                                        </argument>
                                                        )
                                                    </argument_list>
                                                </call>
                                            </expr>
                                            ;
                                        </expr_stmt>
                                        <expr_stmt>
                                            <expr>
                                                <call>
                                                    <name><name>fAttrChecker</name>.
                                                        <name>returnAttrArray</name>
                                                    </name>
                                                    <argument_list>(
                                                        <argument>
                                                            <expr>
                                                                <name>attrValues</name>
                                                            </expr>
                                                        </argument>
                                                        ,
                                                        <argument>
                                                            <expr>
                                                                <name>schemaDoc</name>
                                                            </expr>
                                                        </argument>
                                                        )
                                                    </argument_list>
                                                </call>
                                            </expr>
                                            ;
                                        </expr_stmt>

                                        <expr_stmt>
                                            <expr>
                                                <name>child</name>
                                                =
                                                <call>
                                                    <name><name>DOMUtil</name>.
                                                        <name>getNextSiblingElement</name>
                                                    </name>
                                                    <argument_list>(
                                                        <argument>
                                                            <expr>
                                                                <name>child</name>
                                                            </expr>
                                                        </argument>
                                                        )
                                                    </argument_list>
                                                </call>
                                            </expr>
                                            ;
                                        </expr_stmt>
                                        }
                                    </block>
                                    while
                                    <condition>(
                                        <expr>
                                            <name>child</name>
                                            !=
                                            <name>null</name>
                                        </expr>
                                        )
                                    </condition>
                                    ;
                                </do>
                                }
                            </block>
                        </then>
                        <comment type="line">// REVISIT: When an annotation has no &lt;documentation&gt; or</comment>
                        <comment type="line">// &lt;appinfo&gt; children the text child is stored on the first child of
                            its
                        </comment>
                        <comment type="line">// parent. Only if the annotation is the first child will we find the
                        </comment>
                        <comment type="line">// text node there. See SchemaDOM. We need to store the string
                            representation
                        </comment>
                        <comment type="line">// in a consistent place so it can be reliably retrieved, perhaps as
                        </comment>
                        <comment type="line">// user data. -- mrglavas</comment>
                        <else>else
                            <block>{
                                <decl_stmt>
                                    <decl>
                                        <type>
                                            <name>Node</name>
                                        </type>
                                        <name>textContent</name> =
                                        <init>
                                            <expr>
                                                <call>
                                                    <name><name>annotationDecl</name>.
                                                        <name>getFirstChild</name>
                                                    </name>
                                                    <argument_list>()</argument_list>
                                                </call>
                                            </expr>
                                        </init>
                                    </decl>
                                    ;
                                </decl_stmt>
                                <if>if
                                    <condition>(
                                        <expr>
                                            <name>textContent</name>
                                            != <name>null</name> &amp;&amp;
                                            <call>
                                                <name><name>textContent</name>.
                                                    <name>getNodeType</name>
                                                </name>
                                                <argument_list>()</argument_list>
                                            </call>
                                            ==
                                            <name><name>Node</name>.
                                                <name>TEXT_NODE</name>
                                            </name>
                                        </expr>
                                        )
                                    </condition>
                                    <then>
                                        <block>{
                                            <expr_stmt>
                                                <expr>
                                                    <name>contents</name>
                                                    = ((<name>Text</name>)<name>textContent</name>).
                                                    <call>
                                                        <name>getData</name>
                                                        <argument_list>()</argument_list>
                                                    </call>
                                                </expr>
                                                ;
                                            </expr_stmt>
                                            }
                                        </block>
                                    </then>
                                </if>
                                }
                            </block>
                        </else>
                    </if>
                    <comment type="line">// if contents was null, must have been some kind of error;</comment>
                    <comment type="line">// nothing to contribute to PSVI</comment>
                    <if>if
                        <condition>(
                            <expr>
                                <name>contents</name>
                                ==
                                <name>null</name>
                            </expr>
                            )
                        </condition>
                        <then>
                            <return>return
                                <expr>
                                    <name>null</name>
                                </expr>
                                ;
                            </return>
                        </then>
                    </if>

                    <comment type="line">// find the grammar; fSchemaHandler must be known!</comment>
                    <decl_stmt>
                        <decl>
                            <type>
                                <name>SchemaGrammar</name>
                            </type>
                            <name>grammar</name> =
                            <init>
                                <expr>
                                    <call>
                                        <name><name>fSchemaHandler</name>.
                                            <name>getGrammar</name>
                                        </name>
                                        <argument_list>(
                                            <argument>
                                                <expr>
                                                    <name><name>schemaDoc</name>.
                                                        <name>fTargetNamespace</name>
                                                    </name>
                                                </expr>
                                            </argument>
                                            )
                                        </argument_list>
                                    </call>
                                </expr>
                            </init>
                        </decl>
                        ;
                    </decl_stmt>
                    <comment type="line">// fish out local attributes passed from parent</comment>
                    <decl_stmt>
                        <decl>
                            <type>
                                <name>Vector</name>
                            </type>
                            <name>annotationLocalAttrs</name> =
                            <init>
                                <expr>(<name>Vector</name>)
                                    <name>
                                        <name>parentAttrs</name>
                                        <index>[
                                            <expr>
                                                <name><name>XSAttributeChecker</name>.
                                                    <name>ATTIDX_NONSCHEMA</name>
                                                </name>
                                            </expr>
                                            ]
                                        </index>
                                    </name>
                                </expr>
                            </init>
                        </decl>
                        ;
                    </decl_stmt>
                    <comment type="line">// optimize for case where there are no local attributes</comment>
                    <if>if
                        <condition>(
                            <expr>
                                <name>annotationLocalAttrs</name>
                                != <name>null</name> &amp;&amp; !
                                <call>
                                    <name><name>annotationLocalAttrs</name>.
                                        <name>isEmpty</name>
                                    </name>
                                    <argument_list>()</argument_list>
                                </call>
                            </expr>
                            )
                        </condition>
                        <then>
                            <block>{
                                <decl_stmt>
                                    <decl>
                                        <type>
                                            <name>StringBuffer</name>
                                        </type>
                                        <name>localStrBuffer</name> =
                                        <init>
                                            <expr>new
                                                <call>
                                                    <name>StringBuffer</name>
                                                    <argument_list>(
                                                        <argument>
                                                            <expr>64</expr>
                                                        </argument>
                                                        )
                                                    </argument_list>
                                                </call>
                                            </expr>
                                        </init>
                                    </decl>
                                    ;
                                </decl_stmt>
                                <expr_stmt>
                                    <expr>
                                        <call>
                                            <name><name>localStrBuffer</name>.
                                                <name>append</name>
                                            </name>
                                            <argument_list>(
                                                <argument>
                                                    <expr>" "</expr>
                                                </argument>
                                                )
                                            </argument_list>
                                        </call>
                                    </expr>
                                    ;
                                </expr_stmt>
                                <comment type="line">// Vector should contain rawname value pairs</comment>
                                <decl_stmt>
                                    <decl>
                                        <type>
                                            <name>int</name>
                                        </type>
                                        <name>i</name> =
                                        <init>
                                            <expr>0</expr>
                                        </init>
                                    </decl>
                                    ;
                                </decl_stmt>
                                <while>while
                                    <condition>(
                                        <expr>
                                            <name>i</name>
                                            &lt;
                                            <call>
                                                <name><name>annotationLocalAttrs</name>.
                                                    <name>size</name>
                                                </name>
                                                <argument_list>()</argument_list>
                                            </call>
                                        </expr>
                                        )
                                    </condition>
                                    <block>{
                                        <decl_stmt>
                                            <decl>
                                                <type>
                                                    <name>String</name>
                                                </type>
                                                <name>rawname</name> =
                                                <init>
                                                    <expr>(<name>String</name>)
                                                        <call>
                                                            <name><name>annotationLocalAttrs</name>.
                                                                <name>elementAt</name>
                                                            </name>
                                                            <argument_list>(
                                                                <argument>
                                                                    <expr><name>i</name>++
                                                                    </expr>
                                                                </argument>
                                                                )
                                                            </argument_list>
                                                        </call>
                                                    </expr>
                                                </init>
                                            </decl>
                                            ;
                                        </decl_stmt>
                                        <decl_stmt>
                                            <decl>
                                                <type>
                                                    <name>int</name>
                                                </type>
                                                <name>colonIndex</name> =
                                                <init>
                                                    <expr>
                                                        <call>
                                                            <name><name>rawname</name>.
                                                                <name>indexOf</name>
                                                            </name>
                                                            <argument_list>(
                                                                <argument>
                                                                    <expr>':'</expr>
                                                                </argument>
                                                                )
                                                            </argument_list>
                                                        </call>
                                                    </expr>
                                                </init>
                                            </decl>
                                            ;
                                        </decl_stmt>
                                        <decl_stmt>
                                            <decl>
                                                <type>
                                                    <name>String</name>
                                                </type>
                                                <name>prefix</name>,
                                                <name>localpart</name>
                                            </decl>
                                            ;
                                        </decl_stmt>
                                        <if>if
                                            <condition>(
                                                <expr>
                                                    <name>colonIndex</name>
                                                    == -1
                                                </expr>
                                                )
                                            </condition>
                                            <then>
                                                <block>{
                                                    <expr_stmt>
                                                        <expr>
                                                            <name>prefix</name>
                                                            = ""
                                                        </expr>
                                                        ;
                                                    </expr_stmt>
                                                    <expr_stmt>
                                                        <expr>
                                                            <name>localpart</name>
                                                            =
                                                            <name>rawname</name>
                                                        </expr>
                                                        ;
                                                    </expr_stmt>
                                                    }
                                                </block>
                                            </then>
                                            <else>else
                                                <block>{
                                                    <expr_stmt>
                                                        <expr>
                                                            <name>prefix</name>
                                                            =
                                                            <call>
                                                                <name><name>rawname</name>.
                                                                    <name>substring</name>
                                                                </name>
                                                                <argument_list>(
                                                                    <argument>
                                                                        <expr>0</expr>
                                                                    </argument>
                                                                    ,
                                                                    <argument>
                                                                        <expr>
                                                                            <name>colonIndex</name>
                                                                        </expr>
                                                                    </argument>
                                                                    )
                                                                </argument_list>
                                                            </call>
                                                        </expr>
                                                        ;
                                                    </expr_stmt>
                                                    <expr_stmt>
                                                        <expr>
                                                            <name>localpart</name>
                                                            =
                                                            <call>
                                                                <name><name>rawname</name>.
                                                                    <name>substring</name>
                                                                </name>
                                                                <argument_list>(
                                                                    <argument>
                                                                        <expr><name>colonIndex</name>+1
                                                                        </expr>
                                                                    </argument>
                                                                    )
                                                                </argument_list>
                                                            </call>
                                                        </expr>
                                                        ;
                                                    </expr_stmt>
                                                    }
                                                </block>
                                            </else>
                                        </if>
                                        <decl_stmt>
                                            <decl>
                                                <type>
                                                    <name>String</name>
                                                </type>
                                                <name>uri</name> =
                                                <init>
                                                    <expr>
                                                        <call>
                                                            <name><name>schemaDoc</name>.<name>fNamespaceSupport</name>.
                                                                <name>getURI</name>
                                                            </name>
                                                            <argument_list>(
                                                                <argument>
                                                                    <expr>
                                                                        <call>
                                                                            <name><name>prefix</name>.
                                                                                <name>intern</name>
                                                                            </name>
                                                                            <argument_list>()</argument_list>
                                                                        </call>
                                                                    </expr>
                                                                </argument>
                                                                )
                                                            </argument_list>
                                                        </call>
                                                    </expr>
                                                </init>
                                            </decl>
                                            ;
                                        </decl_stmt>
                                        <if>if
                                            <condition>(
                                                <expr>!
                                                    <call>
                                                        <name><name>annotationDecl</name>.
                                                            <name>getAttributeNS</name>
                                                        </name>
                                                        <argument_list>(
                                                            <argument>
                                                                <expr>
                                                                    <name>uri</name>
                                                                </expr>
                                                            </argument>
                                                            ,
                                                            <argument>
                                                                <expr>
                                                                    <name>localpart</name>
                                                                </expr>
                                                            </argument>
                                                            )
                                                        </argument_list>
                                                    </call>
                                                    .
                                                    <call>
                                                        <name>equals</name>
                                                        <argument_list>(
                                                            <argument>
                                                                <expr>""</expr>
                                                            </argument>
                                                            )
                                                        </argument_list>
                                                    </call>
                                                </expr>
                                                )
                                            </condition>
                                            <then>
                                                <block>{
                                                    <expr_stmt>
                                                        <expr><name>i</name>++
                                                        </expr>
                                                        ;
                                                    </expr_stmt>
                                                    <comment type="line">// skip the next value, too</comment>
                                                    <continue>continue;</continue>
                                                    }
                                                </block>
                                            </then>
                                        </if>
                                        <expr_stmt>
                                            <expr>
                                                <call>
                                                    <name><name>localStrBuffer</name>.
                                                        <name>append</name>
                                                    </name>
                                                    <argument_list>(
                                                        <argument>
                                                            <expr>
                                                                <name>rawname</name>
                                                            </expr>
                                                        </argument>
                                                        )
                                                    </argument_list>
                                                </call>
                                                .
                                                <call>
                                                    <name>append</name>
                                                    <argument_list>(
                                                        <argument>
                                                            <expr>"=\""</expr>
                                                        </argument>
                                                        )
                                                    </argument_list>
                                                </call>
                                            </expr>
                                            ;
                                        </expr_stmt>
                                        <decl_stmt>
                                            <decl>
                                                <type>
                                                    <name>String</name>
                                                </type>
                                                <name>value</name> =
                                                <init>
                                                    <expr>(<name>String</name>)
                                                        <call>
                                                            <name><name>annotationLocalAttrs</name>.
                                                                <name>elementAt</name>
                                                            </name>
                                                            <argument_list>(
                                                                <argument>
                                                                    <expr><name>i</name>++
                                                                    </expr>
                                                                </argument>
                                                                )
                                                            </argument_list>
                                                        </call>
                                                    </expr>
                                                </init>
                                            </decl>
                                            ;
                                        </decl_stmt>
                                        <comment type="line">// search for pesky "s and &gt;s within attr value:
                                        </comment>
                                        <expr_stmt>
                                            <expr>
                                                <name>value</name>
                                                =
                                                <call>
                                                    <name>processAttValue</name>
                                                    <argument_list>(
                                                        <argument>
                                                            <expr>
                                                                <name>value</name>
                                                            </expr>
                                                        </argument>
                                                        )
                                                    </argument_list>
                                                </call>
                                            </expr>
                                            ;
                                        </expr_stmt>
                                        <expr_stmt>
                                            <expr>
                                                <call>
                                                    <name><name>localStrBuffer</name>.
                                                        <name>append</name>
                                                    </name>
                                                    <argument_list>(
                                                        <argument>
                                                            <expr>
                                                                <name>value</name>
                                                            </expr>
                                                        </argument>
                                                        )
                                                    </argument_list>
                                                </call>
                                                .
                                                <call>
                                                    <name>append</name>
                                                    <argument_list>(
                                                        <argument>
                                                            <expr>"\" "</expr>
                                                        </argument>
                                                        )
                                                    </argument_list>
                                                </call>
                                            </expr>
                                            ;
                                        </expr_stmt>
                                        }
                                    </block>
                                </while>
                                <comment type="line">// and now splice it into place; immediately after the annotation
                                    token, for simplicity's sake
                                </comment>
                                <decl_stmt>
                                    <decl>
                                        <type>
                                            <name>StringBuffer</name>
                                        </type>
                                        <name>contentBuffer</name> =
                                        <init>
                                            <expr>new
                                                <call>
                                                    <name>StringBuffer</name>
                                                    <argument_list>(
                                                        <argument>
                                                            <expr>
                                                                <call>
                                                                    <name><name>contents</name>.
                                                                        <name>length</name>
                                                                    </name>
                                                                    <argument_list>()</argument_list>
                                                                </call>
                                                                +
                                                                <call>
                                                                    <name><name>localStrBuffer</name>.
                                                                        <name>length</name>
                                                                    </name>
                                                                    <argument_list>()</argument_list>
                                                                </call>
                                                            </expr>
                                                        </argument>
                                                        )
                                                    </argument_list>
                                                </call>
                                            </expr>
                                        </init>
                                    </decl>
                                    ;
                                </decl_stmt>
                                <decl_stmt>
                                    <decl>
                                        <type>
                                            <name>int</name>
                                        </type>
                                        <name>annotationTokenEnd</name> =
                                        <init>
                                            <expr>
                                                <call>
                                                    <name><name>contents</name>.
                                                        <name>indexOf</name>
                                                    </name>
                                                    <argument_list>(
                                                        <argument>
                                                            <expr>
                                                                <name><name>SchemaSymbols</name>.
                                                                    <name>ELT_ANNOTATION</name>
                                                                </name>
                                                            </expr>
                                                        </argument>
                                                        )
                                                    </argument_list>
                                                </call>
                                            </expr>
                                        </init>
                                    </decl>
                                    ;
                                </decl_stmt>
                                <comment type="line">// annotation must occur somewhere or we're in big trouble...
                                </comment>
                                <if>if
                                    <condition>(
                                        <expr>
                                            <name>annotationTokenEnd</name>
                                            == -1
                                        </expr>
                                        )
                                    </condition>
                                    <then>
                                        <return>return
                                            <expr>
                                                <name>null</name>
                                            </expr>
                                            ;
                                        </return>
                                    </then>
                                </if>
                                <expr_stmt>
                                    <expr>
                                        <name>annotationTokenEnd</name>
                                        +=
                                        <call>
                                            <name><name>SchemaSymbols</name>.<name>ELT_ANNOTATION</name>.
                                                <name>length</name>
                                            </name>
                                            <argument_list>()</argument_list>
                                        </call>
                                    </expr>
                                    ;
                                </expr_stmt>
                                <expr_stmt>
                                    <expr>
                                        <call>
                                            <name><name>contentBuffer</name>.
                                                <name>append</name>
                                            </name>
                                            <argument_list>(
                                                <argument>
                                                    <expr>
                                                        <call>
                                                            <name><name>contents</name>.
                                                                <name>substring</name>
                                                            </name>
                                                            <argument_list>(
                                                                <argument>
                                                                    <expr>0</expr>
                                                                </argument>
                                                                ,
                                                                <argument>
                                                                    <expr>
                                                                        <name>annotationTokenEnd</name>
                                                                    </expr>
                                                                </argument>
                                                                )
                                                            </argument_list>
                                                        </call>
                                                    </expr>
                                                </argument>
                                                )
                                            </argument_list>
                                        </call>
                                    </expr>
                                    ;
                                </expr_stmt>
                                <expr_stmt>
                                    <expr>
                                        <call>
                                            <name><name>contentBuffer</name>.
                                                <name>append</name>
                                            </name>
                                            <argument_list>(
                                                <argument>
                                                    <expr>
                                                        <call>
                                                            <name><name>localStrBuffer</name>.
                                                                <name>toString</name>
                                                            </name>
                                                            <argument_list>()</argument_list>
                                                        </call>
                                                    </expr>
                                                </argument>
                                                )
                                            </argument_list>
                                        </call>
                                    </expr>
                                    ;
                                </expr_stmt>
                                <expr_stmt>
                                    <expr>
                                        <call>
                                            <name><name>contentBuffer</name>.
                                                <name>append</name>
                                            </name>
                                            <argument_list>(
                                                <argument>
                                                    <expr>
                                                        <call>
                                                            <name><name>contents</name>.
                                                                <name>substring</name>
                                                            </name>
                                                            <argument_list>(
                                                                <argument>
                                                                    <expr>
                                                                        <name>annotationTokenEnd</name>
                                                                    </expr>
                                                                </argument>
                                                                ,
                                                                <argument>
                                                                    <expr>
                                                                        <call>
                                                                            <name><name>contents</name>.
                                                                                <name>length</name>
                                                                            </name>
                                                                            <argument_list>()</argument_list>
                                                                        </call>
                                                                    </expr>
                                                                </argument>
                                                                )
                                                            </argument_list>
                                                        </call>
                                                    </expr>
                                                </argument>
                                                )
                                            </argument_list>
                                        </call>
                                    </expr>
                                    ;
                                </expr_stmt>
                                <decl_stmt>
                                    <decl>
                                        <type>
                                            <specifier>final</specifier>
                                            <name>String</name>
                                        </type>
                                        <name>annotation</name> =
                                        <init>
                                            <expr>
                                                <call>
                                                    <name><name>contentBuffer</name>.
                                                        <name>toString</name>
                                                    </name>
                                                    <argument_list>()</argument_list>
                                                </call>
                                            </expr>
                                        </init>
                                    </decl>
                                    ;
                                </decl_stmt>
                                <if>if
                                    <condition>(
                                        <expr>
                                            <name>fValidateAnnotations</name>
                                        </expr>
                                        )
                                    </condition>
                                    <then>
                                        <block>{
                                            <expr_stmt>
                                                <expr>
                                                    <call>
                                                        <name><name>schemaDoc</name>.
                                                            <name>addAnnotation</name>
                                                        </name>
                                                        <argument_list>(
                                                            <argument>
                                                                <expr>new
                                                                    <call>
                                                                        <name>XSAnnotationInfo</name>
                                                                        <argument_list>(
                                                                            <argument>
                                                                                <expr>
                                                                                    <name>annotation</name>
                                                                                </expr>
                                                                            </argument>
                                                                            ,
                                                                            <argument>
                                                                                <expr>
                                                                                    <name>annotationDecl</name>
                                                                                </expr>
                                                                            </argument>
                                                                            )
                                                                        </argument_list>
                                                                    </call>
                                                                </expr>
                                                            </argument>
                                                            )
                                                        </argument_list>
                                                    </call>
                                                </expr>
                                                ;
                                            </expr_stmt>
                                            }
                                        </block>
                                    </then>
                                </if>
                                <return>return
                                    <expr>new
                                        <call>
                                            <name>XSAnnotationImpl</name>
                                            <argument_list>(
                                                <argument>
                                                    <expr>
                                                        <name>annotation</name>
                                                    </expr>
                                                </argument>
                                                ,
                                                <argument>
                                                    <expr>
                                                        <name>grammar</name>
                                                    </expr>
                                                </argument>
                                                )
                                            </argument_list>
                                        </call>
                                    </expr>
                                    ;
                                </return>
                                }
                            </block>
                        </then>
                        <else>else
                            <block>{
                                <if>if
                                    <condition>(
                                        <expr>
                                            <name>fValidateAnnotations</name>
                                        </expr>
                                        )
                                    </condition>
                                    <then>
                                        <block>{
                                            <expr_stmt>
                                                <expr>
                                                    <call>
                                                        <name><name>schemaDoc</name>.
                                                            <name>addAnnotation</name>
                                                        </name>
                                                        <argument_list>(
                                                            <argument>
                                                                <expr>new
                                                                    <call>
                                                                        <name>XSAnnotationInfo</name>
                                                                        <argument_list>(
                                                                            <argument>
                                                                                <expr>
                                                                                    <name>contents</name>
                                                                                </expr>
                                                                            </argument>
                                                                            ,
                                                                            <argument>
                                                                                <expr>
                                                                                    <name>annotationDecl</name>
                                                                                </expr>
                                                                            </argument>
                                                                            )
                                                                        </argument_list>
                                                                    </call>
                                                                </expr>
                                                            </argument>
                                                            )
                                                        </argument_list>
                                                    </call>
                                                </expr>
                                                ;
                                            </expr_stmt>
                                            }
                                        </block>
                                    </then>
                                </if>
                                <return>return
                                    <expr>new
                                        <call>
                                            <name>XSAnnotationImpl</name>
                                            <argument_list>(
                                                <argument>
                                                    <expr>
                                                        <name>contents</name>
                                                    </expr>
                                                </argument>
                                                ,
                                                <argument>
                                                    <expr>
                                                        <name>grammar</name>
                                                    </expr>
                                                </argument>
                                                )
                                            </argument_list>
                                        </call>
                                    </expr>
                                    ;
                                </return>
                                }
                            </block>
                        </else>
                    </if>

                    }
                </block>
            </function>

            <function>
                <type>
                    <name>XSAnnotationImpl</name>
                </type>
                <name>traverseSyntheticAnnotation</name>
                <parameter_list>(
                    <param>
                        <decl>
                            <type>
                                <name>Element</name>
                            </type>
                            <name>annotationParent</name>
                        </decl>
                    </param>
                    ,
                    <param>
                        <decl>
                            <type>
                                <name>String</name>
                            </type>
                            <name>initialContent</name>
                        </decl>
                    </param>
                    ,
                    <param>
                        <decl>
                            <type>
                                <name>
                                    <name>Object</name>
                                    <index>[]</index>
                                </name>
                            </type>
                            <name>parentAttrs</name>
                        </decl>
                    </param>
                    ,
                    <param>
                        <decl>
                            <type>
                                <name>boolean</name>
                            </type>
                            <name>isGlobal</name>
                        </decl>
                    </param>
                    ,
                    <param>
                        <decl>
                            <type>
                                <name>XSDocumentInfo</name>
                            </type>
                            <name>schemaDoc</name>
                        </decl>
                    </param>
                    )
                </parameter_list>
                <block>{

                    <decl_stmt>
                        <decl>
                            <type>
                                <name>String</name>
                            </type>
                            <name>contents</name> =
                            <init>
                                <expr>
                                    <name>initialContent</name>
                                </expr>
                            </init>
                        </decl>
                        ;
                    </decl_stmt>

                    <comment type="line">// find the grammar; fSchemaHandler must be known!</comment>
                    <decl_stmt>
                        <decl>
                            <type>
                                <name>SchemaGrammar</name>
                            </type>
                            <name>grammar</name> =
                            <init>
                                <expr>
                                    <call>
                                        <name><name>fSchemaHandler</name>.
                                            <name>getGrammar</name>
                                        </name>
                                        <argument_list>(
                                            <argument>
                                                <expr>
                                                    <name><name>schemaDoc</name>.
                                                        <name>fTargetNamespace</name>
                                                    </name>
                                                </expr>
                                            </argument>
                                            )
                                        </argument_list>
                                    </call>
                                </expr>
                            </init>
                        </decl>
                        ;
                    </decl_stmt>
                    <comment type="line">// fish out local attributes passed from parent</comment>
                    <decl_stmt>
                        <decl>
                            <type>
                                <name>Vector</name>
                            </type>
                            <name>annotationLocalAttrs</name> =
                            <init>
                                <expr>(<name>Vector</name>)
                                    <name>
                                        <name>parentAttrs</name>
                                        <index>[
                                            <expr>
                                                <name><name>XSAttributeChecker</name>.
                                                    <name>ATTIDX_NONSCHEMA</name>
                                                </name>
                                            </expr>
                                            ]
                                        </index>
                                    </name>
                                </expr>
                            </init>
                        </decl>
                        ;
                    </decl_stmt>
                    <comment type="line">// optimize for case where there are no local attributes</comment>
                    <if>if
                        <condition>(
                            <expr>
                                <name>annotationLocalAttrs</name>
                                != <name>null</name> &amp;&amp; !
                                <call>
                                    <name><name>annotationLocalAttrs</name>.
                                        <name>isEmpty</name>
                                    </name>
                                    <argument_list>()</argument_list>
                                </call>
                            </expr>
                            )
                        </condition>
                        <then>
                            <block>{
                                <decl_stmt>
                                    <decl>
                                        <type>
                                            <name>StringBuffer</name>
                                        </type>
                                        <name>localStrBuffer</name> =
                                        <init>
                                            <expr>new
                                                <call>
                                                    <name>StringBuffer</name>
                                                    <argument_list>(
                                                        <argument>
                                                            <expr>64</expr>
                                                        </argument>
                                                        )
                                                    </argument_list>
                                                </call>
                                            </expr>
                                        </init>
                                    </decl>
                                    ;
                                </decl_stmt>
                                <expr_stmt>
                                    <expr>
                                        <call>
                                            <name><name>localStrBuffer</name>.
                                                <name>append</name>
                                            </name>
                                            <argument_list>(
                                                <argument>
                                                    <expr>" "</expr>
                                                </argument>
                                                )
                                            </argument_list>
                                        </call>
                                    </expr>
                                    ;
                                </expr_stmt>
                                <comment type="line">// Vector should contain rawname value pairs</comment>
                                <decl_stmt>
                                    <decl>
                                        <type>
                                            <name>int</name>
                                        </type>
                                        <name>i</name> =
                                        <init>
                                            <expr>0</expr>
                                        </init>
                                    </decl>
                                    ;
                                </decl_stmt>
                                <while>while
                                    <condition>(
                                        <expr>
                                            <name>i</name>
                                            &lt;
                                            <call>
                                                <name><name>annotationLocalAttrs</name>.
                                                    <name>size</name>
                                                </name>
                                                <argument_list>()</argument_list>
                                            </call>
                                        </expr>
                                        )
                                    </condition>
                                    <block>{
                                        <decl_stmt>
                                            <decl>
                                                <type>
                                                    <name>String</name>
                                                </type>
                                                <name>rawname</name> =
                                                <init>
                                                    <expr>(<name>String</name>)
                                                        <call>
                                                            <name><name>annotationLocalAttrs</name>.
                                                                <name>elementAt</name>
                                                            </name>
                                                            <argument_list>(
                                                                <argument>
                                                                    <expr><name>i</name>++
                                                                    </expr>
                                                                </argument>
                                                                )
                                                            </argument_list>
                                                        </call>
                                                    </expr>
                                                </init>
                                            </decl>
                                            ;
                                        </decl_stmt>
                                        <decl_stmt>
                                            <decl>
                                                <type>
                                                    <name>int</name>
                                                </type>
                                                <name>colonIndex</name> =
                                                <init>
                                                    <expr>
                                                        <call>
                                                            <name><name>rawname</name>.
                                                                <name>indexOf</name>
                                                            </name>
                                                            <argument_list>(
                                                                <argument>
                                                                    <expr>':'</expr>
                                                                </argument>
                                                                )
                                                            </argument_list>
                                                        </call>
                                                    </expr>
                                                </init>
                                            </decl>
                                            ;
                                        </decl_stmt>
                                        <decl_stmt>
                                            <decl>
                                                <type>
                                                    <name>String</name>
                                                </type>
                                                <name>prefix</name>,
                                                <name>localpart</name>
                                            </decl>
                                            ;
                                        </decl_stmt>
                                        <if>if
                                            <condition>(
                                                <expr>
                                                    <name>colonIndex</name>
                                                    == -1
                                                </expr>
                                                )
                                            </condition>
                                            <then>
                                                <block>{
                                                    <expr_stmt>
                                                        <expr>
                                                            <name>prefix</name>
                                                            = ""
                                                        </expr>
                                                        ;
                                                    </expr_stmt>
                                                    <expr_stmt>
                                                        <expr>
                                                            <name>localpart</name>
                                                            =
                                                            <name>rawname</name>
                                                        </expr>
                                                        ;
                                                    </expr_stmt>
                                                    }
                                                </block>
                                            </then>
                                            <else>else
                                                <block>{
                                                    <expr_stmt>
                                                        <expr>
                                                            <name>prefix</name>
                                                            =
                                                            <call>
                                                                <name><name>rawname</name>.
                                                                    <name>substring</name>
                                                                </name>
                                                                <argument_list>(
                                                                    <argument>
                                                                        <expr>0</expr>
                                                                    </argument>
                                                                    ,
                                                                    <argument>
                                                                        <expr>
                                                                            <name>colonIndex</name>
                                                                        </expr>
                                                                    </argument>
                                                                    )
                                                                </argument_list>
                                                            </call>
                                                        </expr>
                                                        ;
                                                    </expr_stmt>
                                                    <expr_stmt>
                                                        <expr>
                                                            <name>localpart</name>
                                                            =
                                                            <call>
                                                                <name><name>rawname</name>.
                                                                    <name>substring</name>
                                                                </name>
                                                                <argument_list>(
                                                                    <argument>
                                                                        <expr><name>colonIndex</name>+1
                                                                        </expr>
                                                                    </argument>
                                                                    )
                                                                </argument_list>
                                                            </call>
                                                        </expr>
                                                        ;
                                                    </expr_stmt>
                                                    }
                                                </block>
                                            </else>
                                        </if>
                                        <decl_stmt>
                                            <decl>
                                                <type>
                                                    <name>String</name>
                                                </type>
                                                <name>uri</name> =
                                                <init>
                                                    <expr>
                                                        <call>
                                                            <name><name>schemaDoc</name>.<name>fNamespaceSupport</name>.
                                                                <name>getURI</name>
                                                            </name>
                                                            <argument_list>(
                                                                <argument>
                                                                    <expr>
                                                                        <call>
                                                                            <name><name>prefix</name>.
                                                                                <name>intern</name>
                                                                            </name>
                                                                            <argument_list>()</argument_list>
                                                                        </call>
                                                                    </expr>
                                                                </argument>
                                                                )
                                                            </argument_list>
                                                        </call>
                                                    </expr>
                                                </init>
                                            </decl>
                                            ;
                                        </decl_stmt>
                                        <expr_stmt>
                                            <expr>
                                                <call>
                                                    <name><name>localStrBuffer</name>.
                                                        <name>append</name>
                                                    </name>
                                                    <argument_list>(
                                                        <argument>
                                                            <expr>
                                                                <name>rawname</name>
                                                            </expr>
                                                        </argument>
                                                        )
                                                    </argument_list>
                                                </call>
                                                .
                                                <call>
                                                    <name>append</name>
                                                    <argument_list>(
                                                        <argument>
                                                            <expr>"=\""</expr>
                                                        </argument>
                                                        )
                                                    </argument_list>
                                                </call>
                                            </expr>
                                            ;
                                        </expr_stmt>
                                        <decl_stmt>
                                            <decl>
                                                <type>
                                                    <name>String</name>
                                                </type>
                                                <name>value</name> =
                                                <init>
                                                    <expr>(<name>String</name>)
                                                        <call>
                                                            <name><name>annotationLocalAttrs</name>.
                                                                <name>elementAt</name>
                                                            </name>
                                                            <argument_list>(
                                                                <argument>
                                                                    <expr><name>i</name>++
                                                                    </expr>
                                                                </argument>
                                                                )
                                                            </argument_list>
                                                        </call>
                                                    </expr>
                                                </init>
                                            </decl>
                                            ;
                                        </decl_stmt>
                                        <comment type="line">// search for pesky "s and &gt;s within attr value:
                                        </comment>
                                        <expr_stmt>
                                            <expr>
                                                <name>value</name>
                                                =
                                                <call>
                                                    <name>processAttValue</name>
                                                    <argument_list>(
                                                        <argument>
                                                            <expr>
                                                                <name>value</name>
                                                            </expr>
                                                        </argument>
                                                        )
                                                    </argument_list>
                                                </call>
                                            </expr>
                                            ;
                                        </expr_stmt>
                                        <expr_stmt>
                                            <expr>
                                                <call>
                                                    <name><name>localStrBuffer</name>.
                                                        <name>append</name>
                                                    </name>
                                                    <argument_list>(
                                                        <argument>
                                                            <expr>
                                                                <name>value</name>
                                                            </expr>
                                                        </argument>
                                                        )
                                                    </argument_list>
                                                </call>
                                                .
                                                <call>
                                                    <name>append</name>
                                                    <argument_list>(
                                                        <argument>
                                                            <expr>"\" "</expr>
                                                        </argument>
                                                        )
                                                    </argument_list>
                                                </call>
                                            </expr>
                                            ;
                                        </expr_stmt>
                                        }
                                    </block>
                                </while>
                                <comment type="line">// and now splice it into place; immediately after the annotation
                                    token, for simplicity's sake
                                </comment>
                                <decl_stmt>
                                    <decl>
                                        <type>
                                            <name>StringBuffer</name>
                                        </type>
                                        <name>contentBuffer</name> =
                                        <init>
                                            <expr>new
                                                <call>
                                                    <name>StringBuffer</name>
                                                    <argument_list>(
                                                        <argument>
                                                            <expr>
                                                                <call>
                                                                    <name><name>contents</name>.
                                                                        <name>length</name>
                                                                    </name>
                                                                    <argument_list>()</argument_list>
                                                                </call>
                                                                +
                                                                <call>
                                                                    <name><name>localStrBuffer</name>.
                                                                        <name>length</name>
                                                                    </name>
                                                                    <argument_list>()</argument_list>
                                                                </call>
                                                            </expr>
                                                        </argument>
                                                        )
                                                    </argument_list>
                                                </call>
                                            </expr>
                                        </init>
                                    </decl>
                                    ;
                                </decl_stmt>
                                <decl_stmt>
                                    <decl>
                                        <type>
                                            <name>int</name>
                                        </type>
                                        <name>annotationTokenEnd</name> =
                                        <init>
                                            <expr>
                                                <call>
                                                    <name><name>contents</name>.
                                                        <name>indexOf</name>
                                                    </name>
                                                    <argument_list>(
                                                        <argument>
                                                            <expr>
                                                                <name><name>SchemaSymbols</name>.
                                                                    <name>ELT_ANNOTATION</name>
                                                                </name>
                                                            </expr>
                                                        </argument>
                                                        )
                                                    </argument_list>
                                                </call>
                                            </expr>
                                        </init>
                                    </decl>
                                    ;
                                </decl_stmt>
                                <comment type="line">// annotation must occur somewhere or we're in big trouble...
                                </comment>
                                <if>if
                                    <condition>(
                                        <expr>
                                            <name>annotationTokenEnd</name>
                                            == -1
                                        </expr>
                                        )
                                    </condition>
                                    <then>
                                        <return>return
                                            <expr>
                                                <name>null</name>
                                            </expr>
                                            ;
                                        </return>
                                    </then>
                                </if>
                                <expr_stmt>
                                    <expr>
                                        <name>annotationTokenEnd</name>
                                        +=
                                        <call>
                                            <name><name>SchemaSymbols</name>.<name>ELT_ANNOTATION</name>.
                                                <name>length</name>
                                            </name>
                                            <argument_list>()</argument_list>
                                        </call>
                                    </expr>
                                    ;
                                </expr_stmt>
                                <expr_stmt>
                                    <expr>
                                        <call>
                                            <name><name>contentBuffer</name>.
                                                <name>append</name>
                                            </name>
                                            <argument_list>(
                                                <argument>
                                                    <expr>
                                                        <call>
                                                            <name><name>contents</name>.
                                                                <name>substring</name>
                                                            </name>
                                                            <argument_list>(
                                                                <argument>
                                                                    <expr>0</expr>
                                                                </argument>
                                                                ,
                                                                <argument>
                                                                    <expr>
                                                                        <name>annotationTokenEnd</name>
                                                                    </expr>
                                                                </argument>
                                                                )
                                                            </argument_list>
                                                        </call>
                                                    </expr>
                                                </argument>
                                                )
                                            </argument_list>
                                        </call>
                                    </expr>
                                    ;
                                </expr_stmt>
                                <expr_stmt>
                                    <expr>
                                        <call>
                                            <name><name>contentBuffer</name>.
                                                <name>append</name>
                                            </name>
                                            <argument_list>(
                                                <argument>
                                                    <expr>
                                                        <call>
                                                            <name><name>localStrBuffer</name>.
                                                                <name>toString</name>
                                                            </name>
                                                            <argument_list>()</argument_list>
                                                        </call>
                                                    </expr>
                                                </argument>
                                                )
                                            </argument_list>
                                        </call>
                                    </expr>
                                    ;
                                </expr_stmt>
                                <expr_stmt>
                                    <expr>
                                        <call>
                                            <name><name>contentBuffer</name>.
                                                <name>append</name>
                                            </name>
                                            <argument_list>(
                                                <argument>
                                                    <expr>
                                                        <call>
                                                            <name><name>contents</name>.
                                                                <name>substring</name>
                                                            </name>
                                                            <argument_list>(
                                                                <argument>
                                                                    <expr>
                                                                        <name>annotationTokenEnd</name>
                                                                    </expr>
                                                                </argument>
                                                                ,
                                                                <argument>
                                                                    <expr>
                                                                        <call>
                                                                            <name><name>contents</name>.
                                                                                <name>length</name>
                                                                            </name>
                                                                            <argument_list>()</argument_list>
                                                                        </call>
                                                                    </expr>
                                                                </argument>
                                                                )
                                                            </argument_list>
                                                        </call>
                                                    </expr>
                                                </argument>
                                                )
                                            </argument_list>
                                        </call>
                                    </expr>
                                    ;
                                </expr_stmt>
                                <decl_stmt>
                                    <decl>
                                        <type>
                                            <specifier>final</specifier>
                                            <name>String</name>
                                        </type>
                                        <name>annotation</name> =
                                        <init>
                                            <expr>
                                                <call>
                                                    <name><name>contentBuffer</name>.
                                                        <name>toString</name>
                                                    </name>
                                                    <argument_list>()</argument_list>
                                                </call>
                                            </expr>
                                        </init>
                                    </decl>
                                    ;
                                </decl_stmt>
                                <if>if
                                    <condition>(
                                        <expr>
                                            <name>fValidateAnnotations</name>
                                        </expr>
                                        )
                                    </condition>
                                    <then>
                                        <block>{
                                            <expr_stmt>
                                                <expr>
                                                    <call>
                                                        <name><name>schemaDoc</name>.
                                                            <name>addAnnotation</name>
                                                        </name>
                                                        <argument_list>(
                                                            <argument>
                                                                <expr>new
                                                                    <call>
                                                                        <name>XSAnnotationInfo</name>
                                                                        <argument_list>(
                                                                            <argument>
                                                                                <expr>
                                                                                    <name>annotation</name>
                                                                                </expr>
                                                                            </argument>
                                                                            ,
                                                                            <argument>
                                                                                <expr>
                                                                                    <name>annotationParent</name>
                                                                                </expr>
                                                                            </argument>
                                                                            )
                                                                        </argument_list>
                                                                    </call>
                                                                </expr>
                                                            </argument>
                                                            )
                                                        </argument_list>
                                                    </call>
                                                </expr>
                                                ;
                                            </expr_stmt>
                                            }
                                        </block>
                                    </then>
                                </if>
                                <return>return
                                    <expr>new
                                        <call>
                                            <name>XSAnnotationImpl</name>
                                            <argument_list>(
                                                <argument>
                                                    <expr>
                                                        <name>annotation</name>
                                                    </expr>
                                                </argument>
                                                ,
                                                <argument>
                                                    <expr>
                                                        <name>grammar</name>
                                                    </expr>
                                                </argument>
                                                )
                                            </argument_list>
                                        </call>
                                    </expr>
                                    ;
                                </return>
                                }
                            </block>
                        </then>
                        <else>else
                            <block>{
                                <if>if
                                    <condition>(
                                        <expr>
                                            <name>fValidateAnnotations</name>
                                        </expr>
                                        )
                                    </condition>
                                    <then>
                                        <block>{
                                            <expr_stmt>
                                                <expr>
                                                    <call>
                                                        <name><name>schemaDoc</name>.
                                                            <name>addAnnotation</name>
                                                        </name>
                                                        <argument_list>(
                                                            <argument>
                                                                <expr>new
                                                                    <call>
                                                                        <name>XSAnnotationInfo</name>
                                                                        <argument_list>(
                                                                            <argument>
                                                                                <expr>
                                                                                    <name>contents</name>
                                                                                </expr>
                                                                            </argument>
                                                                            ,
                                                                            <argument>
                                                                                <expr>
                                                                                    <name>annotationParent</name>
                                                                                </expr>
                                                                            </argument>
                                                                            )
                                                                        </argument_list>
                                                                    </call>
                                                                </expr>
                                                            </argument>
                                                            )
                                                        </argument_list>
                                                    </call>
                                                </expr>
                                                ;
                                            </expr_stmt>
                                            }
                                        </block>
                                    </then>
                                </if>
                                <return>return
                                    <expr>new
                                        <call>
                                            <name>XSAnnotationImpl</name>
                                            <argument_list>(
                                                <argument>
                                                    <expr>
                                                        <name>contents</name>
                                                    </expr>
                                                </argument>
                                                ,
                                                <argument>
                                                    <expr>
                                                        <name>grammar</name>
                                                    </expr>
                                                </argument>
                                                )
                                            </argument_list>
                                        </call>
                                    </expr>
                                    ;
                                </return>
                                }
                            </block>
                        </else>
                    </if>
                    }
                </block>
            </function>

            <comment type="line">// the QName simple type used to resolve qnames</comment>
            <decl_stmt>
                <decl>
                    <type>
                        <specifier>private</specifier>
                        <specifier>static</specifier>
                        <specifier>final</specifier>
                        <name>XSSimpleType</name>
                    </type>
                    <name>fQNameDV</name> =
                    <init>
                        <expr>(<name>XSSimpleType</name>)
                            <call>
                                <name><name>SchemaGrammar</name>.<name>SG_SchemaNS</name>.
                                    <name>getGlobalTypeDecl</name>
                                </name>
                                <argument_list>(
                                    <argument>
                                        <expr>
                                            <name><name>SchemaSymbols</name>.
                                                <name>ATTVAL_QNAME</name>
                                            </name>
                                        </expr>
                                    </argument>
                                    )
                                </argument_list>
                            </call>
                        </expr>
                    </init>
                </decl>
                ;
            </decl_stmt>
            <comment type="line">// Temp data structures to be re-used in traversing facets</comment>
            <decl_stmt>
                <decl>
                    <type>
                        <specifier>private</specifier>
                        <name>StringBuffer</name>
                    </type>
                    <name>fPattern</name> =
                    <init>
                        <expr>new
                            <call>
                                <name>StringBuffer</name>
                                <argument_list>()</argument_list>
                            </call>
                        </expr>
                    </init>
                </decl>
                ;
            </decl_stmt>
            <decl_stmt>
                <decl>
                    <type>
                        <specifier>private</specifier>
                        <specifier>final</specifier>
                        <name>XSFacets</name>
                    </type>
                    <name>xsFacets</name> =
                    <init>
                        <expr>new
                            <call>
                                <name>XSFacets</name>
                                <argument_list>()</argument_list>
                            </call>
                        </expr>
                    </init>
                </decl>
                ;
            </decl_stmt>

            <class>class <name>FacetInfo</name>
                <block>{
                    <decl_stmt>
                        <decl>
                            <type>
                                <name>XSFacets</name>
                            </type>
                            <name>facetdata</name>
                        </decl>
                        ;
                    </decl_stmt>
                    <decl_stmt>
                        <decl>
                            <type>
                                <name>Element</name>
                            </type>
                            <name>nodeAfterFacets</name>
                        </decl>
                        ;
                    </decl_stmt>
                    <decl_stmt>
                        <decl>
                            <type>
                                <name>short</name>
                            </type>
                            <name>fPresentFacets</name>
                        </decl>
                        ;
                    </decl_stmt>
                    <decl_stmt>
                        <decl>
                            <type>
                                <name>short</name>
                            </type>
                            <name>fFixedFacets</name>
                        </decl>
                        ;
                    </decl_stmt>
                    }
                </block>
            </class>

            <function>
                <type>
                    <name>FacetInfo</name>
                </type>
                <name>traverseFacets</name>
                <parameter_list>(
                    <param>
                        <decl>
                            <type>
                                <name>Element</name>
                            </type>
                            <name>content</name>
                        </decl>
                    </param>
                    ,
                    <param>
                        <decl>
                            <type>
                                <name>XSSimpleType</name>
                            </type>
                            <name>baseValidator</name>
                        </decl>
                    </param>
                    ,
                    <param>
                        <decl>
                            <type>
                                <name>XSDocumentInfo</name>
                            </type>
                            <name>schemaDoc</name>
                        </decl>
                    </param>
                    )
                </parameter_list>
                <block>{

                    <decl_stmt>
                        <decl>
                            <type>
                                <name>short</name>
                            </type>
                            <name>facetsPresent</name> =
                            <init>
                                <expr>0</expr>
                            </init>
                        </decl>
                        ;
                    </decl_stmt>
                    <decl_stmt>
                        <decl>
                            <type>
                                <name>short</name>
                            </type>
                            <name>facetsFixed</name> =
                            <init>
                                <expr>0</expr>
                            </init>
                        </decl>
                        ;
                    </decl_stmt>
                    <comment type="line">// facets that have fixed="true"</comment>
                    <decl_stmt>
                        <decl>
                            <type>
                                <name>String</name>
                            </type>
                            <name>facet</name>
                        </decl>
                        ;
                    </decl_stmt>
                    <decl_stmt>
                        <decl>
                            <type>
                                <name>boolean</name>
                            </type>
                            <name>hasQName</name> =
                            <init>
                                <expr>
                                    <call>
                                        <name>containsQName</name>
                                        <argument_list>(
                                            <argument>
                                                <expr>
                                                    <name>baseValidator</name>
                                                </expr>
                                            </argument>
                                            )
                                        </argument_list>
                                    </call>
                                </expr>
                            </init>
                        </decl>
                        ;
                    </decl_stmt>
                    <decl_stmt>
                        <decl>
                            <type>
                                <name>Vector</name>
                            </type>
                            <name>enumData</name> =
                            <init>
                                <expr>
                                    <name>null</name>
                                </expr>
                            </init>
                        </decl>
                        ;
                    </decl_stmt>
                    <decl_stmt>
                        <decl>
                            <type>
                                <name>XSObjectListImpl</name>
                            </type>
                            <name>enumAnnotations</name> =
                            <init>
                                <expr>
                                    <name>null</name>
                                </expr>
                            </init>
                        </decl>
                        ;
                    </decl_stmt>
                    <decl_stmt>
                        <decl>
                            <type>
                                <name>XSObjectListImpl</name>
                            </type>
                            <name>patternAnnotations</name> =
                            <init>
                                <expr>
                                    <name>null</name>
                                </expr>
                            </init>
                        </decl>
                        ;
                    </decl_stmt>
                    <decl_stmt>
                        <decl>
                            <type>
                                <name>Vector</name>
                            </type>
                            <name>enumNSDecls</name> =
                            <init>
                                <expr>
                                    <name>hasQName</name>
                                    ? new
                                    <call>
                                        <name>Vector</name>
                                        <argument_list>()</argument_list>
                                    </call>
                                    :
                                    <name>null</name>
                                </expr>
                            </init>
                        </decl>
                        ;
                    </decl_stmt>
                    <decl_stmt>
                        <decl>
                            <type>
                                <name>int</name>
                            </type>
                            <name>currentFacet</name> =
                            <init>
                                <expr>0</expr>
                            </init>
                        </decl>
                        ;
                    </decl_stmt>
                    <expr_stmt>
                        <expr>
                            <call>
                                <name><name>xsFacets</name>.
                                    <name>reset</name>
                                </name>
                                <argument_list>()</argument_list>
                            </call>
                        </expr>
                        ;
                    </expr_stmt>
                    <while>while
                        <condition>(
                            <expr>
                                <name>content</name>
                                !=
                                <name>null</name>
                            </expr>
                            )
                        </condition>
                        <block>{
                            <comment type="line">// General Attribute Checking</comment>
                            <decl_stmt>
                                <decl>
                                    <type>
                                        <name>Object</name>
                                        <index>[]</index>
                                    </type>
                                    <name>attrs</name> =
                                    <init>
                                        <expr>
                                            <name>null</name>
                                        </expr>
                                    </init>
                                </decl>
                                ;
                            </decl_stmt>
                            <expr_stmt>
                                <expr>
                                    <name>facet</name>
                                    =
                                    <call>
                                        <name><name>DOMUtil</name>.
                                            <name>getLocalName</name>
                                        </name>
                                        <argument_list>(
                                            <argument>
                                                <expr>
                                                    <name>content</name>
                                                </expr>
                                            </argument>
                                            )
                                        </argument_list>
                                    </call>
                                </expr>
                                ;
                            </expr_stmt>
                            <if>if
                                <condition>(
                                    <expr>
                                        <call>
                                            <name><name>facet</name>.
                                                <name>equals</name>
                                            </name>
                                            <argument_list>(
                                                <argument>
                                                    <expr>
                                                        <name><name>SchemaSymbols</name>.
                                                            <name>ELT_ENUMERATION</name>
                                                        </name>
                                                    </expr>
                                                </argument>
                                                )
                                            </argument_list>
                                        </call>
                                    </expr>
                                    )
                                </condition>
                                <then>
                                    <block>{
                                        <expr_stmt>
                                            <expr>
                                                <name>attrs</name>
                                                =
                                                <call>
                                                    <name><name>fAttrChecker</name>.
                                                        <name>checkAttributes</name>
                                                    </name>
                                                    <argument_list>(
                                                        <argument>
                                                            <expr>
                                                                <name>content</name>
                                                            </expr>
                                                        </argument>
                                                        ,
                                                        <argument>
                                                            <expr>false</expr>
                                                        </argument>
                                                        ,
                                                        <argument>
                                                            <expr>
                                                                <name>schemaDoc</name>
                                                            </expr>
                                                        </argument>
                                                        ,
                                                        <argument>
                                                            <expr>
                                                                <name>hasQName</name>
                                                            </expr>
                                                        </argument>
                                                        )
                                                    </argument_list>
                                                </call>
                                            </expr>
                                            ;
                                        </expr_stmt>
                                        <decl_stmt>
                                            <decl>
                                                <type>
                                                    <name>String</name>
                                                </type>
                                                <name>enumVal</name> =
                                                <init>
                                                    <expr>(<name>String</name>)
                                                        <name>
                                                            <name>attrs</name>
                                                            <index>[
                                                                <expr>
                                                                    <name><name>XSAttributeChecker</name>.
                                                                        <name>ATTIDX_VALUE</name>
                                                                    </name>
                                                                </expr>
                                                                ]
                                                            </index>
                                                        </name>
                                                    </expr>
                                                </init>
                                            </decl>
                                            ;
                                        </decl_stmt>
                                        <decl_stmt>
                                            <decl>
                                                <type>
                                                    <name>NamespaceSupport</name>
                                                </type>
                                                <name>nsDecls</name> =
                                                <init>
                                                    <expr>(<name>NamespaceSupport</name>)
                                                        <name>
                                                            <name>attrs</name>
                                                            <index>[
                                                                <expr>
                                                                    <name><name>XSAttributeChecker</name>.
                                                                        <name>ATTIDX_ENUMNSDECLS</name>
                                                                    </name>
                                                                </expr>
                                                                ]
                                                            </index>
                                                        </name>
                                                    </expr>
                                                </init>
                                            </decl>
                                            ;
                                        </decl_stmt>

                                        <comment type="line">// for NOTATION types, need to check whether there is a
                                            notation
                                        </comment>
                                        <comment type="line">// declared with the same name as the enumeration value.
                                        </comment>
                                        <if>if
                                            <condition>(
                                                <expr>
                                                    <call>
                                                        <name><name>baseValidator</name>.
                                                            <name>getVariety</name>
                                                        </name>
                                                        <argument_list>()</argument_list>
                                                    </call>
                                                    ==
                                                    <name><name>XSSimpleType</name>.
                                                        <name>VARIETY_ATOMIC</name>
                                                    </name>
                                                    &amp;&amp;
                                                    <call>
                                                        <name><name>baseValidator</name>.
                                                            <name>getPrimitiveKind</name>
                                                        </name>
                                                        <argument_list>()</argument_list>
                                                    </call>
                                                    ==
                                                    <name><name>XSSimpleType</name>.
                                                        <name>PRIMITIVE_NOTATION</name>
                                                    </name>
                                                </expr>
                                                )
                                            </condition>
                                            <then>
                                                <block>{
                                                    <comment type="line">// need to use the namespace context returned
                                                        from checkAttributes
                                                    </comment>
                                                    <expr_stmt>
                                                        <expr>
                                                            <call>
                                                                <name><name>schemaDoc</name>.<name>
                                                                    fValidationContext</name>.
                                                                    <name>setNamespaceSupport</name>
                                                                </name>
                                                                <argument_list>(
                                                                    <argument>
                                                                        <expr>
                                                                            <name>nsDecls</name>
                                                                        </expr>
                                                                    </argument>
                                                                    )
                                                                </argument_list>
                                                            </call>
                                                        </expr>
                                                        ;
                                                    </expr_stmt>
                                                    <try>try
                                                        <block>{
                                                            <decl_stmt>
                                                                <decl>
                                                                    <type>
                                                                        <name>QName</name>
                                                                    </type>
                                                                    <name>temp</name> =
                                                                    <init>
                                                                        <expr>(<name>QName</name>)
                                                                            <call>
                                                                                <name><name>fQNameDV</name>.
                                                                                    <name>validate</name>
                                                                                </name>
                                                                                <argument_list>(
                                                                                    <argument>
                                                                                        <expr>
                                                                                            <name>enumVal</name>
                                                                                        </expr>
                                                                                    </argument>
                                                                                    ,
                                                                                    <argument>
                                                                                        <expr>
                                                                                            <name><name>schemaDoc</name>
                                                                                                .
                                                                                                <name>
                                                                                                    fValidationContext
                                                                                                </name>
                                                                                            </name>
                                                                                        </expr>
                                                                                    </argument>
                                                                                    ,
                                                                                    <argument>
                                                                                        <expr>
                                                                                            <name>null</name>
                                                                                        </expr>
                                                                                    </argument>
                                                                                    )
                                                                                </argument_list>
                                                                            </call>
                                                                        </expr>
                                                                    </init>
                                                                </decl>
                                                                ;
                                                            </decl_stmt>
                                                            <comment type="line">// try to get the notation decl. if
                                                                failed, getGlobalDecl
                                                            </comment>
                                                            <comment type="line">// reports an error, so we don't need
                                                                to report one again.
                                                            </comment>
                                                            <expr_stmt>
                                                                <expr>
                                                                    <call>
                                                                        <name><name>fSchemaHandler</name>.
                                                                            <name>getGlobalDecl</name>
                                                                        </name>
                                                                        <argument_list>(
                                                                            <argument>
                                                                                <expr>
                                                                                    <name>schemaDoc</name>
                                                                                </expr>
                                                                            </argument>
                                                                            ,
                                                                            <argument>
                                                                                <expr>
                                                                                    <name><name>XSDHandler</name>.
                                                                                        <name>NOTATION_TYPE</name>
                                                                                    </name>
                                                                                </expr>
                                                                            </argument>
                                                                            ,
                                                                            <argument>
                                                                                <expr>
                                                                                    <name>temp</name>
                                                                                </expr>
                                                                            </argument>
                                                                            ,
                                                                            <argument>
                                                                                <expr>
                                                                                    <name>content</name>
                                                                                </expr>
                                                                            </argument>
                                                                            )
                                                                        </argument_list>
                                                                    </call>
                                                                </expr>
                                                                ;
                                                            </expr_stmt>
                                                            }
                                                        </block>
                                                        <catch>catch(
                                                            <param>
                                                                <decl>
                                                                    <type>
                                                                        <name>InvalidDatatypeValueException</name>
                                                                    </type>
                                                                    <name>ex</name>
                                                                </decl>
                                                            </param>
                                                            )
                                                            <block>{
                                                                <expr_stmt>
                                                                    <expr>
                                                                        <call>
                                                                            <name>reportSchemaError</name>
                                                                            <argument_list>(
                                                                                <argument>
                                                                                    <expr>
                                                                                        <call>
                                                                                            <name><name>ex</name>.
                                                                                                <name>getKey</name>
                                                                                            </name>
                                                                                            <argument_list>()
                                                                                            </argument_list>
                                                                                        </call>
                                                                                    </expr>
                                                                                </argument>
                                                                                ,
                                                                                <argument>
                                                                                    <expr>
                                                                                        <call>
                                                                                            <name><name>ex</name>.
                                                                                                <name>getArgs</name>
                                                                                            </name>
                                                                                            <argument_list>()
                                                                                            </argument_list>
                                                                                        </call>
                                                                                    </expr>
                                                                                </argument>
                                                                                ,
                                                                                <argument>
                                                                                    <expr>
                                                                                        <name>content</name>
                                                                                    </expr>
                                                                                </argument>
                                                                                )
                                                                            </argument_list>
                                                                        </call>
                                                                    </expr>
                                                                    ;
                                                                </expr_stmt>
                                                                }
                                                            </block>
                                                        </catch>
                                                    </try>
                                                    <comment type="line">// restore to the normal namespace context
                                                    </comment>
                                                    <expr_stmt>
                                                        <expr>
                                                            <call>
                                                                <name><name>schemaDoc</name>.<name>
                                                                    fValidationContext</name>.
                                                                    <name>setNamespaceSupport</name>
                                                                </name>
                                                                <argument_list>(
                                                                    <argument>
                                                                        <expr>
                                                                            <name><name>schemaDoc</name>.
                                                                                <name>fNamespaceSupport</name>
                                                                            </name>
                                                                        </expr>
                                                                    </argument>
                                                                    )
                                                                </argument_list>
                                                            </call>
                                                        </expr>
                                                        ;
                                                    </expr_stmt>
                                                    }
                                                </block>
                                            </then>
                                        </if>
                                        <if>if
                                            <condition>(
                                                <expr>
                                                    <name>enumData</name>
                                                    ==
                                                    <name>null</name>
                                                </expr>
                                                )
                                            </condition>
                                            <then>
                                                <block>{
                                                    <expr_stmt>
                                                        <expr>
                                                            <name>enumData</name>
                                                            = new
                                                            <call>
                                                                <name>Vector</name>
                                                                <argument_list>()</argument_list>
                                                            </call>
                                                        </expr>
                                                        ;
                                                    </expr_stmt>
                                                    <expr_stmt>
                                                        <expr>
                                                            <name>enumAnnotations</name>
                                                            = new
                                                            <call>
                                                                <name>XSObjectListImpl</name>
                                                                <argument_list>()</argument_list>
                                                            </call>
                                                        </expr>
                                                        ;
                                                    </expr_stmt>
                                                    }
                                                </block>
                                            </then>
                                        </if>
                                        <expr_stmt>
                                            <expr>
                                                <call>
                                                    <name><name>enumData</name>.
                                                        <name>addElement</name>
                                                    </name>
                                                    <argument_list>(
                                                        <argument>
                                                            <expr>
                                                                <name>enumVal</name>
                                                            </expr>
                                                        </argument>
                                                        )
                                                    </argument_list>
                                                </call>
                                            </expr>
                                            ;
                                        </expr_stmt>
                                        <expr_stmt>
                                            <expr>
                                                <call>
                                                    <name><name>enumAnnotations</name>.
                                                        <name>add</name>
                                                    </name>
                                                    <argument_list>(
                                                        <argument>
                                                            <expr>
                                                                <name>null</name>
                                                            </expr>
                                                        </argument>
                                                        )
                                                    </argument_list>
                                                </call>
                                            </expr>
                                            ;
                                        </expr_stmt>
                                        <if>if
                                            <condition>(
                                                <expr>
                                                    <name>hasQName</name>
                                                </expr>
                                                )
                                            </condition>
                                            <then>
                                                <expr_stmt>
                                                    <expr>
                                                        <call>
                                                            <name><name>enumNSDecls</name>.
                                                                <name>addElement</name>
                                                            </name>
                                                            <argument_list>(
                                                                <argument>
                                                                    <expr>
                                                                        <name>nsDecls</name>
                                                                    </expr>
                                                                </argument>
                                                                )
                                                            </argument_list>
                                                        </call>
                                                    </expr>
                                                    ;
                                                </expr_stmt>
                                            </then>
                                        </if>
                                        <decl_stmt>
                                            <decl>
                                                <type>
                                                    <name>Element</name>
                                                </type>
                                                <name>child</name> =
                                                <init>
                                                    <expr>
                                                        <call>
                                                            <name><name>DOMUtil</name>.
                                                                <name>getFirstChildElement</name>
                                                            </name>
                                                            <argument_list>(
                                                                <argument>
                                                                    <expr>
                                                                        <name>content</name>
                                                                    </expr>
                                                                </argument>
                                                                )
                                                            </argument_list>
                                                        </call>
                                                    </expr>
                                                </init>
                                            </decl>
                                            ;
                                        </decl_stmt>

                                        <if>if
                                            <condition>(
                                                <expr>
                                                    <name>child</name>
                                                    !=
                                                    <name>null</name>
                                                </expr>
                                                )
                                            </condition>
                                            <then>
                                                <block>{
                                                    <comment type="line">// traverse annotation if any</comment>

                                                    <if>if
                                                        <condition>(
                                                            <expr>
                                                                <call>
                                                                    <name><name>DOMUtil</name>.
                                                                        <name>getLocalName</name>
                                                                    </name>
                                                                    <argument_list>(
                                                                        <argument>
                                                                            <expr>
                                                                                <name>child</name>
                                                                            </expr>
                                                                        </argument>
                                                                        )
                                                                    </argument_list>
                                                                </call>
                                                                .
                                                                <call>
                                                                    <name>equals</name>
                                                                    <argument_list>(
                                                                        <argument>
                                                                            <expr>
                                                                                <name><name>SchemaSymbols</name>.
                                                                                    <name>ELT_ANNOTATION</name>
                                                                                </name>
                                                                            </expr>
                                                                        </argument>
                                                                        )
                                                                    </argument_list>
                                                                </call>
                                                            </expr>
                                                            )
                                                        </condition>
                                                        <then>
                                                            <block>{
                                                                <expr_stmt>
                                                                    <expr>
                                                                        <call>
                                                                            <name><name>enumAnnotations</name>.
                                                                                <name>add</name>
                                                                            </name>
                                                                            <argument_list>(
                                                                                <argument>
                                                                                    <expr>
                                                                                        <call>
                                                                                            <name><name>
                                                                                                enumAnnotations</name>.
                                                                                                <name>getLength</name>
                                                                                            </name>
                                                                                            <argument_list>()
                                                                                            </argument_list>
                                                                                        </call>
                                                                                        -1
                                                                                    </expr>
                                                                                </argument>
                                                                                ,
                                                                                <argument>
                                                                                    <expr>
                                                                                        <call>
                                                                                            <name>
                                                                                                traverseAnnotationDecl
                                                                                            </name>
                                                                                            <argument_list>(
                                                                                                <argument>
                                                                                                    <expr>
                                                                                                        <name>child
                                                                                                        </name>
                                                                                                    </expr>
                                                                                                </argument>
                                                                                                ,
                                                                                                <argument>
                                                                                                    <expr>
                                                                                                        <name>attrs
                                                                                                        </name>
                                                                                                    </expr>
                                                                                                </argument>
                                                                                                ,
                                                                                                <argument>
                                                                                                    <expr>false</expr>
                                                                                                </argument>
                                                                                                ,
                                                                                                <argument>
                                                                                                    <expr>
                                                                                                        <name>
                                                                                                            schemaDoc
                                                                                                        </name>
                                                                                                    </expr>
                                                                                                </argument>
                                                                                                )
                                                                                            </argument_list>
                                                                                        </call>
                                                                                    </expr>
                                                                                </argument>
                                                                                )
                                                                            </argument_list>
                                                                        </call>
                                                                    </expr>
                                                                    ;
                                                                </expr_stmt>
                                                                <expr_stmt>
                                                                    <expr>
                                                                        <name>child</name>
                                                                        =
                                                                        <call>
                                                                            <name><name>DOMUtil</name>.
                                                                                <name>getNextSiblingElement</name>
                                                                            </name>
                                                                            <argument_list>(
                                                                                <argument>
                                                                                    <expr>
                                                                                        <name>child</name>
                                                                                    </expr>
                                                                                </argument>
                                                                                )
                                                                            </argument_list>
                                                                        </call>
                                                                    </expr>
                                                                    ;
                                                                </expr_stmt>
                                                                }
                                                            </block>
                                                        </then>
                                                        <else>else
                                                            <block>{
                                                                <decl_stmt>
                                                                    <decl>
                                                                        <type>
                                                                            <name>String</name>
                                                                        </type>
                                                                        <name>text</name> =
                                                                        <init>
                                                                            <expr>
                                                                                <call>
                                                                                    <name><name>DOMUtil</name>.
                                                                                        <name>getSyntheticAnnotation
                                                                                        </name>
                                                                                    </name>
                                                                                    <argument_list>(
                                                                                        <argument>
                                                                                            <expr>
                                                                                                <name>content</name>
                                                                                            </expr>
                                                                                        </argument>
                                                                                        )
                                                                                    </argument_list>
                                                                                </call>
                                                                            </expr>
                                                                        </init>
                                                                    </decl>
                                                                    ;
                                                                </decl_stmt>
                                                                <if>if
                                                                    <condition>(
                                                                        <expr>
                                                                            <name>text</name>
                                                                            !=
                                                                            <name>null</name>
                                                                        </expr>
                                                                        )
                                                                    </condition>
                                                                    <then>
                                                                        <block>{
                                                                            <expr_stmt>
                                                                                <expr>
                                                                                    <call>
                                                                                        <name><name>
                                                                                            enumAnnotations</name>.
                                                                                            <name>add</name>
                                                                                        </name>
                                                                                        <argument_list>(
                                                                                            <argument>
                                                                                                <expr>
                                                                                                    <call>
                                                                                                        <name><name>
                                                                                                            enumAnnotations</name>
                                                                                                            .
                                                                                                            <name>
                                                                                                                getLength
                                                                                                            </name>
                                                                                                        </name>
                                                                                                        <argument_list>
                                                                                                            ()
                                                                                                        </argument_list>
                                                                                                    </call>
                                                                                                    -1
                                                                                                </expr>
                                                                                            </argument>
                                                                                            ,
                                                                                            <argument>
                                                                                                <expr>
                                                                                                    <call>
                                                                                                        <name>
                                                                                                            traverseSyntheticAnnotation
                                                                                                        </name>
                                                                                                        <argument_list>(
                                                                                                            <argument>
                                                                                                                <expr>
                                                                                                                    <name>
                                                                                                                        content
                                                                                                                    </name>
                                                                                                                </expr>
                                                                                                            </argument>
                                                                                                            ,
                                                                                                            <argument>
                                                                                                                <expr>
                                                                                                                    <name>
                                                                                                                        text
                                                                                                                    </name>
                                                                                                                </expr>
                                                                                                            </argument>
                                                                                                            ,
                                                                                                            <argument>
                                                                                                                <expr>
                                                                                                                    <name>
                                                                                                                        attrs
                                                                                                                    </name>
                                                                                                                </expr>
                                                                                                            </argument>
                                                                                                            ,
                                                                                                            <argument>
                                                                                                                <expr>
                                                                                                                    false
                                                                                                                </expr>
                                                                                                            </argument>
                                                                                                            ,
                                                                                                            <argument>
                                                                                                                <expr>
                                                                                                                    <name>
                                                                                                                        schemaDoc
                                                                                                                    </name>
                                                                                                                </expr>
                                                                                                            </argument>
                                                                                                            )
                                                                                                        </argument_list>
                                                                                                    </call>
                                                                                                </expr>
                                                                                            </argument>
                                                                                            )
                                                                                        </argument_list>
                                                                                    </call>
                                                                                </expr>
                                                                                ;
                                                                            </expr_stmt>
                                                                            }
                                                                        </block>
                                                                    </then>
                                                                </if>
                                                                }
                                                            </block>
                                                        </else>
                                                    </if>
                                                    <if>if
                                                        <condition>(
                                                            <expr>
                                                                <name>child</name>
                                                                !=<name>null</name> &amp;&amp;
                                                                <call>
                                                                    <name><name>DOMUtil</name>.
                                                                        <name>getLocalName</name>
                                                                    </name>
                                                                    <argument_list>(
                                                                        <argument>
                                                                            <expr>
                                                                                <name>child</name>
                                                                            </expr>
                                                                        </argument>
                                                                        )
                                                                    </argument_list>
                                                                </call>
                                                                .
                                                                <call>
                                                                    <name>equals</name>
                                                                    <argument_list>(
                                                                        <argument>
                                                                            <expr>
                                                                                <name><name>SchemaSymbols</name>.
                                                                                    <name>ELT_ANNOTATION</name>
                                                                                </name>
                                                                            </expr>
                                                                        </argument>
                                                                        )
                                                                    </argument_list>
                                                                </call>
                                                            </expr>
                                                            )
                                                        </condition>
                                                        <then>
                                                            <block>{
                                                                <expr_stmt>
                                                                    <expr>
                                                                        <call>
                                                                            <name>reportSchemaError</name>
                                                                            <argument_list>(
                                                                                <argument>
                                                                                    <expr>"s4s-elt-must-match.1"</expr>
                                                                                </argument>
                                                                                ,
                                                                                <argument>
                                                                                    <expr>new
                                                                                        <name>
                                                                                            <name>Object</name>
                                                                                            <index>[]</index>
                                                                                        </name>
                                                                                        <block>{<expr>
                                                                                            "enumeration"</expr>, <expr>
                                                                                            "(annotation?)"</expr>,
                                                                                            <expr>
                                                                                                <call>
                                                                                                    <name><name>
                                                                                                        DOMUtil</name>.
                                                                                                        <name>
                                                                                                            getLocalName
                                                                                                        </name>
                                                                                                    </name>
                                                                                                    <argument_list>(
                                                                                                        <argument>
                                                                                                            <expr>
                                                                                                                <name>
                                                                                                                    child
                                                                                                                </name>
                                                                                                            </expr>
                                                                                                        </argument>
                                                                                                        )
                                                                                                    </argument_list>
                                                                                                </call>
                                                                                            </expr>
                                                                                            }
                                                                                        </block>
                                                                                    </expr>
                                                                                </argument>
                                                                                ,
                                                                                <argument>
                                                                                    <expr>
                                                                                        <name>child</name>
                                                                                    </expr>
                                                                                </argument>
                                                                                )
                                                                            </argument_list>
                                                                        </call>
                                                                    </expr>
                                                                    ;
                                                                </expr_stmt>
                                                                }
                                                            </block>
                                                        </then>
                                                    </if>
                                                    }
                                                </block>
                                            </then>
                                            <else>else
                                                <block>{
                                                    <decl_stmt>
                                                        <decl>
                                                            <type>
                                                                <name>String</name>
                                                            </type>
                                                            <name>text</name> =
                                                            <init>
                                                                <expr>
                                                                    <call>
                                                                        <name><name>DOMUtil</name>.
                                                                            <name>getSyntheticAnnotation</name>
                                                                        </name>
                                                                        <argument_list>(
                                                                            <argument>
                                                                                <expr>
                                                                                    <name>content</name>
                                                                                </expr>
                                                                            </argument>
                                                                            )
                                                                        </argument_list>
                                                                    </call>
                                                                </expr>
                                                            </init>
                                                        </decl>
                                                        ;
                                                    </decl_stmt>
                                                    <if>if
                                                        <condition>(
                                                            <expr>
                                                                <name>text</name>
                                                                !=
                                                                <name>null</name>
                                                            </expr>
                                                            )
                                                        </condition>
                                                        <then>
                                                            <block>{
                                                                <expr_stmt>
                                                                    <expr>
                                                                        <call>
                                                                            <name><name>enumAnnotations</name>.
                                                                                <name>add</name>
                                                                            </name>
                                                                            <argument_list>(
                                                                                <argument>
                                                                                    <expr>
                                                                                        <call>
                                                                                            <name><name>
                                                                                                enumAnnotations</name>.
                                                                                                <name>getLength</name>
                                                                                            </name>
                                                                                            <argument_list>()
                                                                                            </argument_list>
                                                                                        </call>
                                                                                        - 1
                                                                                    </expr>
                                                                                </argument>
                                                                                ,
                                                                                <argument>
                                                                                    <expr>
                                                                                        <call>
                                                                                            <name>
                                                                                                traverseSyntheticAnnotation
                                                                                            </name>
                                                                                            <argument_list>(
                                                                                                <argument>
                                                                                                    <expr>
                                                                                                        <name>content
                                                                                                        </name>
                                                                                                    </expr>
                                                                                                </argument>
                                                                                                ,
                                                                                                <argument>
                                                                                                    <expr>
                                                                                                        <name>text
                                                                                                        </name>
                                                                                                    </expr>
                                                                                                </argument>
                                                                                                ,
                                                                                                <argument>
                                                                                                    <expr>
                                                                                                        <name>attrs
                                                                                                        </name>
                                                                                                    </expr>
                                                                                                </argument>
                                                                                                ,
                                                                                                <argument>
                                                                                                    <expr>false</expr>
                                                                                                </argument>
                                                                                                ,
                                                                                                <argument>
                                                                                                    <expr>
                                                                                                        <name>
                                                                                                            schemaDoc
                                                                                                        </name>
                                                                                                    </expr>
                                                                                                </argument>
                                                                                                )
                                                                                            </argument_list>
                                                                                        </call>
                                                                                    </expr>
                                                                                </argument>
                                                                                )
                                                                            </argument_list>
                                                                        </call>
                                                                    </expr>
                                                                    ;
                                                                </expr_stmt>
                                                                }
                                                            </block>
                                                        </then>
                                                    </if>
                                                    }
                                                </block>
                                            </else>
                                        </if>
                                        }
                                    </block>
                                </then>
                                <else>else
                                    <if>if
                                        <condition>(
                                            <expr>
                                                <call>
                                                    <name><name>facet</name>.
                                                        <name>equals</name>
                                                    </name>
                                                    <argument_list>(
                                                        <argument>
                                                            <expr>
                                                                <name><name>SchemaSymbols</name>.
                                                                    <name>ELT_PATTERN</name>
                                                                </name>
                                                            </expr>
                                                        </argument>
                                                        )
                                                    </argument_list>
                                                </call>
                                            </expr>
                                            )
                                        </condition>
                                        <then>
                                            <block>{
                                                <expr_stmt>
                                                    <expr>
                                                        <name>attrs</name>
                                                        =
                                                        <call>
                                                            <name><name>fAttrChecker</name>.
                                                                <name>checkAttributes</name>
                                                            </name>
                                                            <argument_list>(
                                                                <argument>
                                                                    <expr>
                                                                        <name>content</name>
                                                                    </expr>
                                                                </argument>
                                                                ,
                                                                <argument>
                                                                    <expr>false</expr>
                                                                </argument>
                                                                ,
                                                                <argument>
                                                                    <expr>
                                                                        <name>schemaDoc</name>
                                                                    </expr>
                                                                </argument>
                                                                )
                                                            </argument_list>
                                                        </call>
                                                    </expr>
                                                    ;
                                                </expr_stmt>
                                                <if>if
                                                    <condition>(
                                                        <expr>
                                                            <call>
                                                                <name><name>fPattern</name>.
                                                                    <name>length</name>
                                                                </name>
                                                                <argument_list>()</argument_list>
                                                            </call>
                                                            == 0
                                                        </expr>
                                                        )
                                                    </condition>
                                                    <then>
                                                        <block>{
                                                            <expr_stmt>
                                                                <expr>
                                                                    <call>
                                                                        <name><name>fPattern</name>.
                                                                            <name>append</name>
                                                                        </name>
                                                                        <argument_list>(
                                                                            <argument>
                                                                                <expr>(<name>String</name>)
                                                                                    <name>
                                                                                        <name>attrs</name>
                                                                                        <index>[
                                                                                            <expr>
                                                                                                <name><name>
                                                                                                    XSAttributeChecker</name>
                                                                                                    .
                                                                                                    <name>ATTIDX_VALUE
                                                                                                    </name>
                                                                                                </name>
                                                                                            </expr>
                                                                                            ]
                                                                                        </index>
                                                                                    </name>
                                                                                </expr>
                                                                            </argument>
                                                                            )
                                                                        </argument_list>
                                                                    </call>
                                                                </expr>
                                                                ;
                                                            </expr_stmt>
                                                            }
                                                        </block>
                                                    </then>
                                                    <else>else
                                                        <block>{
                                                            <comment type="line">//
                                                                ---------------------------------------------
                                                            </comment>
                                                            <comment type="line">//datatypes: 5.2.4 pattern:
                                                                src-multiple-pattern
                                                            </comment>
                                                            <comment type="line">//
                                                                ---------------------------------------------
                                                            </comment>
                                                            <expr_stmt>
                                                                <expr>
                                                                    <call>
                                                                        <name><name>fPattern</name>.
                                                                            <name>append</name>
                                                                        </name>
                                                                        <argument_list>(
                                                                            <argument>
                                                                                <expr>"|"</expr>
                                                                            </argument>
                                                                            )
                                                                        </argument_list>
                                                                    </call>
                                                                </expr>
                                                                ;
                                                            </expr_stmt>
                                                            <expr_stmt>
                                                                <expr>
                                                                    <call>
                                                                        <name><name>fPattern</name>.
                                                                            <name>append</name>
                                                                        </name>
                                                                        <argument_list>(
                                                                            <argument>
                                                                                <expr>(<name>String</name>)
                                                                                    <name>
                                                                                        <name>attrs</name>
                                                                                        <index>[
                                                                                            <expr>
                                                                                                <name><name>
                                                                                                    XSAttributeChecker</name>
                                                                                                    .
                                                                                                    <name>ATTIDX_VALUE
                                                                                                    </name>
                                                                                                </name>
                                                                                            </expr>
                                                                                            ]
                                                                                        </index>
                                                                                    </name>
                                                                                </expr>
                                                                            </argument>
                                                                            )
                                                                        </argument_list>
                                                                    </call>
                                                                </expr>
                                                                ;
                                                            </expr_stmt>
                                                            }
                                                        </block>
                                                    </else>
                                                </if>
                                                <decl_stmt>
                                                    <decl>
                                                        <type>
                                                            <name>Element</name>
                                                        </type>
                                                        <name>child</name> =
                                                        <init>
                                                            <expr>
                                                                <call>
                                                                    <name><name>DOMUtil</name>.
                                                                        <name>getFirstChildElement</name>
                                                                    </name>
                                                                    <argument_list>(
                                                                        <argument>
                                                                            <expr>
                                                                                <name>content</name>
                                                                            </expr>
                                                                        </argument>
                                                                        )
                                                                    </argument_list>
                                                                </call>
                                                            </expr>
                                                        </init>
                                                    </decl>
                                                    ;
                                                </decl_stmt>
                                                <if>if
                                                    <condition>(
                                                        <expr>
                                                            <name>child</name>
                                                            !=
                                                            <name>null</name>
                                                        </expr>
                                                        )
                                                    </condition>
                                                    <then>
                                                        <block>{
                                                            <comment type="line">// traverse annotation if any</comment>
                                                            <if>if
                                                                <condition>(
                                                                    <expr>
                                                                        <call>
                                                                            <name><name>DOMUtil</name>.
                                                                                <name>getLocalName</name>
                                                                            </name>
                                                                            <argument_list>(
                                                                                <argument>
                                                                                    <expr>
                                                                                        <name>child</name>
                                                                                    </expr>
                                                                                </argument>
                                                                                )
                                                                            </argument_list>
                                                                        </call>
                                                                        .
                                                                        <call>
                                                                            <name>equals</name>
                                                                            <argument_list>(
                                                                                <argument>
                                                                                    <expr>
                                                                                        <name><name>SchemaSymbols</name>
                                                                                            .
                                                                                            <name>ELT_ANNOTATION</name>
                                                                                        </name>
                                                                                    </expr>
                                                                                </argument>
                                                                                )
                                                                            </argument_list>
                                                                        </call>
                                                                    </expr>
                                                                    )
                                                                </condition>
                                                                <then>
                                                                    <block>{
                                                                        <if>if
                                                                            <condition>(
                                                                                <expr>
                                                                                    <name>patternAnnotations</name>
                                                                                    ==
                                                                                    <name>null</name>
                                                                                </expr>
                                                                                )
                                                                            </condition>
                                                                            <then>
                                                                                <block>{
                                                                                    <expr_stmt>
                                                                                        <expr>
                                                                                            <name>patternAnnotations
                                                                                            </name>
                                                                                            = new
                                                                                            <call>
                                                                                                <name>XSObjectListImpl
                                                                                                </name>
                                                                                                <argument_list>()
                                                                                                </argument_list>
                                                                                            </call>
                                                                                        </expr>
                                                                                        ;
                                                                                    </expr_stmt>
                                                                                    }
                                                                                </block>
                                                                            </then>
                                                                        </if>
                                                                        <expr_stmt>
                                                                            <expr>
                                                                                <call>
                                                                                    <name><name>
                                                                                        patternAnnotations</name>.
                                                                                        <name>add</name>
                                                                                    </name>
                                                                                    <argument_list>(
                                                                                        <argument>
                                                                                            <expr>
                                                                                                <call>
                                                                                                    <name>
                                                                                                        traverseAnnotationDecl
                                                                                                    </name>
                                                                                                    <argument_list>(
                                                                                                        <argument>
                                                                                                            <expr>
                                                                                                                <name>
                                                                                                                    child
                                                                                                                </name>
                                                                                                            </expr>
                                                                                                        </argument>
                                                                                                        ,
                                                                                                        <argument>
                                                                                                            <expr>
                                                                                                                <name>
                                                                                                                    attrs
                                                                                                                </name>
                                                                                                            </expr>
                                                                                                        </argument>
                                                                                                        ,
                                                                                                        <argument>
                                                                                                            <expr>
                                                                                                                false
                                                                                                            </expr>
                                                                                                        </argument>
                                                                                                        ,
                                                                                                        <argument>
                                                                                                            <expr>
                                                                                                                <name>
                                                                                                                    schemaDoc
                                                                                                                </name>
                                                                                                            </expr>
                                                                                                        </argument>
                                                                                                        )
                                                                                                    </argument_list>
                                                                                                </call>
                                                                                            </expr>
                                                                                        </argument>
                                                                                        )
                                                                                    </argument_list>
                                                                                </call>
                                                                            </expr>
                                                                            ;
                                                                        </expr_stmt>
                                                                        <expr_stmt>
                                                                            <expr>
                                                                                <name>child</name>
                                                                                =
                                                                                <call>
                                                                                    <name><name>DOMUtil</name>.
                                                                                        <name>getNextSiblingElement
                                                                                        </name>
                                                                                    </name>
                                                                                    <argument_list>(
                                                                                        <argument>
                                                                                            <expr>
                                                                                                <name>child</name>
                                                                                            </expr>
                                                                                        </argument>
                                                                                        )
                                                                                    </argument_list>
                                                                                </call>
                                                                            </expr>
                                                                            ;
                                                                        </expr_stmt>
                                                                        }
                                                                    </block>
                                                                </then>
                                                            </if>
                                                            <if>if
                                                                <condition>(
                                                                    <expr>
                                                                        <name>child</name>
                                                                        !=<name>null</name> &amp;&amp;
                                                                        <call>
                                                                            <name><name>DOMUtil</name>.
                                                                                <name>getLocalName</name>
                                                                            </name>
                                                                            <argument_list>(
                                                                                <argument>
                                                                                    <expr>
                                                                                        <name>child</name>
                                                                                    </expr>
                                                                                </argument>
                                                                                )
                                                                            </argument_list>
                                                                        </call>
                                                                        .
                                                                        <call>
                                                                            <name>equals</name>
                                                                            <argument_list>(
                                                                                <argument>
                                                                                    <expr>
                                                                                        <name><name>SchemaSymbols</name>
                                                                                            .
                                                                                            <name>ELT_ANNOTATION</name>
                                                                                        </name>
                                                                                    </expr>
                                                                                </argument>
                                                                                )
                                                                            </argument_list>
                                                                        </call>
                                                                    </expr>
                                                                    )
                                                                </condition>
                                                                <then>
                                                                    <block>{
                                                                        <expr_stmt>
                                                                            <expr>
                                                                                <call>
                                                                                    <name>reportSchemaError</name>
                                                                                    <argument_list>(
                                                                                        <argument>
                                                                                            <expr>
                                                                                                "s4s-elt-must-match.1"
                                                                                            </expr>
                                                                                        </argument>
                                                                                        ,
                                                                                        <argument>
                                                                                            <expr>new
                                                                                                <name>
                                                                                                    <name>Object</name>
                                                                                                    <index>[]</index>
                                                                                                </name>
                                                                                                <block>{<expr>
                                                                                                    "pattern"</expr>, <expr>
                                                                                                    "(annotation?)"</expr>,
                                                                                                    <expr>
                                                                                                        <call>
                                                                                                            <name><name>
                                                                                                                DOMUtil</name>
                                                                                                                .
                                                                                                                <name>
                                                                                                                    getLocalName
                                                                                                                </name>
                                                                                                            </name>
                                                                                                            <argument_list>
                                                                                                                (
                                                                                                                <argument>
                                                                                                                    <expr>
                                                                                                                        <name>
                                                                                                                            child
                                                                                                                        </name>
                                                                                                                    </expr>
                                                                                                                </argument>
                                                                                                                )
                                                                                                            </argument_list>
                                                                                                        </call>
                                                                                                    </expr>
                                                                                                    }
                                                                                                </block>
                                                                                            </expr>
                                                                                        </argument>
                                                                                        ,
                                                                                        <argument>
                                                                                            <expr>
                                                                                                <name>child</name>
                                                                                            </expr>
                                                                                        </argument>
                                                                                        )
                                                                                    </argument_list>
                                                                                </call>
                                                                            </expr>
                                                                            ;
                                                                        </expr_stmt>
                                                                        }
                                                                    </block>
                                                                </then>
                                                            </if>
                                                            }
                                                        </block>
                                                    </then>
                                                </if>

                                                }
                                            </block>
                                        </then>
                                        <else>else
                                            <block>{
                                                <if>if
                                                    <condition>(
                                                        <expr>
                                                            <call>
                                                                <name><name>facet</name>.
                                                                    <name>equals</name>
                                                                </name>
                                                                <argument_list>(
                                                                    <argument>
                                                                        <expr>
                                                                            <name><name>SchemaSymbols</name>.
                                                                                <name>ELT_MINLENGTH</name>
                                                                            </name>
                                                                        </expr>
                                                                    </argument>
                                                                    )
                                                                </argument_list>
                                                            </call>
                                                        </expr>
                                                        )
                                                    </condition>
                                                    <then>
                                                        <block>{
                                                            <expr_stmt>
                                                                <expr>
                                                                    <name>currentFacet</name>
                                                                    =
                                                                    <name><name>XSSimpleType</name>.
                                                                        <name>FACET_MINLENGTH</name>
                                                                    </name>
                                                                </expr>
                                                                ;
                                                            </expr_stmt>
                                                            }
                                                        </block>
                                                    </then>
                                                    <else>else
                                                        <if>if
                                                            <condition>(
                                                                <expr>
                                                                    <call>
                                                                        <name><name>facet</name>.
                                                                            <name>equals</name>
                                                                        </name>
                                                                        <argument_list>(
                                                                            <argument>
                                                                                <expr>
                                                                                    <name><name>SchemaSymbols</name>.
                                                                                        <name>ELT_MAXLENGTH</name>
                                                                                    </name>
                                                                                </expr>
                                                                            </argument>
                                                                            )
                                                                        </argument_list>
                                                                    </call>
                                                                </expr>
                                                                )
                                                            </condition>
                                                            <then>
                                                                <block>{
                                                                    <expr_stmt>
                                                                        <expr>
                                                                            <name>currentFacet</name>
                                                                            =
                                                                            <name><name>XSSimpleType</name>.
                                                                                <name>FACET_MAXLENGTH</name>
                                                                            </name>
                                                                        </expr>
                                                                        ;
                                                                    </expr_stmt>
                                                                    }
                                                                </block>
                                                            </then>
                                                            <else>else
                                                                <if>if
                                                                    <condition>(
                                                                        <expr>
                                                                            <call>
                                                                                <name><name>facet</name>.
                                                                                    <name>equals</name>
                                                                                </name>
                                                                                <argument_list>(
                                                                                    <argument>
                                                                                        <expr>
                                                                                            <name><name>
                                                                                                SchemaSymbols</name>.
                                                                                                <name>ELT_MAXEXCLUSIVE
                                                                                                </name>
                                                                                            </name>
                                                                                        </expr>
                                                                                    </argument>
                                                                                    )
                                                                                </argument_list>
                                                                            </call>
                                                                        </expr>
                                                                        )
                                                                    </condition>
                                                                    <then>
                                                                        <block>{
                                                                            <expr_stmt>
                                                                                <expr>
                                                                                    <name>currentFacet</name>
                                                                                    =
                                                                                    <name><name>XSSimpleType</name>.
                                                                                        <name>FACET_MAXEXCLUSIVE</name>
                                                                                    </name>
                                                                                </expr>
                                                                                ;
                                                                            </expr_stmt>
                                                                            }
                                                                        </block>
                                                                    </then>
                                                                    <else>else
                                                                        <if>if
                                                                            <condition>(
                                                                                <expr>
                                                                                    <call>
                                                                                        <name><name>facet</name>.
                                                                                            <name>equals</name>
                                                                                        </name>
                                                                                        <argument_list>(
                                                                                            <argument>
                                                                                                <expr>
                                                                                                    <name><name>
                                                                                                        SchemaSymbols</name>
                                                                                                        .
                                                                                                        <name>
                                                                                                            ELT_MAXINCLUSIVE
                                                                                                        </name>
                                                                                                    </name>
                                                                                                </expr>
                                                                                            </argument>
                                                                                            )
                                                                                        </argument_list>
                                                                                    </call>
                                                                                </expr>
                                                                                )
                                                                            </condition>
                                                                            <then>
                                                                                <block>{
                                                                                    <expr_stmt>
                                                                                        <expr>
                                                                                            <name>currentFacet</name>
                                                                                            =
                                                                                            <name><name>
                                                                                                XSSimpleType</name>.
                                                                                                <name>
                                                                                                    FACET_MAXINCLUSIVE
                                                                                                </name>
                                                                                            </name>
                                                                                        </expr>
                                                                                        ;
                                                                                    </expr_stmt>
                                                                                    }
                                                                                </block>
                                                                            </then>
                                                                            <else>else
                                                                                <if>if
                                                                                    <condition>(
                                                                                        <expr>
                                                                                            <call>
                                                                                                <name><name>facet</name>
                                                                                                    .
                                                                                                    <name>equals</name>
                                                                                                </name>
                                                                                                <argument_list>(
                                                                                                    <argument>
                                                                                                        <expr>
                                                                                                            <name><name>
                                                                                                                SchemaSymbols</name>
                                                                                                                .
                                                                                                                <name>
                                                                                                                    ELT_MINEXCLUSIVE
                                                                                                                </name>
                                                                                                            </name>
                                                                                                        </expr>
                                                                                                    </argument>
                                                                                                    )
                                                                                                </argument_list>
                                                                                            </call>
                                                                                        </expr>
                                                                                        )
                                                                                    </condition>
                                                                                    <then>
                                                                                        <block>{
                                                                                            <expr_stmt>
                                                                                                <expr>
                                                                                                    <name>currentFacet
                                                                                                    </name>
                                                                                                    =
                                                                                                    <name><name>
                                                                                                        XSSimpleType</name>
                                                                                                        .
                                                                                                        <name>
                                                                                                            FACET_MINEXCLUSIVE
                                                                                                        </name>
                                                                                                    </name>
                                                                                                </expr>
                                                                                                ;
                                                                                            </expr_stmt>
                                                                                            }
                                                                                        </block>
                                                                                    </then>
                                                                                    <else>else
                                                                                        <if>if
                                                                                            <condition>(
                                                                                                <expr>
                                                                                                    <call>
                                                                                                        <name><name>
                                                                                                            facet</name>
                                                                                                            .
                                                                                                            <name>
                                                                                                                equals
                                                                                                            </name>
                                                                                                        </name>
                                                                                                        <argument_list>(
                                                                                                            <argument>
                                                                                                                <expr>
                                                                                                                    <name>
                                                                                                                        <name>
                                                                                                                            SchemaSymbols</name>
                                                                                                                        .
                                                                                                                        <name>
                                                                                                                            ELT_MININCLUSIVE
                                                                                                                        </name>
                                                                                                                    </name>
                                                                                                                </expr>
                                                                                                            </argument>
                                                                                                            )
                                                                                                        </argument_list>
                                                                                                    </call>
                                                                                                </expr>
                                                                                                )
                                                                                            </condition>
                                                                                            <then>
                                                                                                <block>{
                                                                                                    <expr_stmt>
                                                                                                        <expr>
                                                                                                            <name>
                                                                                                                currentFacet
                                                                                                            </name>
                                                                                                            =
                                                                                                            <name><name>
                                                                                                                XSSimpleType</name>
                                                                                                                .
                                                                                                                <name>
                                                                                                                    FACET_MININCLUSIVE
                                                                                                                </name>
                                                                                                            </name>
                                                                                                        </expr>
                                                                                                        ;
                                                                                                    </expr_stmt>
                                                                                                    }
                                                                                                </block>
                                                                                            </then>
                                                                                            <else>else
                                                                                                <if>if
                                                                                                    <condition>(
                                                                                                        <expr>
                                                                                                            <call>
                                                                                                                <name>
                                                                                                                    <name>
                                                                                                                        facet</name>
                                                                                                                    .
                                                                                                                    <name>
                                                                                                                        equals
                                                                                                                    </name>
                                                                                                                </name>
                                                                                                                <argument_list>
                                                                                                                    (
                                                                                                                    <argument>
                                                                                                                        <expr>
                                                                                                                            <name>
                                                                                                                                <name>
                                                                                                                                    SchemaSymbols</name>
                                                                                                                                .
                                                                                                                                <name>
                                                                                                                                    ELT_TOTALDIGITS
                                                                                                                                </name>
                                                                                                                            </name>
                                                                                                                        </expr>
                                                                                                                    </argument>
                                                                                                                    )
                                                                                                                </argument_list>
                                                                                                            </call>
                                                                                                        </expr>
                                                                                                        )
                                                                                                    </condition>
                                                                                                    <then>
                                                                                                        <block>{
                                                                                                            <expr_stmt>
                                                                                                                <expr>
                                                                                                                    <name>
                                                                                                                        currentFacet
                                                                                                                    </name>
                                                                                                                    =
                                                                                                                    <name>
                                                                                                                        <name>
                                                                                                                            XSSimpleType</name>
                                                                                                                        .
                                                                                                                        <name>
                                                                                                                            FACET_TOTALDIGITS
                                                                                                                        </name>
                                                                                                                    </name>
                                                                                                                </expr>
                                                                                                                ;
                                                                                                            </expr_stmt>
                                                                                                            }
                                                                                                        </block>
                                                                                                    </then>
                                                                                                    <else>else
                                                                                                        <if>if
                                                                                                            <condition>(
                                                                                                                <expr>
                                                                                                                    <call>
                                                                                                                        <name>
                                                                                                                            <name>
                                                                                                                                facet</name>
                                                                                                                            .
                                                                                                                            <name>
                                                                                                                                equals
                                                                                                                            </name>
                                                                                                                        </name>
                                                                                                                        <argument_list>
                                                                                                                            (
                                                                                                                            <argument>
                                                                                                                                <expr>
                                                                                                                                    <name>
                                                                                                                                        <name>
                                                                                                                                            SchemaSymbols</name>
                                                                                                                                        .
                                                                                                                                        <name>
                                                                                                                                            ELT_FRACTIONDIGITS
                                                                                                                                        </name>
                                                                                                                                    </name>
                                                                                                                                </expr>
                                                                                                                            </argument>
                                                                                                                            )
                                                                                                                        </argument_list>
                                                                                                                    </call>
                                                                                                                </expr>
                                                                                                                )
                                                                                                            </condition>
                                                                                                            <then>
                                                                                                                <block>{
                                                                                                                    <expr_stmt>
                                                                                                                        <expr>
                                                                                                                            <name>
                                                                                                                                currentFacet
                                                                                                                            </name>
                                                                                                                            =
                                                                                                                            <name>
                                                                                                                                <name>
                                                                                                                                    XSSimpleType</name>
                                                                                                                                .
                                                                                                                                <name>
                                                                                                                                    FACET_FRACTIONDIGITS
                                                                                                                                </name>
                                                                                                                            </name>
                                                                                                                        </expr>
                                                                                                                        ;
                                                                                                                    </expr_stmt>
                                                                                                                    }
                                                                                                                </block>
                                                                                                            </then>
                                                                                                            <else>else
                                                                                                                <if>if
                                                                                                                    <condition>
                                                                                                                        (
                                                                                                                        <expr>
                                                                                                                            <call>
                                                                                                                                <name>
                                                                                                                                    <name>
                                                                                                                                        facet</name>
                                                                                                                                    .
                                                                                                                                    <name>
                                                                                                                                        equals
                                                                                                                                    </name>
                                                                                                                                </name>
                                                                                                                                <argument_list>
                                                                                                                                    (
                                                                                                                                    <argument>
                                                                                                                                        <expr>
                                                                                                                                            <name>
                                                                                                                                                <name>
                                                                                                                                                    SchemaSymbols</name>
                                                                                                                                                .
                                                                                                                                                <name>
                                                                                                                                                    ELT_WHITESPACE
                                                                                                                                                </name>
                                                                                                                                            </name>
                                                                                                                                        </expr>
                                                                                                                                    </argument>
                                                                                                                                    )
                                                                                                                                </argument_list>
                                                                                                                            </call>
                                                                                                                        </expr>
                                                                                                                        )
                                                                                                                    </condition>
                                                                                                                    <then>
                                                                                                                        <block>
                                                                                                                            {
                                                                                                                            <expr_stmt>
                                                                                                                                <expr>
                                                                                                                                    <name>
                                                                                                                                        currentFacet
                                                                                                                                    </name>
                                                                                                                                    =
                                                                                                                                    <name>
                                                                                                                                        <name>
                                                                                                                                            XSSimpleType</name>
                                                                                                                                        .
                                                                                                                                        <name>
                                                                                                                                            FACET_WHITESPACE
                                                                                                                                        </name>
                                                                                                                                    </name>
                                                                                                                                </expr>
                                                                                                                                ;
                                                                                                                            </expr_stmt>
                                                                                                                            }
                                                                                                                        </block>
                                                                                                                    </then>
                                                                                                                    <else>
                                                                                                                        else
                                                                                                                        <if>
                                                                                                                            if
                                                                                                                            <condition>
                                                                                                                                (
                                                                                                                                <expr>
                                                                                                                                    <call>
                                                                                                                                        <name>
                                                                                                                                            <name>
                                                                                                                                                facet</name>
                                                                                                                                            .
                                                                                                                                            <name>
                                                                                                                                                equals
                                                                                                                                            </name>
                                                                                                                                        </name>
                                                                                                                                        <argument_list>
                                                                                                                                            (
                                                                                                                                            <argument>
                                                                                                                                                <expr>
                                                                                                                                                    <name>
                                                                                                                                                        <name>
                                                                                                                                                            SchemaSymbols</name>
                                                                                                                                                        .
                                                                                                                                                        <name>
                                                                                                                                                            ELT_LENGTH
                                                                                                                                                        </name>
                                                                                                                                                    </name>
                                                                                                                                                </expr>
                                                                                                                                            </argument>
                                                                                                                                            )
                                                                                                                                        </argument_list>
                                                                                                                                    </call>
                                                                                                                                </expr>
                                                                                                                                )
                                                                                                                            </condition>
                                                                                                                            <then>
                                                                                                                                <block>
                                                                                                                                    {
                                                                                                                                    <expr_stmt>
                                                                                                                                        <expr>
                                                                                                                                            <name>
                                                                                                                                                currentFacet
                                                                                                                                            </name>
                                                                                                                                            =
                                                                                                                                            <name>
                                                                                                                                                <name>
                                                                                                                                                    XSSimpleType</name>
                                                                                                                                                .
                                                                                                                                                <name>
                                                                                                                                                    FACET_LENGTH
                                                                                                                                                </name>
                                                                                                                                            </name>
                                                                                                                                        </expr>
                                                                                                                                        ;
                                                                                                                                    </expr_stmt>
                                                                                                                                    }
                                                                                                                                </block>
                                                                                                                            </then>
                                                                                                                            <else>
                                                                                                                                else
                                                                                                                                <block>
                                                                                                                                    {
                                                                                                                                    <break>
                                                                                                                                        break;
                                                                                                                                    </break>
                                                                                                                                    <comment
                                                                                                                                            type="line">
                                                                                                                                        //
                                                                                                                                        a
                                                                                                                                        non-facet
                                                                                                                                    </comment>
                                                                                                                                    }
                                                                                                                                </block>
                                                                                                                            </else>
                                                                                                                        </if>
                                                                                                                    </else>
                                                                                                                </if>
                                                                                                            </else>
                                                                                                        </if>
                                                                                                    </else>
                                                                                                </if>
                                                                                            </else>
                                                                                        </if>
                                                                                    </else>
                                                                                </if>
                                                                            </else>
                                                                        </if>
                                                                    </else>
                                                                </if>
                                                            </else>
                                                        </if>
                                                    </else>
                                                </if>

                                                <expr_stmt>
                                                    <expr>
                                                        <name>attrs</name>
                                                        =
                                                        <call>
                                                            <name><name>fAttrChecker</name>.
                                                                <name>checkAttributes</name>
                                                            </name>
                                                            <argument_list>(
                                                                <argument>
                                                                    <expr>
                                                                        <name>content</name>
                                                                    </expr>
                                                                </argument>
                                                                ,
                                                                <argument>
                                                                    <expr>false</expr>
                                                                </argument>
                                                                ,
                                                                <argument>
                                                                    <expr>
                                                                        <name>schemaDoc</name>
                                                                    </expr>
                                                                </argument>
                                                                )
                                                            </argument_list>
                                                        </call>
                                                    </expr>
                                                    ;
                                                </expr_stmt>

                                                <comment type="line">// check for duplicate facets</comment>
                                                <if>if
                                                    <condition>(
                                                        <expr>(<name>facetsPresent</name> &amp; <name>
                                                            currentFacet</name>) != 0
                                                        </expr>
                                                        )
                                                    </condition>
                                                    <then>
                                                        <block>{
                                                            <expr_stmt>
                                                                <expr>
                                                                    <call>
                                                                        <name>reportSchemaError</name>
                                                                        <argument_list>(
                                                                            <argument>
                                                                                <expr>"src-single-facet-value"</expr>
                                                                            </argument>
                                                                            ,
                                                                            <argument>
                                                                                <expr>new
                                                                                    <name>
                                                                                        <name>Object</name>
                                                                                        <index>[]</index>
                                                                                    </name>
                                                                                    <block>{
                                                                                        <expr>
                                                                                            <name>facet</name>
                                                                                        </expr>
                                                                                        }
                                                                                    </block>
                                                                                </expr>
                                                                            </argument>
                                                                            ,
                                                                            <argument>
                                                                                <expr>
                                                                                    <name>content</name>
                                                                                </expr>
                                                                            </argument>
                                                                            )
                                                                        </argument_list>
                                                                    </call>
                                                                </expr>
                                                                ;
                                                            </expr_stmt>
                                                            }
                                                        </block>
                                                    </then>
                                                    <else>else
                                                        <if>if
                                                            <condition>(
                                                                <expr>
                                                                    <name>
                                                                        <name>attrs</name>
                                                                        <index>[
                                                                            <expr>
                                                                                <name><name>XSAttributeChecker</name>.
                                                                                    <name>ATTIDX_VALUE</name>
                                                                                </name>
                                                                            </expr>
                                                                            ]
                                                                        </index>
                                                                    </name>
                                                                    !=
                                                                    <name>null</name>
                                                                </expr>
                                                                )
                                                            </condition>
                                                            <then>
                                                                <block>{
                                                                    <expr_stmt>
                                                                        <expr>
                                                                            <name>facetsPresent</name>
                                                                            |=
                                                                            <name>currentFacet</name>
                                                                        </expr>
                                                                        ;
                                                                    </expr_stmt>
                                                                    <comment type="line">// check for fixed facet
                                                                    </comment>
                                                                    <if>if
                                                                        <condition>(
                                                                            <expr>((<name>Boolean</name>)
                                                                                <name>
                                                                                    <name>attrs</name>
                                                                                    <index>[
                                                                                        <expr>
                                                                                            <name><name>
                                                                                                XSAttributeChecker</name>
                                                                                                .
                                                                                                <name>ATTIDX_FIXED
                                                                                                </name>
                                                                                            </name>
                                                                                        </expr>
                                                                                        ]
                                                                                    </index>
                                                                                </name>
                                                                                ).
                                                                                <call>
                                                                                    <name>booleanValue</name>
                                                                                    <argument_list>()</argument_list>
                                                                                </call>
                                                                            </expr>
                                                                            )
                                                                        </condition>
                                                                        <then>
                                                                            <block>{
                                                                                <expr_stmt>
                                                                                    <expr>
                                                                                        <name>facetsFixed</name>
                                                                                        |=
                                                                                        <name>currentFacet</name>
                                                                                    </expr>
                                                                                    ;
                                                                                </expr_stmt>
                                                                                }
                                                                            </block>
                                                                        </then>
                                                                    </if>
                                                                    <switch>switch
                                                                        <condition>(
                                                                            <expr>
                                                                                <name>currentFacet</name>
                                                                            </expr>
                                                                            )
                                                                        </condition>
                                                                        <block>{
                                                                            <case>case
                                                                                <expr>
                                                                                    <name><name>XSSimpleType</name>.
                                                                                        <name>FACET_MINLENGTH</name>
                                                                                    </name>
                                                                                </expr>
                                                                                :
                                                                                <expr_stmt>
                                                                                    <expr>
                                                                                        <name><name>xsFacets</name>.
                                                                                            <name>minLength</name>
                                                                                        </name>
                                                                                        = ((<name>XInt</name>)
                                                                                        <name>
                                                                                            <name>attrs</name>
                                                                                            <index>[
                                                                                                <expr>
                                                                                                    <name><name>
                                                                                                        XSAttributeChecker</name>
                                                                                                        .
                                                                                                        <name>
                                                                                                            ATTIDX_VALUE
                                                                                                        </name>
                                                                                                    </name>
                                                                                                </expr>
                                                                                                ]
                                                                                            </index>
                                                                                        </name>
                                                                                        ).
                                                                                        <call>
                                                                                            <name>intValue</name>
                                                                                            <argument_list>()
                                                                                            </argument_list>
                                                                                        </call>
                                                                                    </expr>
                                                                                    ;
                                                                                </expr_stmt>
                                                                                <break>break;</break>
                                                                            </case>
                                                                            <case>case
                                                                                <expr>
                                                                                    <name><name>XSSimpleType</name>.
                                                                                        <name>FACET_MAXLENGTH</name>
                                                                                    </name>
                                                                                </expr>
                                                                                :
                                                                                <expr_stmt>
                                                                                    <expr>
                                                                                        <name><name>xsFacets</name>.
                                                                                            <name>maxLength</name>
                                                                                        </name>
                                                                                        = ((<name>XInt</name>)
                                                                                        <name>
                                                                                            <name>attrs</name>
                                                                                            <index>[
                                                                                                <expr>
                                                                                                    <name><name>
                                                                                                        XSAttributeChecker</name>
                                                                                                        .
                                                                                                        <name>
                                                                                                            ATTIDX_VALUE
                                                                                                        </name>
                                                                                                    </name>
                                                                                                </expr>
                                                                                                ]
                                                                                            </index>
                                                                                        </name>
                                                                                        ).
                                                                                        <call>
                                                                                            <name>intValue</name>
                                                                                            <argument_list>()
                                                                                            </argument_list>
                                                                                        </call>
                                                                                    </expr>
                                                                                    ;
                                                                                </expr_stmt>
                                                                                <break>break;</break>
                                                                            </case>
                                                                            <case>case
                                                                                <expr>
                                                                                    <name><name>XSSimpleType</name>.
                                                                                        <name>FACET_MAXEXCLUSIVE</name>
                                                                                    </name>
                                                                                </expr>
                                                                                :
                                                                                <expr_stmt>
                                                                                    <expr>
                                                                                        <name><name>xsFacets</name>.
                                                                                            <name>maxExclusive</name>
                                                                                        </name>
                                                                                        = (<name>String</name>)
                                                                                        <name>
                                                                                            <name>attrs</name>
                                                                                            <index>[
                                                                                                <expr>
                                                                                                    <name><name>
                                                                                                        XSAttributeChecker</name>
                                                                                                        .
                                                                                                        <name>
                                                                                                            ATTIDX_VALUE
                                                                                                        </name>
                                                                                                    </name>
                                                                                                </expr>
                                                                                                ]
                                                                                            </index>
                                                                                        </name>
                                                                                    </expr>
                                                                                    ;
                                                                                </expr_stmt>
                                                                                <break>break;</break>
                                                                            </case>
                                                                            <case>case
                                                                                <expr>
                                                                                    <name><name>XSSimpleType</name>.
                                                                                        <name>FACET_MAXINCLUSIVE</name>
                                                                                    </name>
                                                                                </expr>
                                                                                :
                                                                                <expr_stmt>
                                                                                    <expr>
                                                                                        <name><name>xsFacets</name>.
                                                                                            <name>maxInclusive</name>
                                                                                        </name>
                                                                                        = (<name>String</name>)
                                                                                        <name>
                                                                                            <name>attrs</name>
                                                                                            <index>[
                                                                                                <expr>
                                                                                                    <name><name>
                                                                                                        XSAttributeChecker</name>
                                                                                                        .
                                                                                                        <name>
                                                                                                            ATTIDX_VALUE
                                                                                                        </name>
                                                                                                    </name>
                                                                                                </expr>
                                                                                                ]
                                                                                            </index>
                                                                                        </name>
                                                                                    </expr>
                                                                                    ;
                                                                                </expr_stmt>
                                                                                <break>break;</break>
                                                                            </case>
                                                                            <case>case
                                                                                <expr>
                                                                                    <name><name>XSSimpleType</name>.
                                                                                        <name>FACET_MINEXCLUSIVE</name>
                                                                                    </name>
                                                                                </expr>
                                                                                :
                                                                                <expr_stmt>
                                                                                    <expr>
                                                                                        <name><name>xsFacets</name>.
                                                                                            <name>minExclusive</name>
                                                                                        </name>
                                                                                        = (<name>String</name>)
                                                                                        <name>
                                                                                            <name>attrs</name>
                                                                                            <index>[
                                                                                                <expr>
                                                                                                    <name><name>
                                                                                                        XSAttributeChecker</name>
                                                                                                        .
                                                                                                        <name>
                                                                                                            ATTIDX_VALUE
                                                                                                        </name>
                                                                                                    </name>
                                                                                                </expr>
                                                                                                ]
                                                                                            </index>
                                                                                        </name>
                                                                                    </expr>
                                                                                    ;
                                                                                </expr_stmt>
                                                                                <break>break;</break>
                                                                            </case>
                                                                            <case>case
                                                                                <expr>
                                                                                    <name><name>XSSimpleType</name>.
                                                                                        <name>FACET_MININCLUSIVE</name>
                                                                                    </name>
                                                                                </expr>
                                                                                :
                                                                                <expr_stmt>
                                                                                    <expr>
                                                                                        <name><name>xsFacets</name>.
                                                                                            <name>minInclusive</name>
                                                                                        </name>
                                                                                        = (<name>String</name>)
                                                                                        <name>
                                                                                            <name>attrs</name>
                                                                                            <index>[
                                                                                                <expr>
                                                                                                    <name><name>
                                                                                                        XSAttributeChecker</name>
                                                                                                        .
                                                                                                        <name>
                                                                                                            ATTIDX_VALUE
                                                                                                        </name>
                                                                                                    </name>
                                                                                                </expr>
                                                                                                ]
                                                                                            </index>
                                                                                        </name>
                                                                                    </expr>
                                                                                    ;
                                                                                </expr_stmt>
                                                                                <break>break;</break>
                                                                            </case>
                                                                            <case>case
                                                                                <expr>
                                                                                    <name><name>XSSimpleType</name>.
                                                                                        <name>FACET_TOTALDIGITS</name>
                                                                                    </name>
                                                                                </expr>
                                                                                :
                                                                                <expr_stmt>
                                                                                    <expr>
                                                                                        <name><name>xsFacets</name>.
                                                                                            <name>totalDigits</name>
                                                                                        </name>
                                                                                        = ((<name>XInt</name>)
                                                                                        <name>
                                                                                            <name>attrs</name>
                                                                                            <index>[
                                                                                                <expr>
                                                                                                    <name><name>
                                                                                                        XSAttributeChecker</name>
                                                                                                        .
                                                                                                        <name>
                                                                                                            ATTIDX_VALUE
                                                                                                        </name>
                                                                                                    </name>
                                                                                                </expr>
                                                                                                ]
                                                                                            </index>
                                                                                        </name>
                                                                                        ).
                                                                                        <call>
                                                                                            <name>intValue</name>
                                                                                            <argument_list>()
                                                                                            </argument_list>
                                                                                        </call>
                                                                                    </expr>
                                                                                    ;
                                                                                </expr_stmt>
                                                                                <break>break;</break>
                                                                            </case>
                                                                            <case>case
                                                                                <expr>
                                                                                    <name><name>XSSimpleType</name>.
                                                                                        <name>FACET_FRACTIONDIGITS
                                                                                        </name>
                                                                                    </name>
                                                                                </expr>
                                                                                :
                                                                                <expr_stmt>
                                                                                    <expr>
                                                                                        <name><name>xsFacets</name>.
                                                                                            <name>fractionDigits</name>
                                                                                        </name>
                                                                                        = ((<name>XInt</name>)
                                                                                        <name>
                                                                                            <name>attrs</name>
                                                                                            <index>[
                                                                                                <expr>
                                                                                                    <name><name>
                                                                                                        XSAttributeChecker</name>
                                                                                                        .
                                                                                                        <name>
                                                                                                            ATTIDX_VALUE
                                                                                                        </name>
                                                                                                    </name>
                                                                                                </expr>
                                                                                                ]
                                                                                            </index>
                                                                                        </name>
                                                                                        ).
                                                                                        <call>
                                                                                            <name>intValue</name>
                                                                                            <argument_list>()
                                                                                            </argument_list>
                                                                                        </call>
                                                                                    </expr>
                                                                                    ;
                                                                                </expr_stmt>
                                                                                <break>break;</break>
                                                                            </case>
                                                                            <case>case
                                                                                <expr>
                                                                                    <name><name>XSSimpleType</name>.
                                                                                        <name>FACET_WHITESPACE</name>
                                                                                    </name>
                                                                                </expr>
                                                                                :
                                                                                <expr_stmt>
                                                                                    <expr>
                                                                                        <name><name>xsFacets</name>.
                                                                                            <name>whiteSpace</name>
                                                                                        </name>
                                                                                        = ((<name>XInt</name>)
                                                                                        <name>
                                                                                            <name>attrs</name>
                                                                                            <index>[
                                                                                                <expr>
                                                                                                    <name><name>
                                                                                                        XSAttributeChecker</name>
                                                                                                        .
                                                                                                        <name>
                                                                                                            ATTIDX_VALUE
                                                                                                        </name>
                                                                                                    </name>
                                                                                                </expr>
                                                                                                ]
                                                                                            </index>
                                                                                        </name>
                                                                                        ).
                                                                                        <call>
                                                                                            <name>shortValue</name>
                                                                                            <argument_list>()
                                                                                            </argument_list>
                                                                                        </call>
                                                                                    </expr>
                                                                                    ;
                                                                                </expr_stmt>
                                                                                <break>break;</break>
                                                                            </case>
                                                                            <case>case
                                                                                <expr>
                                                                                    <name><name>XSSimpleType</name>.
                                                                                        <name>FACET_LENGTH</name>
                                                                                    </name>
                                                                                </expr>
                                                                                :
                                                                                <expr_stmt>
                                                                                    <expr>
                                                                                        <name><name>xsFacets</name>.
                                                                                            <name>length</name>
                                                                                        </name>
                                                                                        = ((<name>XInt</name>)
                                                                                        <name>
                                                                                            <name>attrs</name>
                                                                                            <index>[
                                                                                                <expr>
                                                                                                    <name><name>
                                                                                                        XSAttributeChecker</name>
                                                                                                        .
                                                                                                        <name>
                                                                                                            ATTIDX_VALUE
                                                                                                        </name>
                                                                                                    </name>
                                                                                                </expr>
                                                                                                ]
                                                                                            </index>
                                                                                        </name>
                                                                                        ).
                                                                                        <call>
                                                                                            <name>intValue</name>
                                                                                            <argument_list>()
                                                                                            </argument_list>
                                                                                        </call>
                                                                                    </expr>
                                                                                    ;
                                                                                </expr_stmt>
                                                                                <break>break;</break>
                                                                            </case>
                                                                            }
                                                                        </block>
                                                                    </switch>
                                                                    }
                                                                </block>
                                                            </then>
                                                        </if>
                                                    </else>
                                                </if>

                                                <decl_stmt>
                                                    <decl>
                                                        <type>
                                                            <name>Element</name>
                                                        </type>
                                                        <name>child</name> =
                                                        <init>
                                                            <expr>
                                                                <call>
                                                                    <name><name>DOMUtil</name>.
                                                                        <name>getFirstChildElement</name>
                                                                    </name>
                                                                    <argument_list>(
                                                                        <argument>
                                                                            <expr>
                                                                                <name>content</name>
                                                                            </expr>
                                                                        </argument>
                                                                        )
                                                                    </argument_list>
                                                                </call>
                                                            </expr>
                                                        </init>
                                                    </decl>
                                                    ;
                                                </decl_stmt>
                                                <if>if
                                                    <condition>(
                                                        <expr>
                                                            <name>child</name>
                                                            !=
                                                            <name>null</name>
                                                        </expr>
                                                        )
                                                    </condition>
                                                    <then>
                                                        <block>{
                                                            <comment type="line">// traverse annotation if any</comment>
                                                            <if>if
                                                                <condition>(
                                                                    <expr>
                                                                        <call>
                                                                            <name><name>DOMUtil</name>.
                                                                                <name>getLocalName</name>
                                                                            </name>
                                                                            <argument_list>(
                                                                                <argument>
                                                                                    <expr>
                                                                                        <name>child</name>
                                                                                    </expr>
                                                                                </argument>
                                                                                )
                                                                            </argument_list>
                                                                        </call>
                                                                        .
                                                                        <call>
                                                                            <name>equals</name>
                                                                            <argument_list>(
                                                                                <argument>
                                                                                    <expr>
                                                                                        <name><name>SchemaSymbols</name>
                                                                                            .
                                                                                            <name>ELT_ANNOTATION</name>
                                                                                        </name>
                                                                                    </expr>
                                                                                </argument>
                                                                                )
                                                                            </argument_list>
                                                                        </call>
                                                                    </expr>
                                                                    )
                                                                </condition>
                                                                <then>
                                                                    <block>{
                                                                        <decl_stmt>
                                                                            <decl>
                                                                                <type>
                                                                                    <name>XSAnnotationImpl</name>
                                                                                </type>
                                                                                <name>annotation</name> =
                                                                                <init>
                                                                                    <expr>
                                                                                        <call>
                                                                                            <name>
                                                                                                traverseAnnotationDecl
                                                                                            </name>
                                                                                            <argument_list>(
                                                                                                <argument>
                                                                                                    <expr>
                                                                                                        <name>child
                                                                                                        </name>
                                                                                                    </expr>
                                                                                                </argument>
                                                                                                ,
                                                                                                <argument>
                                                                                                    <expr>
                                                                                                        <name>attrs
                                                                                                        </name>
                                                                                                    </expr>
                                                                                                </argument>
                                                                                                ,
                                                                                                <argument>
                                                                                                    <expr>false</expr>
                                                                                                </argument>
                                                                                                ,
                                                                                                <argument>
                                                                                                    <expr>
                                                                                                        <name>
                                                                                                            schemaDoc
                                                                                                        </name>
                                                                                                    </expr>
                                                                                                </argument>
                                                                                                )
                                                                                            </argument_list>
                                                                                        </call>
                                                                                    </expr>
                                                                                </init>
                                                                            </decl>
                                                                            ;
                                                                        </decl_stmt>
                                                                        <switch>switch
                                                                            <condition>(
                                                                                <expr>
                                                                                    <name>currentFacet</name>
                                                                                </expr>
                                                                                )
                                                                            </condition>
                                                                            <block>{
                                                                                <case>case
                                                                                    <expr>
                                                                                        <name><name>XSSimpleType</name>.
                                                                                            <name>FACET_MINLENGTH</name>
                                                                                        </name>
                                                                                    </expr>
                                                                                    :
                                                                                    <expr_stmt>
                                                                                        <expr>
                                                                                            <name><name>xsFacets</name>.
                                                                                                <name>
                                                                                                    minLengthAnnotation
                                                                                                </name>
                                                                                            </name>
                                                                                            =
                                                                                            <name>annotation</name>
                                                                                        </expr>
                                                                                        ;
                                                                                    </expr_stmt>
                                                                                    <break>break;</break>
                                                                                </case>
                                                                                <case>case
                                                                                    <expr>
                                                                                        <name><name>XSSimpleType</name>.
                                                                                            <name>FACET_MAXLENGTH</name>
                                                                                        </name>
                                                                                    </expr>
                                                                                    :
                                                                                    <expr_stmt>
                                                                                        <expr>
                                                                                            <name><name>xsFacets</name>.
                                                                                                <name>
                                                                                                    maxLengthAnnotation
                                                                                                </name>
                                                                                            </name>
                                                                                            =
                                                                                            <name>annotation</name>
                                                                                        </expr>
                                                                                        ;
                                                                                    </expr_stmt>
                                                                                    <break>break;</break>
                                                                                </case>
                                                                                <case>case
                                                                                    <expr>
                                                                                        <name><name>XSSimpleType</name>.
                                                                                            <name>FACET_MAXEXCLUSIVE
                                                                                            </name>
                                                                                        </name>
                                                                                    </expr>
                                                                                    :
                                                                                    <expr_stmt>
                                                                                        <expr>
                                                                                            <name><name>xsFacets</name>.
                                                                                                <name>
                                                                                                    maxExclusiveAnnotation
                                                                                                </name>
                                                                                            </name>
                                                                                            =
                                                                                            <name>annotation</name>
                                                                                        </expr>
                                                                                        ;
                                                                                    </expr_stmt>
                                                                                    <break>break;</break>
                                                                                </case>
                                                                                <case>case
                                                                                    <expr>
                                                                                        <name><name>XSSimpleType</name>.
                                                                                            <name>FACET_MAXINCLUSIVE
                                                                                            </name>
                                                                                        </name>
                                                                                    </expr>
                                                                                    :
                                                                                    <expr_stmt>
                                                                                        <expr>
                                                                                            <name><name>xsFacets</name>.
                                                                                                <name>
                                                                                                    maxInclusiveAnnotation
                                                                                                </name>
                                                                                            </name>
                                                                                            =
                                                                                            <name>annotation</name>
                                                                                        </expr>
                                                                                        ;
                                                                                    </expr_stmt>
                                                                                    <break>break;</break>
                                                                                </case>
                                                                                <case>case
                                                                                    <expr>
                                                                                        <name><name>XSSimpleType</name>.
                                                                                            <name>FACET_MINEXCLUSIVE
                                                                                            </name>
                                                                                        </name>
                                                                                    </expr>
                                                                                    :
                                                                                    <expr_stmt>
                                                                                        <expr>
                                                                                            <name><name>xsFacets</name>.
                                                                                                <name>
                                                                                                    minExclusiveAnnotation
                                                                                                </name>
                                                                                            </name>
                                                                                            =
                                                                                            <name>annotation</name>
                                                                                        </expr>
                                                                                        ;
                                                                                    </expr_stmt>
                                                                                    <break>break;</break>
                                                                                </case>
                                                                                <case>case
                                                                                    <expr>
                                                                                        <name><name>XSSimpleType</name>.
                                                                                            <name>FACET_MININCLUSIVE
                                                                                            </name>
                                                                                        </name>
                                                                                    </expr>
                                                                                    :
                                                                                    <expr_stmt>
                                                                                        <expr>
                                                                                            <name><name>xsFacets</name>.
                                                                                                <name>
                                                                                                    minInclusiveAnnotation
                                                                                                </name>
                                                                                            </name>
                                                                                            =
                                                                                            <name>annotation</name>
                                                                                        </expr>
                                                                                        ;
                                                                                    </expr_stmt>
                                                                                    <break>break;</break>
                                                                                </case>
                                                                                <case>case
                                                                                    <expr>
                                                                                        <name><name>XSSimpleType</name>.
                                                                                            <name>FACET_TOTALDIGITS
                                                                                            </name>
                                                                                        </name>
                                                                                    </expr>
                                                                                    :
                                                                                    <expr_stmt>
                                                                                        <expr>
                                                                                            <name><name>xsFacets</name>.
                                                                                                <name>
                                                                                                    totalDigitsAnnotation
                                                                                                </name>
                                                                                            </name>
                                                                                            =
                                                                                            <name>annotation</name>
                                                                                        </expr>
                                                                                        ;
                                                                                    </expr_stmt>
                                                                                    <break>break;</break>
                                                                                </case>
                                                                                <case>case
                                                                                    <expr>
                                                                                        <name><name>XSSimpleType</name>.
                                                                                            <name>FACET_FRACTIONDIGITS
                                                                                            </name>
                                                                                        </name>
                                                                                    </expr>
                                                                                    :
                                                                                    <expr_stmt>
                                                                                        <expr>
                                                                                            <name><name>xsFacets</name>.
                                                                                                <name>
                                                                                                    fractionDigitsAnnotation
                                                                                                </name>
                                                                                            </name>
                                                                                            =
                                                                                            <name>annotation</name>
                                                                                        </expr>
                                                                                        ;
                                                                                    </expr_stmt>
                                                                                    <break>break;</break>
                                                                                </case>
                                                                                <case>case
                                                                                    <expr>
                                                                                        <name><name>XSSimpleType</name>.
                                                                                            <name>FACET_WHITESPACE
                                                                                            </name>
                                                                                        </name>
                                                                                    </expr>
                                                                                    :
                                                                                    <expr_stmt>
                                                                                        <expr>
                                                                                            <name><name>xsFacets</name>.
                                                                                                <name>
                                                                                                    whiteSpaceAnnotation
                                                                                                </name>
                                                                                            </name>
                                                                                            =
                                                                                            <name>annotation</name>
                                                                                        </expr>
                                                                                        ;
                                                                                    </expr_stmt>
                                                                                    <break>break;</break>
                                                                                </case>
                                                                                <case>case
                                                                                    <expr>
                                                                                        <name><name>XSSimpleType</name>.
                                                                                            <name>FACET_LENGTH</name>
                                                                                        </name>
                                                                                    </expr>
                                                                                    :
                                                                                    <expr_stmt>
                                                                                        <expr>
                                                                                            <name><name>xsFacets</name>.
                                                                                                <name>lengthAnnotation
                                                                                                </name>
                                                                                            </name>
                                                                                            =
                                                                                            <name>annotation</name>
                                                                                        </expr>
                                                                                        ;
                                                                                    </expr_stmt>
                                                                                    <break>break;</break>
                                                                                </case>
                                                                                }
                                                                            </block>
                                                                        </switch>


                                                                        <expr_stmt>
                                                                            <expr>
                                                                                <name>child</name>
                                                                                =
                                                                                <call>
                                                                                    <name><name>DOMUtil</name>.
                                                                                        <name>getNextSiblingElement
                                                                                        </name>
                                                                                    </name>
                                                                                    <argument_list>(
                                                                                        <argument>
                                                                                            <expr>
                                                                                                <name>child</name>
                                                                                            </expr>
                                                                                        </argument>
                                                                                        )
                                                                                    </argument_list>
                                                                                </call>
                                                                            </expr>
                                                                            ;
                                                                        </expr_stmt>
                                                                        }
                                                                    </block>
                                                                </then>
                                                                <else>else
                                                                    <block>{
                                                                        <decl_stmt>
                                                                            <decl>
                                                                                <type>
                                                                                    <name>String</name>
                                                                                </type>
                                                                                <name>text</name> =
                                                                                <init>
                                                                                    <expr>
                                                                                        <call>
                                                                                            <name><name>DOMUtil</name>.
                                                                                                <name>
                                                                                                    getSyntheticAnnotation
                                                                                                </name>
                                                                                            </name>
                                                                                            <argument_list>(
                                                                                                <argument>
                                                                                                    <expr>
                                                                                                        <name>content
                                                                                                        </name>
                                                                                                    </expr>
                                                                                                </argument>
                                                                                                )
                                                                                            </argument_list>
                                                                                        </call>
                                                                                    </expr>
                                                                                </init>
                                                                            </decl>
                                                                            ;
                                                                        </decl_stmt>
                                                                        <if>if
                                                                            <condition>(
                                                                                <expr>
                                                                                    <name>text</name>
                                                                                    !=
                                                                                    <name>null</name>
                                                                                </expr>
                                                                                )
                                                                            </condition>
                                                                            <then>
                                                                                <block>{
                                                                                    <decl_stmt>
                                                                                        <decl>
                                                                                            <type>
                                                                                                <name>XSAnnotationImpl
                                                                                                </name>
                                                                                            </type>
                                                                                            <name>annotation</name> =
                                                                                            <init>
                                                                                                <expr>
                                                                                                    <call>
                                                                                                        <name>
                                                                                                            traverseSyntheticAnnotation
                                                                                                        </name>
                                                                                                        <argument_list>(
                                                                                                            <argument>
                                                                                                                <expr>
                                                                                                                    <name>
                                                                                                                        content
                                                                                                                    </name>
                                                                                                                </expr>
                                                                                                            </argument>
                                                                                                            ,
                                                                                                            <argument>
                                                                                                                <expr>
                                                                                                                    <name>
                                                                                                                        text
                                                                                                                    </name>
                                                                                                                </expr>
                                                                                                            </argument>
                                                                                                            ,
                                                                                                            <argument>
                                                                                                                <expr>
                                                                                                                    <name>
                                                                                                                        attrs
                                                                                                                    </name>
                                                                                                                </expr>
                                                                                                            </argument>
                                                                                                            ,
                                                                                                            <argument>
                                                                                                                <expr>
                                                                                                                    false
                                                                                                                </expr>
                                                                                                            </argument>
                                                                                                            ,
                                                                                                            <argument>
                                                                                                                <expr>
                                                                                                                    <name>
                                                                                                                        schemaDoc
                                                                                                                    </name>
                                                                                                                </expr>
                                                                                                            </argument>
                                                                                                            )
                                                                                                        </argument_list>
                                                                                                    </call>
                                                                                                </expr>
                                                                                            </init>
                                                                                        </decl>
                                                                                        ;
                                                                                    </decl_stmt>
                                                                                    <switch>switch
                                                                                        <condition>(
                                                                                            <expr>
                                                                                                <name>currentFacet
                                                                                                </name>
                                                                                            </expr>
                                                                                            )
                                                                                        </condition>
                                                                                        <block>{
                                                                                            <case>case
                                                                                                <expr>
                                                                                                    <name><name>
                                                                                                        XSSimpleType</name>
                                                                                                        .
                                                                                                        <name>
                                                                                                            FACET_MINLENGTH
                                                                                                        </name>
                                                                                                    </name>
                                                                                                </expr>
                                                                                                :
                                                                                                <expr_stmt>
                                                                                                    <expr>
                                                                                                        <name><name>
                                                                                                            xsFacets</name>
                                                                                                            .
                                                                                                            <name>
                                                                                                                minLengthAnnotation
                                                                                                            </name>
                                                                                                        </name>
                                                                                                        =
                                                                                                        <name>
                                                                                                            annotation
                                                                                                        </name>
                                                                                                    </expr>
                                                                                                    ;
                                                                                                </expr_stmt>
                                                                                                <break>break;</break>
                                                                                            </case>
                                                                                            <case>case
                                                                                                <expr>
                                                                                                    <name><name>
                                                                                                        XSSimpleType</name>
                                                                                                        .
                                                                                                        <name>
                                                                                                            FACET_MAXLENGTH
                                                                                                        </name>
                                                                                                    </name>
                                                                                                </expr>
                                                                                                :
                                                                                                <expr_stmt>
                                                                                                    <expr>
                                                                                                        <name><name>
                                                                                                            xsFacets</name>
                                                                                                            .
                                                                                                            <name>
                                                                                                                maxLengthAnnotation
                                                                                                            </name>
                                                                                                        </name>
                                                                                                        =
                                                                                                        <name>
                                                                                                            annotation
                                                                                                        </name>
                                                                                                    </expr>
                                                                                                    ;
                                                                                                </expr_stmt>
                                                                                                <break>break;</break>
                                                                                            </case>
                                                                                            <case>case
                                                                                                <expr>
                                                                                                    <name><name>
                                                                                                        XSSimpleType</name>
                                                                                                        .
                                                                                                        <name>
                                                                                                            FACET_MAXEXCLUSIVE
                                                                                                        </name>
                                                                                                    </name>
                                                                                                </expr>
                                                                                                :
                                                                                                <expr_stmt>
                                                                                                    <expr>
                                                                                                        <name><name>
                                                                                                            xsFacets</name>
                                                                                                            .
                                                                                                            <name>
                                                                                                                maxExclusiveAnnotation
                                                                                                            </name>
                                                                                                        </name>
                                                                                                        =
                                                                                                        <name>
                                                                                                            annotation
                                                                                                        </name>
                                                                                                    </expr>
                                                                                                    ;
                                                                                                </expr_stmt>
                                                                                                <break>break;</break>
                                                                                            </case>
                                                                                            <case>case
                                                                                                <expr>
                                                                                                    <name><name>
                                                                                                        XSSimpleType</name>
                                                                                                        .
                                                                                                        <name>
                                                                                                            FACET_MAXINCLUSIVE
                                                                                                        </name>
                                                                                                    </name>
                                                                                                </expr>
                                                                                                :
                                                                                                <expr_stmt>
                                                                                                    <expr>
                                                                                                        <name><name>
                                                                                                            xsFacets</name>
                                                                                                            .
                                                                                                            <name>
                                                                                                                maxInclusiveAnnotation
                                                                                                            </name>
                                                                                                        </name>
                                                                                                        =
                                                                                                        <name>
                                                                                                            annotation
                                                                                                        </name>
                                                                                                    </expr>
                                                                                                    ;
                                                                                                </expr_stmt>
                                                                                                <break>break;</break>
                                                                                            </case>
                                                                                            <case>case
                                                                                                <expr>
                                                                                                    <name><name>
                                                                                                        XSSimpleType</name>
                                                                                                        .
                                                                                                        <name>
                                                                                                            FACET_MINEXCLUSIVE
                                                                                                        </name>
                                                                                                    </name>
                                                                                                </expr>
                                                                                                :
                                                                                                <expr_stmt>
                                                                                                    <expr>
                                                                                                        <name><name>
                                                                                                            xsFacets</name>
                                                                                                            .
                                                                                                            <name>
                                                                                                                minExclusiveAnnotation
                                                                                                            </name>
                                                                                                        </name>
                                                                                                        =
                                                                                                        <name>
                                                                                                            annotation
                                                                                                        </name>
                                                                                                    </expr>
                                                                                                    ;
                                                                                                </expr_stmt>
                                                                                                <break>break;</break>
                                                                                            </case>
                                                                                            <case>case
                                                                                                <expr>
                                                                                                    <name><name>
                                                                                                        XSSimpleType</name>
                                                                                                        .
                                                                                                        <name>
                                                                                                            FACET_MININCLUSIVE
                                                                                                        </name>
                                                                                                    </name>
                                                                                                </expr>
                                                                                                :
                                                                                                <expr_stmt>
                                                                                                    <expr>
                                                                                                        <name><name>
                                                                                                            xsFacets</name>
                                                                                                            .
                                                                                                            <name>
                                                                                                                minInclusiveAnnotation
                                                                                                            </name>
                                                                                                        </name>
                                                                                                        =
                                                                                                        <name>
                                                                                                            annotation
                                                                                                        </name>
                                                                                                    </expr>
                                                                                                    ;
                                                                                                </expr_stmt>
                                                                                                <break>break;</break>
                                                                                            </case>
                                                                                            <case>case
                                                                                                <expr>
                                                                                                    <name><name>
                                                                                                        XSSimpleType</name>
                                                                                                        .
                                                                                                        <name>
                                                                                                            FACET_TOTALDIGITS
                                                                                                        </name>
                                                                                                    </name>
                                                                                                </expr>
                                                                                                :
                                                                                                <expr_stmt>
                                                                                                    <expr>
                                                                                                        <name><name>
                                                                                                            xsFacets</name>
                                                                                                            .
                                                                                                            <name>
                                                                                                                totalDigitsAnnotation
                                                                                                            </name>
                                                                                                        </name>
                                                                                                        =
                                                                                                        <name>
                                                                                                            annotation
                                                                                                        </name>
                                                                                                    </expr>
                                                                                                    ;
                                                                                                </expr_stmt>
                                                                                                <break>break;</break>
                                                                                            </case>
                                                                                            <case>case
                                                                                                <expr>
                                                                                                    <name><name>
                                                                                                        XSSimpleType</name>
                                                                                                        .
                                                                                                        <name>
                                                                                                            FACET_FRACTIONDIGITS
                                                                                                        </name>
                                                                                                    </name>
                                                                                                </expr>
                                                                                                :
                                                                                                <expr_stmt>
                                                                                                    <expr>
                                                                                                        <name><name>
                                                                                                            xsFacets</name>
                                                                                                            .
                                                                                                            <name>
                                                                                                                fractionDigitsAnnotation
                                                                                                            </name>
                                                                                                        </name>
                                                                                                        =
                                                                                                        <name>
                                                                                                            annotation
                                                                                                        </name>
                                                                                                    </expr>
                                                                                                    ;
                                                                                                </expr_stmt>
                                                                                                <break>break;</break>
                                                                                            </case>
                                                                                            <case>case
                                                                                                <expr>
                                                                                                    <name><name>
                                                                                                        XSSimpleType</name>
                                                                                                        .
                                                                                                        <name>
                                                                                                            FACET_WHITESPACE
                                                                                                        </name>
                                                                                                    </name>
                                                                                                </expr>
                                                                                                :
                                                                                                <expr_stmt>
                                                                                                    <expr>
                                                                                                        <name><name>
                                                                                                            xsFacets</name>
                                                                                                            .
                                                                                                            <name>
                                                                                                                whiteSpaceAnnotation
                                                                                                            </name>
                                                                                                        </name>
                                                                                                        =
                                                                                                        <name>
                                                                                                            annotation
                                                                                                        </name>
                                                                                                    </expr>
                                                                                                    ;
                                                                                                </expr_stmt>
                                                                                                <break>break;</break>
                                                                                            </case>
                                                                                            <case>case
                                                                                                <expr>
                                                                                                    <name><name>
                                                                                                        XSSimpleType</name>
                                                                                                        .
                                                                                                        <name>
                                                                                                            FACET_LENGTH
                                                                                                        </name>
                                                                                                    </name>
                                                                                                </expr>
                                                                                                :
                                                                                                <expr_stmt>
                                                                                                    <expr>
                                                                                                        <name><name>
                                                                                                            xsFacets</name>
                                                                                                            .
                                                                                                            <name>
                                                                                                                lengthAnnotation
                                                                                                            </name>
                                                                                                        </name>
                                                                                                        =
                                                                                                        <name>
                                                                                                            annotation
                                                                                                        </name>
                                                                                                    </expr>
                                                                                                    ;
                                                                                                </expr_stmt>
                                                                                                <break>break;</break>
                                                                                            </case>
                                                                                            }
                                                                                        </block>
                                                                                    </switch>
                                                                                    }
                                                                                </block>
                                                                            </then>
                                                                        </if>
                                                                        }
                                                                    </block>
                                                                </else>
                                                            </if>
                                                            <if>if
                                                                <condition>(
                                                                    <expr>
                                                                        <name>child</name>
                                                                        != <name>null</name> &amp;&amp;
                                                                        <call>
                                                                            <name><name>DOMUtil</name>.
                                                                                <name>getLocalName</name>
                                                                            </name>
                                                                            <argument_list>(
                                                                                <argument>
                                                                                    <expr>
                                                                                        <name>child</name>
                                                                                    </expr>
                                                                                </argument>
                                                                                )
                                                                            </argument_list>
                                                                        </call>
                                                                        .
                                                                        <call>
                                                                            <name>equals</name>
                                                                            <argument_list>(
                                                                                <argument>
                                                                                    <expr>
                                                                                        <name><name>SchemaSymbols</name>
                                                                                            .
                                                                                            <name>ELT_ANNOTATION</name>
                                                                                        </name>
                                                                                    </expr>
                                                                                </argument>
                                                                                )
                                                                            </argument_list>
                                                                        </call>
                                                                    </expr>
                                                                    )
                                                                </condition>
                                                                <then>
                                                                    <block>{
                                                                        <expr_stmt>
                                                                            <expr>
                                                                                <call>
                                                                                    <name>reportSchemaError</name>
                                                                                    <argument_list>(
                                                                                        <argument>
                                                                                            <expr>
                                                                                                "s4s-elt-must-match.1"
                                                                                            </expr>
                                                                                        </argument>
                                                                                        ,
                                                                                        <argument>
                                                                                            <expr>new
                                                                                                <name>
                                                                                                    <name>Object</name>
                                                                                                    <index>[]</index>
                                                                                                </name>
                                                                                                <block>{
                                                                                                    <expr>
                                                                                                        <name>facet
                                                                                                        </name>
                                                                                                    </expr>
                                                                                                    , <expr>
                                                                                                        "(annotation?)"</expr>,
                                                                                                    <expr>
                                                                                                        <call>
                                                                                                            <name><name>
                                                                                                                DOMUtil</name>
                                                                                                                .
                                                                                                                <name>
                                                                                                                    getLocalName
                                                                                                                </name>
                                                                                                            </name>
                                                                                                            <argument_list>
                                                                                                                (
                                                                                                                <argument>
                                                                                                                    <expr>
                                                                                                                        <name>
                                                                                                                            child
                                                                                                                        </name>
                                                                                                                    </expr>
                                                                                                                </argument>
                                                                                                                )
                                                                                                            </argument_list>
                                                                                                        </call>
                                                                                                    </expr>
                                                                                                    }
                                                                                                </block>
                                                                                            </expr>
                                                                                        </argument>
                                                                                        ,
                                                                                        <argument>
                                                                                            <expr>
                                                                                                <name>child</name>
                                                                                            </expr>
                                                                                        </argument>
                                                                                        )
                                                                                    </argument_list>
                                                                                </call>
                                                                            </expr>
                                                                            ;
                                                                        </expr_stmt>
                                                                        }
                                                                    </block>
                                                                </then>
                                                            </if>
                                                            }
                                                        </block>
                                                    </then>
                                                </if>
                                                }
                                            </block>
                                        </else>
                                    </if>
                                </else>
                            </if>
                            <expr_stmt>
                                <expr>
                                    <call>
                                        <name><name>fAttrChecker</name>.
                                            <name>returnAttrArray</name>
                                        </name>
                                        <argument_list>(
                                            <argument>
                                                <expr>
                                                    <name>attrs</name>
                                                </expr>
                                            </argument>
                                            ,
                                            <argument>
                                                <expr>
                                                    <name>schemaDoc</name>
                                                </expr>
                                            </argument>
                                            )
                                        </argument_list>
                                    </call>
                                </expr>
                                ;
                            </expr_stmt>
                            <expr_stmt>
                                <expr>
                                    <name>content</name>
                                    =
                                    <call>
                                        <name><name>DOMUtil</name>.
                                            <name>getNextSiblingElement</name>
                                        </name>
                                        <argument_list>(
                                            <argument>
                                                <expr>
                                                    <name>content</name>
                                                </expr>
                                            </argument>
                                            )
                                        </argument_list>
                                    </call>
                                </expr>
                                ;
                            </expr_stmt>
                            }
                        </block>
                    </while>
                    <if>if
                        <condition>(
                            <expr>
                                <name>enumData</name>
                                !=
                                <name>null</name>
                            </expr>
                            )
                        </condition>
                        <then>
                            <block>{
                                <expr_stmt>
                                    <expr>
                                        <name>facetsPresent</name>
                                        |=
                                        <name><name>XSSimpleType</name>.
                                            <name>FACET_ENUMERATION</name>
                                        </name>
                                    </expr>
                                    ;
                                </expr_stmt>
                                <expr_stmt>
                                    <expr>
                                        <name><name>xsFacets</name>.
                                            <name>enumeration</name>
                                        </name>
                                        =
                                        <name>enumData</name>
                                    </expr>
                                    ;
                                </expr_stmt>
                                <expr_stmt>
                                    <expr>
                                        <name><name>xsFacets</name>.
                                            <name>enumNSDecls</name>
                                        </name>
                                        =
                                        <name>enumNSDecls</name>
                                    </expr>
                                    ;
                                </expr_stmt>
                                <expr_stmt>
                                    <expr>
                                        <name><name>xsFacets</name>.
                                            <name>enumAnnotations</name>
                                        </name>
                                        =
                                        <name>enumAnnotations</name>
                                    </expr>
                                    ;
                                </expr_stmt>
                                }
                            </block>
                        </then>
                    </if>
                    <if>if
                        <condition>(
                            <expr>
                                <call>
                                    <name><name>fPattern</name>.
                                        <name>length</name>
                                    </name>
                                    <argument_list>()</argument_list>
                                </call>
                                != 0
                            </expr>
                            )
                        </condition>
                        <then>
                            <block>{
                                <expr_stmt>
                                    <expr>
                                        <name>facetsPresent</name>
                                        |=
                                        <name><name>XSSimpleType</name>.
                                            <name>FACET_PATTERN</name>
                                        </name>
                                    </expr>
                                    ;
                                </expr_stmt>
                                <expr_stmt>
                                    <expr>
                                        <name><name>xsFacets</name>.
                                            <name>pattern</name>
                                        </name>
                                        =
                                        <call>
                                            <name><name>fPattern</name>.
                                                <name>toString</name>
                                            </name>
                                            <argument_list>()</argument_list>
                                        </call>
                                    </expr>
                                    ;
                                </expr_stmt>
                                <expr_stmt>
                                    <expr>
                                        <name><name>xsFacets</name>.
                                            <name>patternAnnotations</name>
                                        </name>
                                        =
                                        <name>patternAnnotations</name>
                                    </expr>
                                    ;
                                </expr_stmt>
                                }
                            </block>
                        </then>
                    </if>

                    <expr_stmt>
                        <expr>
                            <call>
                                <name><name>fPattern</name>.
                                    <name>setLength</name>
                                </name>
                                <argument_list>(
                                    <argument>
                                        <expr>0</expr>
                                    </argument>
                                    )
                                </argument_list>
                            </call>
                        </expr>
                        ;
                    </expr_stmt>

                    <decl_stmt>
                        <decl>
                            <type>
                                <name>FacetInfo</name>
                            </type>
                            <name>fi</name> =
                            <init>
                                <expr>new
                                    <call>
                                        <name>FacetInfo</name>
                                        <argument_list>()</argument_list>
                                    </call>
                                </expr>
                            </init>
                        </decl>
                        ;
                    </decl_stmt>
                    <expr_stmt>
                        <expr>
                            <name><name>fi</name>.
                                <name>facetdata</name>
                            </name>
                            =
                            <name>xsFacets</name>
                        </expr>
                        ;
                    </expr_stmt>
                    <expr_stmt>
                        <expr>
                            <name><name>fi</name>.
                                <name>nodeAfterFacets</name>
                            </name>
                            =
                            <name>content</name>
                        </expr>
                        ;
                    </expr_stmt>
                    <expr_stmt>
                        <expr>
                            <name><name>fi</name>.
                                <name>fPresentFacets</name>
                            </name>
                            =
                            <name>facetsPresent</name>
                        </expr>
                        ;
                    </expr_stmt>
                    <expr_stmt>
                        <expr>
                            <name><name>fi</name>.
                                <name>fFixedFacets</name>
                            </name>
                            =
                            <name>facetsFixed</name>
                        </expr>
                        ;
                    </expr_stmt>
                    <return>return
                        <expr>
                            <name>fi</name>
                        </expr>
                        ;
                    </return>
                    }
                </block>
            </function>


            <comment type="line">// return whether QName/NOTATION is part of the given type</comment>
            <function>
                <type>
                    <specifier>private</specifier>
                    <name>boolean</name>
                </type>
                <name>containsQName</name>
                <parameter_list>(
                    <param>
                        <decl>
                            <type>
                                <name>XSSimpleType</name>
                            </type>
                            <name>type</name>
                        </decl>
                    </param>
                    )
                </parameter_list>
                <block>{
                    <if>if
                        <condition>(
                            <expr>
                                <call>
                                    <name><name>type</name>.
                                        <name>getVariety</name>
                                    </name>
                                    <argument_list>()</argument_list>
                                </call>
                                ==
                                <name><name>XSSimpleType</name>.
                                    <name>VARIETY_ATOMIC</name>
                                </name>
                            </expr>
                            )
                        </condition>
                        <then>
                            <block>{
                                <decl_stmt>
                                    <decl>
                                        <type>
                                            <name>short</name>
                                        </type>
                                        <name>primitive</name> =
                                        <init>
                                            <expr>
                                                <call>
                                                    <name><name>type</name>.
                                                        <name>getPrimitiveKind</name>
                                                    </name>
                                                    <argument_list>()</argument_list>
                                                </call>
                                            </expr>
                                        </init>
                                    </decl>
                                    ;
                                </decl_stmt>
                                <return>return
                                    <expr>(<name>primitive</name> ==
                                        <name><name>XSSimpleType</name>.
                                            <name>PRIMITIVE_QNAME</name>
                                        </name>
                                        ||
                                        <name>primitive</name>
                                        ==
                                        <name><name>XSSimpleType</name>.
                                            <name>PRIMITIVE_NOTATION</name>
                                        </name>
                                        )
                                    </expr>
                                    ;
                                </return>
                                }
                            </block>
                        </then>
                        <else>else
                            <if>if
                                <condition>(
                                    <expr>
                                        <call>
                                            <name><name>type</name>.
                                                <name>getVariety</name>
                                            </name>
                                            <argument_list>()</argument_list>
                                        </call>
                                        ==
                                        <name><name>XSSimpleType</name>.
                                            <name>VARIETY_LIST</name>
                                        </name>
                                    </expr>
                                    )
                                </condition>
                                <then>
                                    <block>{
                                        <return>return
                                            <expr>
                                                <call>
                                                    <name>containsQName</name>
                                                    <argument_list>(
                                                        <argument>
                                                            <expr>(<name>XSSimpleType</name>)
                                                                <call>
                                                                    <name><name>type</name>.
                                                                        <name>getItemType</name>
                                                                    </name>
                                                                    <argument_list>()</argument_list>
                                                                </call>
                                                            </expr>
                                                        </argument>
                                                        )
                                                    </argument_list>
                                                </call>
                                            </expr>
                                            ;
                                        </return>
                                        }
                                    </block>
                                </then>
                                <else>else
                                    <if>if
                                        <condition>(
                                            <expr>
                                                <call>
                                                    <name><name>type</name>.
                                                        <name>getVariety</name>
                                                    </name>
                                                    <argument_list>()</argument_list>
                                                </call>
                                                ==
                                                <name><name>XSSimpleType</name>.
                                                    <name>VARIETY_UNION</name>
                                                </name>
                                            </expr>
                                            )
                                        </condition>
                                        <then>
                                            <block>{
                                                <decl_stmt>
                                                    <decl>
                                                        <type>
                                                            <name>XSObjectList</name>
                                                        </type>
                                                        <name>members</name> =
                                                        <init>
                                                            <expr>
                                                                <call>
                                                                    <name><name>type</name>.
                                                                        <name>getMemberTypes</name>
                                                                    </name>
                                                                    <argument_list>()</argument_list>
                                                                </call>
                                                            </expr>
                                                        </init>
                                                    </decl>
                                                    ;
                                                </decl_stmt>
                                                <for>for (
                                                    <init>
                                                        <decl>
                                                            <type>
                                                                <name>int</name>
                                                            </type>
                                                            <name>i</name> =
                                                            <init>
                                                                <expr>0</expr>
                                                            </init>
                                                        </decl>
                                                        ;
                                                    </init>
                                                    <condition>
                                                        <expr>
                                                            <name>i</name>
                                                            &lt;
                                                            <call>
                                                                <name><name>members</name>.
                                                                    <name>getLength</name>
                                                                </name>
                                                                <argument_list>()</argument_list>
                                                            </call>
                                                        </expr>
                                                        ;
                                                    </condition>
                                                    <incr>
                                                        <expr><name>i</name>++
                                                        </expr>
                                                    </incr>
                                                    )
                                                    <block>{
                                                        <if>if
                                                            <condition>(
                                                                <expr>
                                                                    <call>
                                                                        <name>containsQName</name>
                                                                        <argument_list>(
                                                                            <argument>
                                                                                <expr>(<name>XSSimpleType</name>)
                                                                                    <call>
                                                                                        <name><name>members</name>.
                                                                                            <name>item</name>
                                                                                        </name>
                                                                                        <argument_list>(
                                                                                            <argument>
                                                                                                <expr>
                                                                                                    <name>i</name>
                                                                                                </expr>
                                                                                            </argument>
                                                                                            )
                                                                                        </argument_list>
                                                                                    </call>
                                                                                </expr>
                                                                            </argument>
                                                                            )
                                                                        </argument_list>
                                                                    </call>
                                                                </expr>
                                                                )
                                                            </condition>
                                                            <then>
                                                                <return>return <expr>true</expr>;
                                                                </return>
                                                            </then>
                                                        </if>
                                                        }
                                                    </block>
                                                </for>
                                                }
                                            </block>
                                        </then>
                                    </if>
                                </else>
                            </if>
                        </else>
                    </if>
                    <return>return <expr>false</expr>;
                    </return>
                    }
                </block>
            </function>

            <comment type="line">//</comment>
            <comment type="line">// Traverse a set of attribute and attribute group elements</comment>
            <comment type="line">// Needed by complexType and attributeGroup traversal</comment>
            <comment type="line">// This method will return the first non-attribute/attrgrp found</comment>
            <comment type="line">//</comment>
            <function>
                <type>
                    <name>Element</name>
                </type>
                <name>traverseAttrsAndAttrGrps</name>
                <parameter_list>(
                    <param>
                        <decl>
                            <type>
                                <name>Element</name>
                            </type>
                            <name>firstAttr</name>
                        </decl>
                    </param>
                    ,
                    <param>
                        <decl>
                            <type>
                                <name>XSAttributeGroupDecl</name>
                            </type>
                            <name>attrGrp</name>
                        </decl>
                    </param>
                    ,
                    <param>
                        <decl>
                            <type>
                                <name>XSDocumentInfo</name>
                            </type>
                            <name>schemaDoc</name>
                        </decl>
                    </param>
                    ,
                    <param>
                        <decl>
                            <type>
                                <name>SchemaGrammar</name>
                            </type>
                            <name>grammar</name>
                        </decl>
                    </param>
                    ,
                    <param>
                        <decl>
                            <type>
                                <name>XSComplexTypeDecl</name>
                            </type>
                            <name>enclosingCT</name>
                        </decl>
                    </param>
                    )
                </parameter_list>
                <block>{

                    <decl_stmt>
                        <decl>
                            <type>
                                <name>Element</name>
                            </type>
                            <name>child</name>=
                            <init>
                                <expr>
                                    <name>null</name>
                                </expr>
                            </init>
                        </decl>
                        ;
                    </decl_stmt>
                    <decl_stmt>
                        <decl>
                            <type>
                                <name>XSAttributeGroupDecl</name>
                            </type>
                            <name>tempAttrGrp</name> =
                            <init>
                                <expr>
                                    <name>null</name>
                                </expr>
                            </init>
                        </decl>
                        ;
                    </decl_stmt>
                    <decl_stmt>
                        <decl>
                            <type>
                                <name>XSAttributeUseImpl</name>
                            </type>
                            <name>tempAttrUse</name> =
                            <init>
                                <expr>
                                    <name>null</name>
                                </expr>
                            </init>
                        </decl>
                        ;
                    </decl_stmt>
                    <decl_stmt>
                        <decl>
                            <type>
                                <name>String</name>
                            </type>
                            <name>childName</name>
                        </decl>
                        ;
                    </decl_stmt>

                    <for>for (
                        <init>
                            <expr><name>child</name>=
                                <name>firstAttr</name>
                            </expr>
                            ;
                        </init>
                        <condition>
                            <expr><name>child</name>!=
                                <name>null</name>
                            </expr>
                            ;
                        </condition>
                        <incr>
                            <expr><name>child</name>=
                                <call>
                                    <name><name>DOMUtil</name>.
                                        <name>getNextSiblingElement</name>
                                    </name>
                                    <argument_list>(
                                        <argument>
                                            <expr>
                                                <name>child</name>
                                            </expr>
                                        </argument>
                                        )
                                    </argument_list>
                                </call>
                            </expr>
                        </incr>
                        )
                        <block>{
                            <expr_stmt>
                                <expr>
                                    <name>childName</name>
                                    =
                                    <call>
                                        <name><name>DOMUtil</name>.
                                            <name>getLocalName</name>
                                        </name>
                                        <argument_list>(
                                            <argument>
                                                <expr>
                                                    <name>child</name>
                                                </expr>
                                            </argument>
                                            )
                                        </argument_list>
                                    </call>
                                </expr>
                                ;
                            </expr_stmt>
                            <if>if
                                <condition>(
                                    <expr>
                                        <call>
                                            <name><name>childName</name>.
                                                <name>equals</name>
                                            </name>
                                            <argument_list>(
                                                <argument>
                                                    <expr>
                                                        <name><name>SchemaSymbols</name>.
                                                            <name>ELT_ATTRIBUTE</name>
                                                        </name>
                                                    </expr>
                                                </argument>
                                                )
                                            </argument_list>
                                        </call>
                                    </expr>
                                    )
                                </condition>
                                <then>
                                    <block>{
                                        <expr_stmt>
                                            <expr>
                                                <name>tempAttrUse</name>
                                                =
                                                <call>
                                                    <name><name>fSchemaHandler</name>.<name>fAttributeTraverser</name>.
                                                        <name>traverseLocal</name>
                                                    </name>
                                                    <argument_list>(
                                                        <argument>
                                                            <expr>
                                                                <name>child</name>
                                                            </expr>
                                                        </argument>
                                                        ,
                                                        <argument>
                                                            <expr>
                                                                <name>schemaDoc</name>
                                                            </expr>
                                                        </argument>
                                                        ,
                                                        <argument>
                                                            <expr>
                                                                <name>grammar</name>
                                                            </expr>
                                                        </argument>
                                                        ,
                                                        <argument>
                                                            <expr>
                                                                <name>enclosingCT</name>
                                                            </expr>
                                                        </argument>
                                                        )
                                                    </argument_list>
                                                </call>
                                            </expr>
                                            ;
                                        </expr_stmt>
                                        <if>if
                                            <condition>(
                                                <expr>
                                                    <name>tempAttrUse</name>
                                                    ==
                                                    <name>null</name>
                                                </expr>
                                                )
                                            </condition>
                                            <then>
                                                <break>break;</break>
                                            </then>
                                        </if>
                                        <if>if
                                            <condition>(
                                                <expr>
                                                    <call>
                                                        <name><name>attrGrp</name>.
                                                            <name>getAttributeUse</name>
                                                        </name>
                                                        <argument_list>(
                                                            <argument>
                                                                <expr>
                                                                    <call>
                                                                        <name><name>tempAttrUse</name>.<name>
                                                                            fAttrDecl</name>.
                                                                            <name>getNamespace</name>
                                                                        </name>
                                                                        <argument_list>()</argument_list>
                                                                    </call>
                                                                </expr>
                                                            </argument>
                                                            ,
                                                            <argument>
                                                                <expr>
                                                                    <call>
                                                                        <name><name>tempAttrUse</name>.<name>
                                                                            fAttrDecl</name>.
                                                                            <name>getName</name>
                                                                        </name>
                                                                        <argument_list>()</argument_list>
                                                                    </call>
                                                                </expr>
                                                            </argument>
                                                            )
                                                        </argument_list>
                                                    </call>
                                                    ==
                                                    <name>null</name>
                                                </expr>
                                                )
                                            </condition>
                                            <then>
                                                <block>{
                                                    <decl_stmt>
                                                        <decl>
                                                            <type>
                                                                <name>String</name>
                                                            </type>
                                                            <name>idName</name> =
                                                            <init>
                                                                <expr>
                                                                    <call>
                                                                        <name><name>attrGrp</name>.
                                                                            <name>addAttributeUse</name>
                                                                        </name>
                                                                        <argument_list>(
                                                                            <argument>
                                                                                <expr>
                                                                                    <name>tempAttrUse</name>
                                                                                </expr>
                                                                            </argument>
                                                                            )
                                                                        </argument_list>
                                                                    </call>
                                                                </expr>
                                                            </init>
                                                        </decl>
                                                        ;
                                                    </decl_stmt>
                                                    <if>if
                                                        <condition>(
                                                            <expr>
                                                                <name>idName</name>
                                                                !=
                                                                <name>null</name>
                                                            </expr>
                                                            )
                                                        </condition>
                                                        <then>
                                                            <block>{
                                                                <decl_stmt>
                                                                    <decl>
                                                                        <type>
                                                                            <name>String</name>
                                                                        </type>
                                                                        <name>code</name> =
                                                                        <init>
                                                                            <expr>(<name>enclosingCT</name> == <name>
                                                                                null</name>) ? "ag-props-correct.3" :
                                                                                "ct-props-correct.5"
                                                                            </expr>
                                                                        </init>
                                                                    </decl>
                                                                    ;
                                                                </decl_stmt>
                                                                <decl_stmt>
                                                                    <decl>
                                                                        <type>
                                                                            <name>String</name>
                                                                        </type>
                                                                        <name>name</name> =
                                                                        <init>
                                                                            <expr>(<name>enclosingCT</name> == <name>
                                                                                null</name>) ?
                                                                                <name><name>attrGrp</name>.
                                                                                    <name>fName</name>
                                                                                </name>
                                                                                :
                                                                                <call>
                                                                                    <name><name>enclosingCT</name>.
                                                                                        <name>getName</name>
                                                                                    </name>
                                                                                    <argument_list>()</argument_list>
                                                                                </call>
                                                                            </expr>
                                                                        </init>
                                                                    </decl>
                                                                    ;
                                                                </decl_stmt>
                                                                <expr_stmt>
                                                                    <expr>
                                                                        <call>
                                                                            <name>reportSchemaError</name>
                                                                            <argument_list>(
                                                                                <argument>
                                                                                    <expr>
                                                                                        <name>code</name>
                                                                                    </expr>
                                                                                </argument>
                                                                                ,
                                                                                <argument>
                                                                                    <expr>new
                                                                                        <name>
                                                                                            <name>Object</name>
                                                                                            <index>[]</index>
                                                                                        </name>
                                                                                        <block>{
                                                                                            <expr>
                                                                                                <name>name</name>
                                                                                            </expr>
                                                                                            ,
                                                                                            <expr>
                                                                                                <call>
                                                                                                    <name><name>
                                                                                                        tempAttrUse</name>
                                                                                                        .<name>
                                                                                                            fAttrDecl</name>.
                                                                                                        <name>getName
                                                                                                        </name>
                                                                                                    </name>
                                                                                                    <argument_list>()
                                                                                                    </argument_list>
                                                                                                </call>
                                                                                            </expr>
                                                                                            ,
                                                                                            <expr>
                                                                                                <name>idName</name>
                                                                                            </expr>
                                                                                            }
                                                                                        </block>
                                                                                    </expr>
                                                                                </argument>
                                                                                ,
                                                                                <argument>
                                                                                    <expr>
                                                                                        <name>child</name>
                                                                                    </expr>
                                                                                </argument>
                                                                                )
                                                                            </argument_list>
                                                                        </call>
                                                                    </expr>
                                                                    ;
                                                                </expr_stmt>
                                                                }
                                                            </block>
                                                        </then>
                                                    </if>
                                                    }
                                                </block>
                                            </then>
                                            <else>else
                                                <block>{
                                                    <comment type="line">// REVISIT: what if one of the attribute uses
                                                        is "prohibited"
                                                    </comment>
                                                    <decl_stmt>
                                                        <decl>
                                                            <type>
                                                                <name>String</name>
                                                            </type>
                                                            <name>code</name> =
                                                            <init>
                                                                <expr>(<name>enclosingCT</name> == <name>null</name>) ?
                                                                    "ag-props-correct.2" : "ct-props-correct.4"
                                                                </expr>
                                                            </init>
                                                        </decl>
                                                        ;
                                                    </decl_stmt>
                                                    <decl_stmt>
                                                        <decl>
                                                            <type>
                                                                <name>String</name>
                                                            </type>
                                                            <name>name</name> =
                                                            <init>
                                                                <expr>(<name>enclosingCT</name> == <name>null</name>) ?
                                                                    <name><name>attrGrp</name>.
                                                                        <name>fName</name>
                                                                    </name>
                                                                    :
                                                                    <call>
                                                                        <name><name>enclosingCT</name>.
                                                                            <name>getName</name>
                                                                        </name>
                                                                        <argument_list>()</argument_list>
                                                                    </call>
                                                                </expr>
                                                            </init>
                                                        </decl>
                                                        ;
                                                    </decl_stmt>
                                                    <expr_stmt>
                                                        <expr>
                                                            <call>
                                                                <name>reportSchemaError</name>
                                                                <argument_list>(
                                                                    <argument>
                                                                        <expr>
                                                                            <name>code</name>
                                                                        </expr>
                                                                    </argument>
                                                                    ,
                                                                    <argument>
                                                                        <expr>new
                                                                            <name>
                                                                                <name>Object</name>
                                                                                <index>[]</index>
                                                                            </name>
                                                                            <block>{
                                                                                <expr>
                                                                                    <name>name</name>
                                                                                </expr>
                                                                                ,
                                                                                <expr>
                                                                                    <call>
                                                                                        <name><name>tempAttrUse</name>
                                                                                            .<name>fAttrDecl</name>.
                                                                                            <name>getName</name>
                                                                                        </name>
                                                                                        <argument_list>()
                                                                                        </argument_list>
                                                                                    </call>
                                                                                </expr>
                                                                                }
                                                                            </block>
                                                                        </expr>
                                                                    </argument>
                                                                    ,
                                                                    <argument>
                                                                        <expr>
                                                                            <name>child</name>
                                                                        </expr>
                                                                    </argument>
                                                                    )
                                                                </argument_list>
                                                            </call>
                                                        </expr>
                                                        ;
                                                    </expr_stmt>
                                                    }
                                                </block>
                                            </else>
                                        </if>
                                        }
                                    </block>
                                </then>
                                <else>else
                                    <if>if
                                        <condition>(
                                            <expr>
                                                <call>
                                                    <name><name>childName</name>.
                                                        <name>equals</name>
                                                    </name>
                                                    <argument_list>(
                                                        <argument>
                                                            <expr>
                                                                <name><name>SchemaSymbols</name>.
                                                                    <name>ELT_ATTRIBUTEGROUP</name>
                                                                </name>
                                                            </expr>
                                                        </argument>
                                                        )
                                                    </argument_list>
                                                </call>
                                            </expr>
                                            )
                                        </condition>
                                        <then>
                                            <block>{
                                                <comment type="line">//REVISIT: do we need to save some state at this
                                                    point??
                                                </comment>
                                                <expr_stmt>
                                                    <expr>
                                                        <name>tempAttrGrp</name>
                                                        =
                                                        <call>
                                                            <name><name>fSchemaHandler</name>.<name>
                                                                fAttributeGroupTraverser</name>.
                                                                <name>traverseLocal</name>
                                                            </name>
                                                            <argument_list>(
                                                                <argument>
                                                                    <expr>
                                                                        <name>child</name>
                                                                    </expr>
                                                                </argument>
                                                                ,
                                                                <argument>
                                                                    <expr>
                                                                        <name>schemaDoc</name>
                                                                    </expr>
                                                                </argument>
                                                                ,
                                                                <argument>
                                                                    <expr>
                                                                        <name>grammar</name>
                                                                    </expr>
                                                                </argument>
                                                                )
                                                            </argument_list>
                                                        </call>
                                                    </expr>
                                                    ;
                                                </expr_stmt>
                                                <if>if
                                                    <condition>(
                                                        <expr>
                                                            <name>tempAttrGrp</name>
                                                            ==
                                                            <name>null</name>
                                                        </expr>
                                                        )
                                                    </condition>
                                                    <then>
                                                        <break>break;</break>
                                                    </then>
                                                </if>
                                                <decl_stmt>
                                                    <decl>
                                                        <type>
                                                            <name>XSObjectList</name>
                                                        </type>
                                                        <name>attrUseS</name> =
                                                        <init>
                                                            <expr>
                                                                <call>
                                                                    <name><name>tempAttrGrp</name>.
                                                                        <name>getAttributeUses</name>
                                                                    </name>
                                                                    <argument_list>()</argument_list>
                                                                </call>
                                                            </expr>
                                                        </init>
                                                    </decl>
                                                    ;
                                                </decl_stmt>
                                                <decl_stmt>
                                                    <decl>
                                                        <type>
                                                            <name>XSAttributeUseImpl</name>
                                                        </type>
                                                        <name>existingAttrUse</name> =
                                                        <init>
                                                            <expr>
                                                                <name>null</name>
                                                            </expr>
                                                        </init>
                                                        ,
                                                        <name>oneAttrUse</name>
                                                    </decl>
                                                    ;
                                                </decl_stmt>
                                                <decl_stmt>
                                                    <decl>
                                                        <type>
                                                            <name>int</name>
                                                        </type>
                                                        <name>attrCount</name> =
                                                        <init>
                                                            <expr>
                                                                <call>
                                                                    <name><name>attrUseS</name>.
                                                                        <name>getLength</name>
                                                                    </name>
                                                                    <argument_list>()</argument_list>
                                                                </call>
                                                            </expr>
                                                        </init>
                                                    </decl>
                                                    ;
                                                </decl_stmt>
                                                <for>for (
                                                    <init>
                                                        <decl>
                                                            <type>
                                                                <name>int</name>
                                                            </type>
                                                            <name>i</name>=
                                                            <init>
                                                                <expr>0</expr>
                                                            </init>
                                                        </decl>
                                                        ;
                                                    </init>
                                                    <condition>
                                                        <expr><name>i</name>&lt;
                                                            <name>attrCount</name>
                                                        </expr>
                                                        ;
                                                    </condition>
                                                    <incr>
                                                        <expr><name>i</name>++
                                                        </expr>
                                                    </incr>
                                                    )
                                                    <block>{
                                                        <expr_stmt>
                                                            <expr>
                                                                <name>oneAttrUse</name>
                                                                = (<name>XSAttributeUseImpl</name>)
                                                                <call>
                                                                    <name><name>attrUseS</name>.
                                                                        <name>item</name>
                                                                    </name>
                                                                    <argument_list>(
                                                                        <argument>
                                                                            <expr>
                                                                                <name>i</name>
                                                                            </expr>
                                                                        </argument>
                                                                        )
                                                                    </argument_list>
                                                                </call>
                                                            </expr>
                                                            ;
                                                        </expr_stmt>
                                                        <if>if
                                                            <condition>(
                                                                <expr>
                                                                    <name>existingAttrUse</name>
                                                                    ==
                                                                    <call>
                                                                        <name><name>attrGrp</name>.
                                                                            <name>getAttributeUse</name>
                                                                        </name>
                                                                        <argument_list>(
                                                                            <argument>
                                                                                <expr>
                                                                                    <call>
                                                                                        <name><name>oneAttrUse</name>
                                                                                            .<name>fAttrDecl</name>.
                                                                                            <name>getNamespace</name>
                                                                                        </name>
                                                                                        <argument_list>()
                                                                                        </argument_list>
                                                                                    </call>
                                                                                </expr>
                                                                            </argument>
                                                                            ,
                                                                            <argument>
                                                                                <expr>
                                                                                    <call>
                                                                                        <name><name>oneAttrUse</name>
                                                                                            .<name>fAttrDecl</name>.
                                                                                            <name>getName</name>
                                                                                        </name>
                                                                                        <argument_list>()
                                                                                        </argument_list>
                                                                                    </call>
                                                                                </expr>
                                                                            </argument>
                                                                            )
                                                                        </argument_list>
                                                                    </call>
                                                                </expr>
                                                                )
                                                            </condition>
                                                            <then>
                                                                <block>{
                                                                    <decl_stmt>
                                                                        <decl>
                                                                            <type>
                                                                                <name>String</name>
                                                                            </type>
                                                                            <name>idName</name> =
                                                                            <init>
                                                                                <expr>
                                                                                    <call>
                                                                                        <name><name>attrGrp</name>.
                                                                                            <name>addAttributeUse</name>
                                                                                        </name>
                                                                                        <argument_list>(
                                                                                            <argument>
                                                                                                <expr>
                                                                                                    <name>oneAttrUse
                                                                                                    </name>
                                                                                                </expr>
                                                                                            </argument>
                                                                                            )
                                                                                        </argument_list>
                                                                                    </call>
                                                                                </expr>
                                                                            </init>
                                                                        </decl>
                                                                        ;
                                                                    </decl_stmt>
                                                                    <if>if
                                                                        <condition>(
                                                                            <expr>
                                                                                <name>idName</name>
                                                                                !=
                                                                                <name>null</name>
                                                                            </expr>
                                                                            )
                                                                        </condition>
                                                                        <then>
                                                                            <block>{
                                                                                <decl_stmt>
                                                                                    <decl>
                                                                                        <type>
                                                                                            <name>String</name>
                                                                                        </type>
                                                                                        <name>code</name> =
                                                                                        <init>
                                                                                            <expr>(<name>enclosingCT
                                                                                            </name> == <name>null</name>)
                                                                                                ? "ag-props-correct.3" :
                                                                                                "ct-props-correct.5"
                                                                                            </expr>
                                                                                        </init>
                                                                                    </decl>
                                                                                    ;
                                                                                </decl_stmt>
                                                                                <decl_stmt>
                                                                                    <decl>
                                                                                        <type>
                                                                                            <name>String</name>
                                                                                        </type>
                                                                                        <name>name</name> =
                                                                                        <init>
                                                                                            <expr>(<name>enclosingCT
                                                                                            </name> == <name>null</name>)
                                                                                                ?
                                                                                                <name><name>
                                                                                                    attrGrp</name>.
                                                                                                    <name>fName</name>
                                                                                                </name>
                                                                                                :
                                                                                                <call>
                                                                                                    <name><name>
                                                                                                        enclosingCT</name>
                                                                                                        .
                                                                                                        <name>getName
                                                                                                        </name>
                                                                                                    </name>
                                                                                                    <argument_list>()
                                                                                                    </argument_list>
                                                                                                </call>
                                                                                            </expr>
                                                                                        </init>
                                                                                    </decl>
                                                                                    ;
                                                                                </decl_stmt>
                                                                                <expr_stmt>
                                                                                    <expr>
                                                                                        <call>
                                                                                            <name>reportSchemaError
                                                                                            </name>
                                                                                            <argument_list>(
                                                                                                <argument>
                                                                                                    <expr>
                                                                                                        <name>code
                                                                                                        </name>
                                                                                                    </expr>
                                                                                                </argument>
                                                                                                ,
                                                                                                <argument>
                                                                                                    <expr>new
                                                                                                        <name>
                                                                                                            <name>
                                                                                                                Object
                                                                                                            </name>
                                                                                                            <index>[]
                                                                                                            </index>
                                                                                                        </name>
                                                                                                        <block>{
                                                                                                            <expr>
                                                                                                                <name>
                                                                                                                    name
                                                                                                                </name>
                                                                                                            </expr>
                                                                                                            ,
                                                                                                            <expr>
                                                                                                                <call>
                                                                                                                    <name>
                                                                                                                        <name>
                                                                                                                            oneAttrUse</name>
                                                                                                                        .<name>
                                                                                                                        fAttrDecl</name>.
                                                                                                                        <name>
                                                                                                                            getName
                                                                                                                        </name>
                                                                                                                    </name>
                                                                                                                    <argument_list>
                                                                                                                        ()
                                                                                                                    </argument_list>
                                                                                                                </call>
                                                                                                            </expr>
                                                                                                            ,
                                                                                                            <expr>
                                                                                                                <name>
                                                                                                                    idName
                                                                                                                </name>
                                                                                                            </expr>
                                                                                                            }
                                                                                                        </block>
                                                                                                    </expr>
                                                                                                </argument>
                                                                                                ,
                                                                                                <argument>
                                                                                                    <expr>
                                                                                                        <name>child
                                                                                                        </name>
                                                                                                    </expr>
                                                                                                </argument>
                                                                                                )
                                                                                            </argument_list>
                                                                                        </call>
                                                                                    </expr>
                                                                                    ;
                                                                                </expr_stmt>
                                                                                }
                                                                            </block>
                                                                        </then>
                                                                    </if>
                                                                    }
                                                                </block>
                                                            </then>
                                                            <else>else
                                                                <block>{
                                                                    <comment type="line">// REVISIT: what if one of the
                                                                        attribute uses is "prohibited"
                                                                    </comment>
                                                                    <decl_stmt>
                                                                        <decl>
                                                                            <type>
                                                                                <name>String</name>
                                                                            </type>
                                                                            <name>code</name> =
                                                                            <init>
                                                                                <expr>(<name>enclosingCT
                                                                                </name> == <name>null</name>) ?
                                                                                    "ag-props-correct.2" :
                                                                                    "ct-props-correct.4"
                                                                                </expr>
                                                                            </init>
                                                                        </decl>
                                                                        ;
                                                                    </decl_stmt>
                                                                    <decl_stmt>
                                                                        <decl>
                                                                            <type>
                                                                                <name>String</name>
                                                                            </type>
                                                                            <name>name</name> =
                                                                            <init>
                                                                                <expr>(<name>enclosingCT
                                                                                </name> == <name>null</name>) ?
                                                                                    <name><name>attrGrp</name>.
                                                                                        <name>fName</name>
                                                                                    </name>
                                                                                    :
                                                                                    <call>
                                                                                        <name><name>enclosingCT</name>.
                                                                                            <name>getName</name>
                                                                                        </name>
                                                                                        <argument_list>()
                                                                                        </argument_list>
                                                                                    </call>
                                                                                </expr>
                                                                            </init>
                                                                        </decl>
                                                                        ;
                                                                    </decl_stmt>
                                                                    <expr_stmt>
                                                                        <expr>
                                                                            <call>
                                                                                <name>reportSchemaError</name>
                                                                                <argument_list>(
                                                                                    <argument>
                                                                                        <expr>
                                                                                            <name>code</name>
                                                                                        </expr>
                                                                                    </argument>
                                                                                    ,
                                                                                    <argument>
                                                                                        <expr>new
                                                                                            <name>
                                                                                                <name>Object</name>
                                                                                                <index>[]</index>
                                                                                            </name>
                                                                                            <block>{
                                                                                                <expr>
                                                                                                    <name>name</name>
                                                                                                </expr>
                                                                                                ,
                                                                                                <expr>
                                                                                                    <call>
                                                                                                        <name><name>
                                                                                                            oneAttrUse</name>
                                                                                                            .<name>
                                                                                                                fAttrDecl</name>.
                                                                                                            <name>
                                                                                                                getName
                                                                                                            </name>
                                                                                                        </name>
                                                                                                        <argument_list>
                                                                                                            ()
                                                                                                        </argument_list>
                                                                                                    </call>
                                                                                                </expr>
                                                                                                }
                                                                                            </block>
                                                                                        </expr>
                                                                                    </argument>
                                                                                    ,
                                                                                    <argument>
                                                                                        <expr>
                                                                                            <name>child</name>
                                                                                        </expr>
                                                                                    </argument>
                                                                                    )
                                                                                </argument_list>
                                                                            </call>
                                                                        </expr>
                                                                        ;
                                                                    </expr_stmt>
                                                                    }
                                                                </block>
                                                            </else>
                                                        </if>
                                                        }
                                                    </block>
                                                </for>

                                                <if>if
                                                    <condition>(
                                                        <expr>
                                                            <name><name>tempAttrGrp</name>.
                                                                <name>fAttributeWC</name>
                                                            </name>
                                                            !=
                                                            <name>null</name>
                                                        </expr>
                                                        )
                                                    </condition>
                                                    <then>
                                                        <block>{
                                                            <if>if
                                                                <condition>(
                                                                    <expr>
                                                                        <name><name>attrGrp</name>.
                                                                            <name>fAttributeWC</name>
                                                                        </name>
                                                                        ==
                                                                        <name>null</name>
                                                                    </expr>
                                                                    )
                                                                </condition>
                                                                <then>
                                                                    <block>{
                                                                        <expr_stmt>
                                                                            <expr>
                                                                                <name><name>attrGrp</name>.
                                                                                    <name>fAttributeWC</name>
                                                                                </name>
                                                                                =
                                                                                <name><name>tempAttrGrp</name>.
                                                                                    <name>fAttributeWC</name>
                                                                                </name>
                                                                            </expr>
                                                                            ;
                                                                        </expr_stmt>
                                                                        }
                                                                    </block>
                                                                </then>
                                                                <comment type="line">// perform intersection of
                                                                    attribute wildcard
                                                                </comment>
                                                                <else>else
                                                                    <block>{
                                                                        <expr_stmt>
                                                                            <expr>
                                                                                <name><name>attrGrp</name>.
                                                                                    <name>fAttributeWC</name>
                                                                                </name>
                                                                                =
                                                                                <call>
                                                                                    <name><name>attrGrp</name>.<name>
                                                                                        fAttributeWC</name>.
                                                                                        <name>performIntersectionWith
                                                                                        </name>
                                                                                    </name>
                                                                                    <argument_list>(
                                                                                        <argument>
                                                                                            <expr>
                                                                                                <name><name>
                                                                                                    tempAttrGrp</name>.
                                                                                                    <name>fAttributeWC
                                                                                                    </name>
                                                                                                </name>
                                                                                            </expr>
                                                                                        </argument>
                                                                                        ,
                                                                                        <argument>
                                                                                            <expr>
                                                                                                <name><name>
                                                                                                    attrGrp</name>
                                                                                                    .<name>
                                                                                                        fAttributeWC</name>.
                                                                                                    <name>
                                                                                                        fProcessContents
                                                                                                    </name>
                                                                                                </name>
                                                                                            </expr>
                                                                                        </argument>
                                                                                        )
                                                                                    </argument_list>
                                                                                </call>
                                                                            </expr>
                                                                            ;
                                                                        </expr_stmt>
                                                                        <if>if
                                                                            <condition>(
                                                                                <expr>
                                                                                    <name><name>attrGrp</name>.
                                                                                        <name>fAttributeWC</name>
                                                                                    </name>
                                                                                    ==
                                                                                    <name>null</name>
                                                                                </expr>
                                                                                )
                                                                            </condition>
                                                                            <then>
                                                                                <block>{
                                                                                    <decl_stmt>
                                                                                        <decl>
                                                                                            <type>
                                                                                                <name>String</name>
                                                                                            </type>
                                                                                            <name>code</name> =
                                                                                            <init>
                                                                                                <expr>(<name>
                                                                                                    enclosingCT
                                                                                                </name> == <name>
                                                                                                    null</name>) ?
                                                                                                    "src-attribute_group.2"
                                                                                                    : "src-ct.4"
                                                                                                </expr>
                                                                                            </init>
                                                                                        </decl>
                                                                                        ;
                                                                                    </decl_stmt>
                                                                                    <decl_stmt>
                                                                                        <decl>
                                                                                            <type>
                                                                                                <name>String</name>
                                                                                            </type>
                                                                                            <name>name</name> =
                                                                                            <init>
                                                                                                <expr>(<name>
                                                                                                    enclosingCT
                                                                                                </name> == <name>
                                                                                                    null</name>) ?
                                                                                                    <name><name>
                                                                                                        attrGrp</name>.
                                                                                                        <name>fName
                                                                                                        </name>
                                                                                                    </name>
                                                                                                    :
                                                                                                    <call>
                                                                                                        <name><name>
                                                                                                            enclosingCT</name>
                                                                                                            .
                                                                                                            <name>
                                                                                                                getName
                                                                                                            </name>
                                                                                                        </name>
                                                                                                        <argument_list>
                                                                                                            ()
                                                                                                        </argument_list>
                                                                                                    </call>
                                                                                                </expr>
                                                                                            </init>
                                                                                        </decl>
                                                                                        ;
                                                                                    </decl_stmt>
                                                                                    <expr_stmt>
                                                                                        <expr>
                                                                                            <call>
                                                                                                <name>
                                                                                                    reportSchemaError
                                                                                                </name>
                                                                                                <argument_list>(
                                                                                                    <argument>
                                                                                                        <expr>
                                                                                                            <name>code
                                                                                                            </name>
                                                                                                        </expr>
                                                                                                    </argument>
                                                                                                    ,
                                                                                                    <argument>
                                                                                                        <expr>new
                                                                                                            <name>
                                                                                                                <name>
                                                                                                                    Object
                                                                                                                </name>
                                                                                                                <index>
                                                                                                                    []
                                                                                                                </index>
                                                                                                            </name>
                                                                                                            <block>{
                                                                                                                <expr>
                                                                                                                    <name>
                                                                                                                        name
                                                                                                                    </name>
                                                                                                                </expr>
                                                                                                                }
                                                                                                            </block>
                                                                                                        </expr>
                                                                                                    </argument>
                                                                                                    ,
                                                                                                    <argument>
                                                                                                        <expr>
                                                                                                            <name>
                                                                                                                child
                                                                                                            </name>
                                                                                                        </expr>
                                                                                                    </argument>
                                                                                                    )
                                                                                                </argument_list>
                                                                                            </call>
                                                                                        </expr>
                                                                                        ;
                                                                                    </expr_stmt>
                                                                                    }
                                                                                </block>
                                                                            </then>
                                                                        </if>
                                                                        }
                                                                    </block>
                                                                </else>
                                                            </if>
                                                            }
                                                        </block>
                                                    </then>
                                                </if>
                                                }
                                            </block>
                                        </then>
                                        <else>else
                                            <break>break;</break>
                                        </else>
                                    </if>
                                </else>
                            </if>
                            }
                        </block>
                    </for>
                    <comment type="line">// for</comment>

                    <if>if
                        <condition>(
                            <expr>
                                <name>child</name>
                                !=
                                <name>null</name>
                            </expr>
                            )
                        </condition>
                        <then>
                            <block>{
                                <expr_stmt>
                                    <expr>
                                        <name>childName</name>
                                        =
                                        <call>
                                            <name><name>DOMUtil</name>.
                                                <name>getLocalName</name>
                                            </name>
                                            <argument_list>(
                                                <argument>
                                                    <expr>
                                                        <name>child</name>
                                                    </expr>
                                                </argument>
                                                )
                                            </argument_list>
                                        </call>
                                    </expr>
                                    ;
                                </expr_stmt>
                                <if>if
                                    <condition>(
                                        <expr>
                                            <call>
                                                <name><name>childName</name>.
                                                    <name>equals</name>
                                                </name>
                                                <argument_list>(
                                                    <argument>
                                                        <expr>
                                                            <name><name>SchemaSymbols</name>.
                                                                <name>ELT_ANYATTRIBUTE</name>
                                                            </name>
                                                        </expr>
                                                    </argument>
                                                    )
                                                </argument_list>
                                            </call>
                                        </expr>
                                        )
                                    </condition>
                                    <then>
                                        <block>{
                                            <decl_stmt>
                                                <decl>
                                                    <type>
                                                        <name>XSWildcardDecl</name>
                                                    </type>
                                                    <name>tempAttrWC</name> =
                                                    <init>
                                                        <expr>
                                                            <call>
                                                                <name><name>fSchemaHandler</name>.<name>
                                                                    fWildCardTraverser</name>.
                                                                    <name>traverseAnyAttribute</name>
                                                                </name>
                                                                <argument_list>(
                                                                    <argument>
                                                                        <expr>
                                                                            <name>child</name>
                                                                        </expr>
                                                                    </argument>
                                                                    ,
                                                                    <argument>
                                                                        <expr>
                                                                            <name>schemaDoc</name>
                                                                        </expr>
                                                                    </argument>
                                                                    ,
                                                                    <argument>
                                                                        <expr>
                                                                            <name>grammar</name>
                                                                        </expr>
                                                                    </argument>
                                                                    )
                                                                </argument_list>
                                                            </call>
                                                        </expr>
                                                    </init>
                                                </decl>
                                                ;
                                            </decl_stmt>
                                            <if>if
                                                <condition>(
                                                    <expr>
                                                        <name><name>attrGrp</name>.
                                                            <name>fAttributeWC</name>
                                                        </name>
                                                        ==
                                                        <name>null</name>
                                                    </expr>
                                                    )
                                                </condition>
                                                <then>
                                                    <block>{
                                                        <expr_stmt>
                                                            <expr>
                                                                <name><name>attrGrp</name>.
                                                                    <name>fAttributeWC</name>
                                                                </name>
                                                                =
                                                                <name>tempAttrWC</name>
                                                            </expr>
                                                            ;
                                                        </expr_stmt>
                                                        }
                                                    </block>
                                                </then>
                                                <comment type="line">// perform intersection of attribute wildcard
                                                </comment>
                                                <else>else
                                                    <block>{
                                                        <expr_stmt>
                                                            <expr>
                                                                <name><name>attrGrp</name>.
                                                                    <name>fAttributeWC</name>
                                                                </name>
                                                                =
                                                                <call>
                                                                    <name><name>tempAttrWC</name>.
                                                                        <name>performIntersectionWith</name>
                                                                    </name>
                                                                    <argument_list>(
                                                                        <argument>
                                                                            <expr>
                                                                                <name><name>attrGrp</name>.
                                                                                    <name>fAttributeWC</name>
                                                                                </name>
                                                                            </expr>
                                                                        </argument>
                                                                        ,
                                                                        <argument>
                                                                            <expr>
                                                                                <name><name>tempAttrWC</name>.
                                                                                    <name>fProcessContents</name>
                                                                                </name>
                                                                            </expr>
                                                                        </argument>
                                                                        )
                                                                    </argument_list>
                                                                </call>
                                                            </expr>
                                                            ;
                                                        </expr_stmt>
                                                        <if>if
                                                            <condition>(
                                                                <expr>
                                                                    <name><name>attrGrp</name>.
                                                                        <name>fAttributeWC</name>
                                                                    </name>
                                                                    ==
                                                                    <name>null</name>
                                                                </expr>
                                                                )
                                                            </condition>
                                                            <then>
                                                                <block>{
                                                                    <decl_stmt>
                                                                        <decl>
                                                                            <type>
                                                                                <name>String</name>
                                                                            </type>
                                                                            <name>code</name> =
                                                                            <init>
                                                                                <expr>(<name>enclosingCT
                                                                                </name> == <name>null</name>) ?
                                                                                    "src-attribute_group.2" : "src-ct.4"
                                                                                </expr>
                                                                            </init>
                                                                        </decl>
                                                                        ;
                                                                    </decl_stmt>
                                                                    <decl_stmt>
                                                                        <decl>
                                                                            <type>
                                                                                <name>String</name>
                                                                            </type>
                                                                            <name>name</name> =
                                                                            <init>
                                                                                <expr>(<name>enclosingCT
                                                                                </name> == <name>null</name>) ?
                                                                                    <name><name>attrGrp</name>.
                                                                                        <name>fName</name>
                                                                                    </name>
                                                                                    :
                                                                                    <call>
                                                                                        <name><name>enclosingCT</name>.
                                                                                            <name>getName</name>
                                                                                        </name>
                                                                                        <argument_list>()
                                                                                        </argument_list>
                                                                                    </call>
                                                                                </expr>
                                                                            </init>
                                                                        </decl>
                                                                        ;
                                                                    </decl_stmt>
                                                                    <expr_stmt>
                                                                        <expr>
                                                                            <call>
                                                                                <name>reportSchemaError</name>
                                                                                <argument_list>(
                                                                                    <argument>
                                                                                        <expr>
                                                                                            <name>code</name>
                                                                                        </expr>
                                                                                    </argument>
                                                                                    ,
                                                                                    <argument>
                                                                                        <expr>new
                                                                                            <name>
                                                                                                <name>Object</name>
                                                                                                <index>[]</index>
                                                                                            </name>
                                                                                            <block>{
                                                                                                <expr>
                                                                                                    <name>name</name>
                                                                                                </expr>
                                                                                                }
                                                                                            </block>
                                                                                        </expr>
                                                                                    </argument>
                                                                                    ,
                                                                                    <argument>
                                                                                        <expr>
                                                                                            <name>child</name>
                                                                                        </expr>
                                                                                    </argument>
                                                                                    )
                                                                                </argument_list>
                                                                            </call>
                                                                        </expr>
                                                                        ;
                                                                    </expr_stmt>
                                                                    }
                                                                </block>
                                                            </then>
                                                        </if>
                                                        }
                                                    </block>
                                                </else>
                                            </if>
                                            <expr_stmt>
                                                <expr>
                                                    <name>child</name>
                                                    =
                                                    <call>
                                                        <name><name>DOMUtil</name>.
                                                            <name>getNextSiblingElement</name>
                                                        </name>
                                                        <argument_list>(
                                                            <argument>
                                                                <expr>
                                                                    <name>child</name>
                                                                </expr>
                                                            </argument>
                                                            )
                                                        </argument_list>
                                                    </call>
                                                </expr>
                                                ;
                                            </expr_stmt>
                                            }
                                        </block>
                                    </then>
                                </if>
                                }
                            </block>
                        </then>
                    </if>

                    <comment type="line">// Success</comment>
                    <return>return
                        <expr>
                            <name>child</name>
                        </expr>
                        ;
                    </return>

                    }
                </block>
            </function>

            <function>
                <type>
                    <name>void</name>
                </type>
                <name>reportSchemaError</name>
                <parameter_list>(
                    <param>
                        <decl>
                            <type>
                                <name>String</name>
                            </type>
                            <name>key</name>
                        </decl>
                    </param>
                    ,
                    <param>
                        <decl>
                            <type>
                                <name>
                                    <name>Object</name>
                                    <index>[]</index>
                                </name>
                            </type>
                            <name>args</name>
                        </decl>
                    </param>
                    ,
                    <param>
                        <decl>
                            <type>
                                <name>Element</name>
                            </type>
                            <name>ele</name>
                        </decl>
                    </param>
                    )
                </parameter_list>
                <block>{
                    <expr_stmt>
                        <expr>
                            <call>
                                <name><name>fSchemaHandler</name>.
                                    <name>reportSchemaError</name>
                                </name>
                                <argument_list>(
                                    <argument>
                                        <expr>
                                            <name>key</name>
                                        </expr>
                                    </argument>
                                    ,
                                    <argument>
                                        <expr>
                                            <name>args</name>
                                        </expr>
                                    </argument>
                                    ,
                                    <argument>
                                        <expr>
                                            <name>ele</name>
                                        </expr>
                                    </argument>
                                    )
                                </argument_list>
                            </call>
                        </expr>
                        ;
                    </expr_stmt>
                    }
                </block>
            </function>

            <comment type="javadoc">/**
                * Element/Attribute traversers call this method to check whether
                * the type is NOTATION without enumeration facet
                */
            </comment>
            <function>
                <type>
                    <name>void</name>
                </type>
                <name>checkNotationType</name>
                <parameter_list>(
                    <param>
                        <decl>
                            <type>
                                <name>String</name>
                            </type>
                            <name>refName</name>
                        </decl>
                    </param>
                    ,
                    <param>
                        <decl>
                            <type>
                                <name>XSTypeDefinition</name>
                            </type>
                            <name>typeDecl</name>
                        </decl>
                    </param>
                    ,
                    <param>
                        <decl>
                            <type>
                                <name>Element</name>
                            </type>
                            <name>elem</name>
                        </decl>
                    </param>
                    )
                </parameter_list>
                <block>{
                    <if>if
                        <condition>(
                            <expr>
                                <call>
                                    <name><name>typeDecl</name>.
                                        <name>getTypeCategory</name>
                                    </name>
                                    <argument_list>()</argument_list>
                                </call>
                                ==
                                <name><name>XSTypeDefinition</name>.
                                    <name>SIMPLE_TYPE</name>
                                </name>
                                &amp;&amp;
                                ((<name>XSSimpleType</name>)<name>typeDecl</name>).
                                <call>
                                    <name>getVariety</name>
                                    <argument_list>()</argument_list>
                                </call>
                                ==
                                <name><name>XSSimpleType</name>.
                                    <name>VARIETY_ATOMIC</name>
                                </name>
                                &amp;&amp;
                                ((<name>XSSimpleType</name>)<name>typeDecl</name>).
                                <call>
                                    <name>getPrimitiveKind</name>
                                    <argument_list>()</argument_list>
                                </call>
                                ==
                                <name><name>XSSimpleType</name>.
                                    <name>PRIMITIVE_NOTATION</name>
                                </name>
                            </expr>
                            )
                        </condition>
                        <then>
                            <block>{
                                <if>if
                                    <condition>(
                                        <expr>(((<name>XSSimpleType</name>)<name>typeDecl</name>).
                                            <call>
                                                <name>getDefinedFacets</name>
                                                <argument_list>()</argument_list>
                                            </call>
                                            &amp;
                                            <name><name>XSSimpleType</name>.
                                                <name>FACET_ENUMERATION</name>
                                            </name>
                                            ) == 0
                                        </expr>
                                        )
                                    </condition>
                                    <then>
                                        <block>{
                                            <expr_stmt>
                                                <expr>
                                                    <call>
                                                        <name>reportSchemaError</name>
                                                        <argument_list>(
                                                            <argument>
                                                                <expr>"enumeration-required-notation"</expr>
                                                            </argument>
                                                            ,
                                                            <argument>
                                                                <expr>new
                                                                    <name>
                                                                        <name>Object</name>
                                                                        <index>[]</index>
                                                                    </name>
                                                                    <block>{
                                                                        <expr>
                                                                            <call>
                                                                                <name><name>typeDecl</name>.
                                                                                    <name>getName</name>
                                                                                </name>
                                                                                <argument_list>()</argument_list>
                                                                            </call>
                                                                        </expr>
                                                                        ,
                                                                        <expr>
                                                                            <name>refName</name>
                                                                        </expr>
                                                                        ,
                                                                        <expr>
                                                                            <call>
                                                                                <name><name>DOMUtil</name>.
                                                                                    <name>getLocalName</name>
                                                                                </name>
                                                                                <argument_list>(
                                                                                    <argument>
                                                                                        <expr>
                                                                                            <name>elem</name>
                                                                                        </expr>
                                                                                    </argument>
                                                                                    )
                                                                                </argument_list>
                                                                            </call>
                                                                        </expr>
                                                                        }
                                                                    </block>
                                                                </expr>
                                                            </argument>
                                                            ,
                                                            <argument>
                                                                <expr>
                                                                    <name>elem</name>
                                                                </expr>
                                                            </argument>
                                                            )
                                                        </argument_list>
                                                    </call>
                                                </expr>
                                                ;
                                            </expr_stmt>
                                            }
                                        </block>
                                    </then>
                                </if>
                                }
                            </block>
                        </then>
                    </if>
                    }
                </block>
            </function>

            <comment type="line">// Checks constraints for minOccurs, maxOccurs</comment>
            <function>
                <type>
                    <specifier>protected</specifier>
                    <name>XSParticleDecl</name>
                </type>
                <name>checkOccurrences</name>
                <parameter_list>(
                    <param>
                        <decl>
                            <type>
                                <name>XSParticleDecl</name>
                            </type>
                            <name>particle</name>
                        </decl>
                    </param>
                    ,
                    <param>
                        <decl>
                            <type>
                                <name>String</name>
                            </type>
                            <name>particleName</name>
                        </decl>
                    </param>
                    ,
                    <param>
                        <decl>
                            <type>
                                <name>Element</name>
                            </type>
                            <name>parent</name>
                        </decl>
                    </param>
                    ,
                    <param>
                        <decl>
                            <type>
                                <name>int</name>
                            </type>
                            <name>allContextFlags</name>
                        </decl>
                    </param>
                    ,
                    <param>
                        <decl>
                            <type>
                                <name>long</name>
                            </type>
                            <name>defaultVals</name>
                        </decl>
                    </param>
                    )
                </parameter_list>
                <block>{

                    <decl_stmt>
                        <decl>
                            <type>
                                <name>int</name>
                            </type>
                            <name>min</name> =
                            <init>
                                <expr>
                                    <name><name>particle</name>.
                                        <name>fMinOccurs</name>
                                    </name>
                                </expr>
                            </init>
                        </decl>
                        ;
                    </decl_stmt>
                    <decl_stmt>
                        <decl>
                            <type>
                                <name>int</name>
                            </type>
                            <name>max</name> =
                            <init>
                                <expr>
                                    <name><name>particle</name>.
                                        <name>fMaxOccurs</name>
                                    </name>
                                </expr>
                            </init>
                        </decl>
                        ;
                    </decl_stmt>
                    <decl_stmt>
                        <decl>
                            <type>
                                <name>boolean</name>
                            </type>
                            <name>defaultMin</name> =
                            <init>
                                <expr>(<name>defaultVals</name> &amp; (1 &lt;&lt;
                                    <name><name>XSAttributeChecker</name>.
                                        <name>ATTIDX_MINOCCURS</name>
                                    </name>
                                    )) != 0
                                </expr>
                            </init>
                        </decl>
                        ;
                    </decl_stmt>
                    <decl_stmt>
                        <decl>
                            <type>
                                <name>boolean</name>
                            </type>
                            <name>defaultMax</name> =
                            <init>
                                <expr>(<name>defaultVals</name> &amp; (1 &lt;&lt;
                                    <name><name>XSAttributeChecker</name>.
                                        <name>ATTIDX_MAXOCCURS</name>
                                    </name>
                                    )) != 0
                                </expr>
                            </init>
                        </decl>
                        ;
                    </decl_stmt>

                    <decl_stmt>
                        <decl>
                            <type>
                                <name>boolean</name>
                            </type>
                            <name>processingAllEl</name> =
                            <init>
                                <expr>((<name>allContextFlags</name> &amp; <name>PROCESSING_ALL_EL</name>) != 0)
                                </expr>
                            </init>
                        </decl>
                        ;
                    </decl_stmt>
                    <decl_stmt>
                        <decl>
                            <type>
                                <name>boolean</name>
                            </type>
                            <name>processingAllGP</name> =
                            <init>
                                <expr>((<name>allContextFlags</name> &amp; <name>PROCESSING_ALL_GP</name>) != 0)
                                </expr>
                            </init>
                        </decl>
                        ;
                    </decl_stmt>
                    <decl_stmt>
                        <decl>
                            <type>
                                <name>boolean</name>
                            </type>
                            <name>groupRefWithAll</name> =
                            <init>
                                <expr>((<name>allContextFlags</name> &amp; <name>GROUP_REF_WITH_ALL</name>) != 0)
                                </expr>
                            </init>
                        </decl>
                        ;
                    </decl_stmt>
                    <decl_stmt>
                        <decl>
                            <type>
                                <name>boolean</name>
                            </type>
                            <name>isGroupChild</name>    =
                            <init>
                                <expr>((<name>allContextFlags</name> &amp; <name>CHILD_OF_GROUP</name>) != 0)
                                </expr>
                            </init>
                        </decl>
                        ;
                    </decl_stmt>

                    <comment type="line">// Neither minOccurs nor maxOccurs may be specified</comment>
                    <comment type="line">// for the child of a model group definition.</comment>
                    <if>if
                        <condition>(
                            <expr>
                                <name>isGroupChild</name>
                            </expr>
                            )
                        </condition>
                        <then>
                            <block>{
                                <if>if
                                    <condition>(
                                        <expr>!
                                            <name>defaultMin</name>
                                        </expr>
                                        )
                                    </condition>
                                    <then>
                                        <block>{
                                            <decl_stmt>
                                                <decl>
                                                    <type>
                                                        <name>Object</name>
                                                        <index>[]</index>
                                                    </type>
                                                    <name>args</name> =
                                                    <init>
                                                        <expr>new
                                                            <name>
                                                                <name>Object</name>
                                                                <index>[]</index>
                                                            </name>
                                                            <block>{
                                                                <expr>
                                                                    <name>particleName</name>
                                                                </expr>
                                                                , <expr>"minOccurs"</expr>}
                                                            </block>
                                                        </expr>
                                                    </init>
                                                </decl>
                                                ;
                                            </decl_stmt>
                                            <expr_stmt>
                                                <expr>
                                                    <call>
                                                        <name>reportSchemaError</name>
                                                        <argument_list>(
                                                            <argument>
                                                                <expr>"s4s-att-not-allowed"</expr>
                                                            </argument>
                                                            ,
                                                            <argument>
                                                                <expr>
                                                                    <name>args</name>
                                                                </expr>
                                                            </argument>
                                                            ,
                                                            <argument>
                                                                <expr>
                                                                    <name>parent</name>
                                                                </expr>
                                                            </argument>
                                                            )
                                                        </argument_list>
                                                    </call>
                                                </expr>
                                                ;
                                            </expr_stmt>
                                            <expr_stmt>
                                                <expr>
                                                    <name>min</name>
                                                    = 1
                                                </expr>
                                                ;
                                            </expr_stmt>
                                            }
                                        </block>
                                    </then>
                                </if>
                                <if>if
                                    <condition>(
                                        <expr>!
                                            <name>defaultMax</name>
                                        </expr>
                                        )
                                    </condition>
                                    <then>
                                        <block>{
                                            <decl_stmt>
                                                <decl>
                                                    <type>
                                                        <name>Object</name>
                                                        <index>[]</index>
                                                    </type>
                                                    <name>args</name> =
                                                    <init>
                                                        <expr>new
                                                            <name>
                                                                <name>Object</name>
                                                                <index>[]</index>
                                                            </name>
                                                            <block>{
                                                                <expr>
                                                                    <name>particleName</name>
                                                                </expr>
                                                                , <expr>"maxOccurs"</expr>}
                                                            </block>
                                                        </expr>
                                                    </init>
                                                </decl>
                                                ;
                                            </decl_stmt>
                                            <expr_stmt>
                                                <expr>
                                                    <call>
                                                        <name>reportSchemaError</name>
                                                        <argument_list>(
                                                            <argument>
                                                                <expr>"s4s-att-not-allowed"</expr>
                                                            </argument>
                                                            ,
                                                            <argument>
                                                                <expr>
                                                                    <name>args</name>
                                                                </expr>
                                                            </argument>
                                                            ,
                                                            <argument>
                                                                <expr>
                                                                    <name>parent</name>
                                                                </expr>
                                                            </argument>
                                                            )
                                                        </argument_list>
                                                    </call>
                                                </expr>
                                                ;
                                            </expr_stmt>
                                            <expr_stmt>
                                                <expr>
                                                    <name>max</name>
                                                    = 1
                                                </expr>
                                                ;
                                            </expr_stmt>
                                            }
                                        </block>
                                    </then>
                                </if>
                                }
                            </block>
                        </then>
                    </if>

                    <comment type="line">// If minOccurs=maxOccurs=0, no component is specified</comment>
                    <if>if
                        <condition>(
                            <expr>
                                <name>min</name>
                                == 0 &amp;&amp; <name>max</name>== 0
                            </expr>
                            )
                        </condition>
                        <then>
                            <block>{
                                <expr_stmt>
                                    <expr>
                                        <name><name>particle</name>.
                                            <name>fType</name>
                                        </name>
                                        =
                                        <name><name>XSParticleDecl</name>.
                                            <name>PARTICLE_EMPTY</name>
                                        </name>
                                    </expr>
                                    ;
                                </expr_stmt>
                                <return>return
                                    <expr>
                                        <name>null</name>
                                    </expr>
                                    ;
                                </return>
                                }
                            </block>
                        </then>
                    </if>

                    <comment type="line">// For the elements referenced in an &lt;all&gt;, minOccurs attribute</comment>
                    <comment type="line">// must be zero or one, and maxOccurs attribute must be one.</comment>
                    <comment type="line">// For a complex type definition that contains an &lt;all&gt; or a</comment>
                    <comment type="line">// reference a &lt;group&gt; whose model group is an all model group,</comment>
                    <comment type="line">// minOccurs and maxOccurs must be one.</comment>
                    <if>if
                        <condition>(
                            <expr>
                                <name>processingAllEl</name>
                            </expr>
                            )
                        </condition>
                        <then>
                            <block>{
                                <if>if
                                    <condition>(
                                        <expr>
                                            <name>max</name>
                                            != 1
                                        </expr>
                                        )
                                    </condition>
                                    <then>
                                        <block>{
                                            <expr_stmt>
                                                <expr>
                                                    <call>
                                                        <name>reportSchemaError</name>
                                                        <argument_list>(
                                                            <argument>
                                                                <expr>"cos-all-limited.2"</expr>
                                                            </argument>
                                                            ,
                                                            <argument>
                                                                <expr>new
                                                                    <name>
                                                                        <name>Object</name>
                                                                        <index>[]</index>
                                                                    </name>
                                                                    <block>{
                                                                        <expr>new
                                                                            <call>
                                                                                <name>Integer</name>
                                                                                <argument_list>(
                                                                                    <argument>
                                                                                        <expr>
                                                                                            <name>max</name>
                                                                                        </expr>
                                                                                    </argument>
                                                                                    )
                                                                                </argument_list>
                                                                            </call>
                                                                        </expr>
                                                                        ,
                                                                        <expr>((<name>XSElementDecl</name>)
                                                                            <name><name>particle</name>.
                                                                                <name>fValue</name>
                                                                            </name>
                                                                            ).
                                                                            <call>
                                                                                <name>getName</name>
                                                                                <argument_list>()</argument_list>
                                                                            </call>
                                                                        </expr>
                                                                        }
                                                                    </block>
                                                                </expr>
                                                            </argument>
                                                            ,
                                                            <argument>
                                                                <expr>
                                                                    <name>parent</name>
                                                                </expr>
                                                            </argument>
                                                            )
                                                        </argument_list>
                                                    </call>
                                                </expr>
                                                ;
                                            </expr_stmt>
                                            <expr_stmt>
                                                <expr>
                                                    <name>max</name>
                                                    = 1
                                                </expr>
                                                ;
                                            </expr_stmt>
                                            <if>if
                                                <condition>(
                                                    <expr>
                                                        <name>min</name>
                                                        &gt; 1
                                                    </expr>
                                                    )
                                                </condition>
                                                <then>
                                                    <expr_stmt>
                                                        <expr>
                                                            <name>min</name>
                                                            = 1
                                                        </expr>
                                                        ;
                                                    </expr_stmt>
                                                </then>
                                            </if>
                                            }
                                        </block>
                                    </then>
                                </if>
                                }
                            </block>
                        </then>
                        <else>else
                            <if>if
                                <condition>(
                                    <expr>
                                        <name>processingAllGP</name>
                                        ||
                                        <name>groupRefWithAll</name>
                                    </expr>
                                    )
                                </condition>
                                <then>
                                    <block>{
                                        <if>if
                                            <condition>(
                                                <expr>
                                                    <name>max</name>
                                                    != 1
                                                </expr>
                                                )
                                            </condition>
                                            <then>
                                                <block>{
                                                    <expr_stmt>
                                                        <expr>
                                                            <call>
                                                                <name>reportSchemaError</name>
                                                                <argument_list>(
                                                                    <argument>
                                                                        <expr>"cos-all-limited.1.2"</expr>
                                                                    </argument>
                                                                    ,
                                                                    <argument>
                                                                        <expr>
                                                                            <name>null</name>
                                                                        </expr>
                                                                    </argument>
                                                                    ,
                                                                    <argument>
                                                                        <expr>
                                                                            <name>parent</name>
                                                                        </expr>
                                                                    </argument>
                                                                    )
                                                                </argument_list>
                                                            </call>
                                                        </expr>
                                                        ;
                                                    </expr_stmt>
                                                    <if>if
                                                        <condition>(
                                                            <expr>
                                                                <name>min</name>
                                                                &gt; 1
                                                            </expr>
                                                            )
                                                        </condition>
                                                        <then>
                                                            <expr_stmt>
                                                                <expr>
                                                                    <name>min</name>
                                                                    = 1
                                                                </expr>
                                                                ;
                                                            </expr_stmt>
                                                        </then>
                                                    </if>
                                                    <expr_stmt>
                                                        <expr>
                                                            <name>max</name>
                                                            = 1
                                                        </expr>
                                                        ;
                                                    </expr_stmt>
                                                    }
                                                </block>
                                            </then>
                                        </if>
                                        }
                                    </block>
                                </then>
                            </if>
                        </else>
                    </if>

                    <expr_stmt>
                        <expr>
                            <name><name>particle</name>.
                                <name>fMaxOccurs</name>
                            </name>
                            =
                            <name>min</name>
                        </expr>
                        ;
                    </expr_stmt>
                    <expr_stmt>
                        <expr>
                            <name><name>particle</name>.
                                <name>fMaxOccurs</name>
                            </name>
                            =
                            <name>max</name>
                        </expr>
                        ;
                    </expr_stmt>

                    <return>return
                        <expr>
                            <name>particle</name>
                        </expr>
                        ;
                    </return>
                    }
                </block>
            </function>

            <comment type="line">// this is not terribly performant!</comment>
            <function>
                <type>
                    <specifier>private</specifier>
                    <specifier>static</specifier>
                    <name>String</name>
                </type>
                <name>processAttValue</name>
                <parameter_list>(
                    <param>
                        <decl>
                            <type>
                                <name>String</name>
                            </type>
                            <name>original</name>
                        </decl>
                    </param>
                    )
                </parameter_list>
                <block>{
                    <comment type="line">// normally, nothing will happen</comment>
                    <decl_stmt>
                        <decl>
                            <type>
                                <name>StringBuffer</name>
                            </type>
                            <name>newVal</name> =
                            <init>
                                <expr>new
                                    <call>
                                        <name>StringBuffer</name>
                                        <argument_list>(
                                            <argument>
                                                <expr>
                                                    <call>
                                                        <name><name>original</name>.
                                                            <name>length</name>
                                                        </name>
                                                        <argument_list>()</argument_list>
                                                    </call>
                                                </expr>
                                            </argument>
                                            )
                                        </argument_list>
                                    </call>
                                </expr>
                            </init>
                        </decl>
                        ;
                    </decl_stmt>
                    <for>for(
                        <init>
                            <decl>
                                <type>
                                    <name>int</name>
                                </type>
                                <name>i</name>=
                                <init>
                                    <expr>0</expr>
                                </init>
                            </decl>
                            ;
                        </init>
                        <condition>
                            <expr><name>i</name>&lt;
                                <call>
                                    <name><name>original</name>.
                                        <name>length</name>
                                    </name>
                                    <argument_list>()</argument_list>
                                </call>
                            </expr>
                            ;
                        </condition>
                        <incr>
                            <expr><name>i</name>++
                            </expr>
                        </incr>
                        )
                        <block>{
                            <decl_stmt>
                                <decl>
                                    <type>
                                        <name>char</name>
                                    </type>
                                    <name>currChar</name> =
                                    <init>
                                        <expr>
                                            <call>
                                                <name><name>original</name>.
                                                    <name>charAt</name>
                                                </name>
                                                <argument_list>(
                                                    <argument>
                                                        <expr>
                                                            <name>i</name>
                                                        </expr>
                                                    </argument>
                                                    )
                                                </argument_list>
                                            </call>
                                        </expr>
                                    </init>
                                </decl>
                                ;
                            </decl_stmt>
                            <if>if
                                <condition>(
                                    <expr>
                                        <name>currChar</name>
                                        == '"'
                                    </expr>
                                    )
                                </condition>
                                <then>
                                    <block>{
                                        <expr_stmt>
                                            <expr>
                                                <call>
                                                    <name><name>newVal</name>.
                                                        <name>append</name>
                                                    </name>
                                                    <argument_list>(
                                                        <argument>
                                                            <expr>"&amp;quot;"</expr>
                                                        </argument>
                                                        )
                                                    </argument_list>
                                                </call>
                                            </expr>
                                            ;
                                        </expr_stmt>
                                        }
                                    </block>
                                </then>
                                <else>else
                                    <if>if
                                        <condition>(
                                            <expr>
                                                <name>currChar</name>
                                                == '&gt;'
                                            </expr>
                                            )
                                        </condition>
                                        <then>
                                            <block>{
                                                <expr_stmt>
                                                    <expr>
                                                        <call>
                                                            <name><name>newVal</name>.
                                                                <name>append</name>
                                                            </name>
                                                            <argument_list>(
                                                                <argument>
                                                                    <expr>"&amp;gt;"</expr>
                                                                </argument>
                                                                )
                                                            </argument_list>
                                                        </call>
                                                    </expr>
                                                    ;
                                                </expr_stmt>
                                                }
                                            </block>
                                        </then>
                                        <else>else
                                            <if>if
                                                <condition>(
                                                    <expr>
                                                        <name>currChar</name>
                                                        == '&amp;'
                                                    </expr>
                                                    )
                                                </condition>
                                                <then>
                                                    <block>{
                                                        <expr_stmt>
                                                            <expr>
                                                                <call>
                                                                    <name><name>newVal</name>.
                                                                        <name>append</name>
                                                                    </name>
                                                                    <argument_list>(
                                                                        <argument>
                                                                            <expr>"&amp;amp;"</expr>
                                                                        </argument>
                                                                        )
                                                                    </argument_list>
                                                                </call>
                                                            </expr>
                                                            ;
                                                        </expr_stmt>
                                                        }
                                                    </block>
                                                </then>
                                                <else>else
                                                    <block>{
                                                        <expr_stmt>
                                                            <expr>
                                                                <call>
                                                                    <name><name>newVal</name>.
                                                                        <name>append</name>
                                                                    </name>
                                                                    <argument_list>(
                                                                        <argument>
                                                                            <expr>
                                                                                <name>currChar</name>
                                                                            </expr>
                                                                        </argument>
                                                                        )
                                                                    </argument_list>
                                                                </call>
                                                            </expr>
                                                            ;
                                                        </expr_stmt>
                                                        }
                                                    </block>
                                                </else>
                                            </if>
                                        </else>
                                    </if>
                                </else>
                            </if>
                            }
                        </block>
                    </for>
                    <return>return
                        <expr>
                            <call>
                                <name><name>newVal</name>.
                                    <name>toString</name>
                                </name>
                                <argument_list>()</argument_list>
                            </call>
                        </expr>
                        ;
                    </return>
                    }
                </block>
            </function>
            }
        </block>
    </class>
</unit>
